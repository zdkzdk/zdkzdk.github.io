<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta http-equiv="Content-Style-Type" content="text/css" /><meta name="generator" content="Aspose.Words for .NET 15.1.0.0" /><title></title></head><body><div><p style="line-height:10.5pt; margin:7.8pt 0pt"><span style="width:21pt; text-indent:0pt; display:inline-block"></span><span style="width:21pt; text-indent:0pt; display:inline-block"></span><span style="font-family:等线; font-size:10.5pt">这3个函数在大数据分析中很常用</span></p><h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt; font-style:normal">1.1</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt; font-weight:bold">窗口函数</span></h3><h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">1.1.1</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:等线; font-size:11pt">src</span></h4><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{1}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt">作用：窗口函数为关联的聚合函数指定计算的范围。可以避免聚合函数在</span><span style="font-family:等线; font-size:11pt">group</span><span style="font-family:等线; font-size:11pt"> </span><span style="font-family:等线; font-size:11pt">by</span><span style="font-family:宋体; font-size:11pt">语句中执行</span><span style="font-family:宋体; font-size:11pt">时数据</span><span style="font-family:宋体; font-size:11pt">丢失的问题，可以同时显示聚合前和聚合后的数据。</span></h5><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">[1]</span><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:等线; font-size:11pt">select</span><span style="font-family:等线; font-size:11pt"> </span><span style="font-family:等线; font-size:11pt">*</span><span style="font-family:宋体; font-size:11pt">，</span><span style="font-family:等线; font-size:11pt">sum</span><span style="font-family:等线; font-size:11pt">() </span><span style="font-family:等线; font-size:11pt">from</span><span style="font-family:等线; font-size:11pt"> </span><span style="font-family:等线; font-size:11pt">t</span><span style="font-family:宋体; font-size:11pt">这种语句根本不会执行成功，因为聚合函数只能显示一个，想要显示出</span><span style="font-family:等线; font-size:11pt">sum</span><span style="font-family:等线; font-size:11pt">()</span><span style="font-family:宋体; font-size:11pt">，别的数据就不能显示全。窗口函数每行都有自己的窗口，窗口函数的关联函数可以给每行增加一列。可以在不减少</span><span style="font-family:等线; font-size:11pt">select</span><span style="font-family:等线; font-size:11pt"> </span><span style="font-family:等线; font-size:11pt">*</span><span style="font-family:等线; font-size:11pt"> </span><span style="font-family:宋体; font-size:11pt">结果的情况下显示</span><span style="font-family:等线; font-size:11pt">sum</span><span style="font-family:宋体; font-size:11pt">的。所以使用窗口函数可以避免数据丢失</span></h6><h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">1.1.2</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:等线; font-size:11pt">comprehending</span></h4><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{1}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt">窗口函数需要指定范围，这个范围基于当前行，由步长、分区和排序、</span><span style="font-family:等线; font-size:11pt">10</span><span style="font-family:宋体; font-size:11pt">个函数定义。</span></h5><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">[1]</span><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:宋体; font-size:11pt">窗口函数指定基于当前行的范围</span></h6><p style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 85.05pt; page-break-after:avoid; page-break-inside:avoid; text-indent:0pt"><span style="font-family:'等线 Light'; font-size:11pt">(1)</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="color:#1f3864; font-family:'等线 Light'; font-size:11pt">可以通过over中的关键字设置范围。</span></p><p style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 85.05pt; page-break-after:avoid; page-break-inside:avoid; text-indent:0pt"><span style="font-family:'等线 Light'; font-size:11pt">(2)</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="color:#1f3864; font-family:'等线 Light'; font-size:11pt">hive的窗口大小默认是从起始行到当前行的</span></p><p style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 85.05pt; page-break-after:avoid; page-break-inside:avoid; text-indent:0pt"><span style="font-family:'等线 Light'; font-size:11pt">(3)</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="color:#1f3864; font-family:'等线 Light'; font-size:11pt">一行一个窗口</span></p><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">[2]</span><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:宋体; font-size:11pt">步长</span></h6><p style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 85.05pt; page-break-after:avoid; page-break-inside:avoid; text-indent:0pt"><span style="font-family:'等线 Light'; font-size:11pt">(1)</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="color:#1f3864; font-family:'等线 Light'; font-size:11pt">HQL数据处理时，是一行</span><span style="color:#1f3864; font-family:'等线 Light'; font-size:11pt">一行</span><span style="color:#1f3864; font-family:'等线 Light'; font-size:11pt">执行的。每行都会有一个窗口，扫描到一行就执行一次。</span></p><p style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 85.05pt; page-break-after:avoid; page-break-inside:avoid; text-indent:0pt"><span style="font-family:'等线 Light'; font-size:11pt">(2)</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="color:#1f3864; font-family:'等线 Light'; font-size:11pt">使用over设置窗口大小后，窗口有2个重要属性，步长和长度，通过一系列参数指定。等其他计算执行</span><span style="color:#1f3864; font-family:'等线 Light'; font-size:11pt">完得到</span><span style="color:#1f3864; font-family:'等线 Light'; font-size:11pt">中间结果集，再执行窗口关联的聚合函数得到最终结果集。</span></p><p style="font-weight:normal; line-height:10.5pt; margin:0pt 0pt 0pt 99.25pt; page-break-after:avoid; page-break-inside:avoid; text-indent:0pt"><span style="color:#262626; font-family:'等线 Light'; font-size:10.5pt">1st</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="color:#262626; font-family:'等线 Light'; font-size:10.5pt">离线时就固定的一行</span><span style="color:#262626; font-family:'等线 Light'; font-size:10.5pt">一行</span><span style="color:#262626; font-family:'等线 Light'; font-size:10.5pt">的执行，实时分析时可以灵活设置。</span></p><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">[3]</span><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:宋体; font-size:11pt">窗口函数可以指定窗口的分区和排序。</span></h6><p style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 85.05pt; page-break-after:avoid; page-break-inside:avoid; text-indent:0pt"><span style="font-family:'等线 Light'; font-size:11pt">(1)</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="color:#1f3864; font-family:'等线 Light'; font-size:11pt">分区限制的是窗口移动的范围，如果没分区，头尾就是表的头尾，分区后头尾就是分区的头尾。</span></p><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{2}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt">窗口函数执行时机</span></h5><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">[1]</span><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:宋体; font-size:11pt">除窗口函数关联的聚合函数外的语句也就是</span><span style="font-family:等线; font-size:11pt">from</span><span style="font-family:宋体; font-size:11pt">之后的语句执行完之后。再一行</span><span style="font-family:宋体; font-size:11pt">一行</span><span style="font-family:宋体; font-size:11pt">的执行。像一个可变长度的滑动窗口</span></h6><h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">1.1.3</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:等线; font-size:11pt">usage</span></h4><h5 style="font-weight:normal; line-height:11pt; margin:6pt 0pt 6pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{1}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:等线; font-size:11pt">note</span></h5><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">[1]</span><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:宋体; font-size:11pt">跟在聚合函数后面，只对聚合函数起作用，指定聚合函数的计算范围。</span></h6><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">[2]</span><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:宋体; font-size:11pt">窗口函数是动态的，比如说范围是从当前行和当前行的前一行，但第一行没有前一行，因为执行到第一行时，范围只有</span><span style="font-family:等线; font-size:11pt">1.</span></h6><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{2}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:等线; font-size:11pt">window</span><span style="font-family:宋体; font-size:11pt">子句</span></h5><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">[1]</span><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:等线; font-size:11pt">patition by</span><span style="font-family:宋体; font-size:11pt">是按照一个一个</span><span style="font-family:等线; font-size:11pt">reduce</span><span style="font-family:宋体; font-size:11pt">去处理数据的，所以要使用全局排序</span><span style="font-family:等线; font-size:11pt">order by</span></h6><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">[2]</span><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:等线; font-size:11pt">distribute by</span><span style="font-family:宋体; font-size:11pt">是按照多个</span><span style="font-family:等线; font-size:11pt">reduce</span><span style="font-family:宋体; font-size:11pt">去处理数据的，所以对应的排序是局部排序</span><span style="font-family:等线; font-size:11pt">sort by</span></h6><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt"><span style="background-color:#ffffff; color:#4d4d4d; font-family:微软雅黑; font-size:11pt">over(distribute by…sort by…) 和 over(partition by…order by…)是固定搭配，必须这么用。</span></h6><h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">1.1.4</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt">准备订单数据</span></h4><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{1}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt">数据准备</span></h5><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">name</span><span style="font-family:宋体; font-size:12pt">，</span><span style="font-family:'Courier New'; font-size:12pt">orderdate</span><span style="font-family:宋体; font-size:12pt">，</span><span style="font-family:'Courier New'; font-size:12pt">cost</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">jack,2017-01-01,10</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">tony,2017-01-02,15</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">jack,2017-02-03,23</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">tony,2017-01-04,29</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">jack,2017-01-05,46</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">jack,2017-04-06,42</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">tony,2017-01-07,50</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">jack,2017-01-08,55</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">mart,2017-04-08,62</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">mart,2017-04-09,68</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">neil,2017-05-10,12</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">mart,2017-04-11,75</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">neil,2017-06-12,80</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">mart,2017-04-13,94</span></p><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{2}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt">创建本地</span><span style="font-family:等线; font-size:11pt">business.txt</span><span style="font-family:宋体; font-size:11pt">，导入数据</span></h5><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 63pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:'Courier New'; font-size:12pt">[dc@hadoop102 </span><span style="font-family:'Courier New'; font-size:12pt">datas]$</span><span style="font-family:'Courier New'; font-size:12pt"> vi business.txt</span></p><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{3}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt">创建</span><span style="font-family:等线; font-size:11pt">hive</span><span style="font-family:宋体; font-size:11pt">表并导入数据</span></h5><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">create table </span><span style="font-family:'Courier New'; font-size:12pt">business(</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">name string, </span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">orderdate string,</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">cost int</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">) </span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">ROW FORMAT DELIMITED FIELDS TERMINATED BY ',';</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">load data local inpath "/opt/module/datas/business.txt" into table business;</span></p><h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">1.1.5</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt">相关函数说明</span></h4><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{1}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:等线; font-size:11pt">OVER()</span><span style="font-family:宋体; font-size:11pt">：</span><span style="font-family:宋体; font-size:11pt">指定函数工作的</span><span style="font-family:宋体; font-size:11pt">范围、步长和对全体数据进行分区、排序处理。</span></h5><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">[1]</span><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:宋体; font-size:11pt">范围就是窗口大小。</span><span style="font-family:宋体; font-size:11pt">这个窗口大小可能会随着行的变</span><span style="font-family:宋体; font-size:11pt">化</span><span style="font-family:宋体; font-size:11pt">而变化</span><span style="font-family:宋体; font-size:11pt">。</span></h6><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">[2]</span><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:宋体; font-size:11pt">分区排序处理：</span><span style="font-family:等线; font-size:11pt">over</span><span style="font-family:宋体; font-size:11pt">中可以进行</span><span style="font-family:等线; font-size:11pt">partition by</span><span style="font-family:宋体; font-size:11pt">，</span><span style="font-family:等线; font-size:11pt">cluster</span><span style="font-family:等线; font-size:11pt"> </span><span style="font-family:等线; font-size:11pt">by</span><span style="font-family:宋体; font-size:11pt">，</span><span style="font-family:等线; font-size:11pt">order by</span><span style="font-family:宋体; font-size:11pt">，</span><span style="font-family:等线; font-size:11pt">rows</span><span style="font-family:等线; font-size:11pt"> </span><span style="font-family:等线; font-size:11pt">between</span><span style="font-family:等线; font-size:11pt"> </span><span style="font-family:等线; font-size:11pt">and</span></h6><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{2}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:等线; font-size:11pt">CURRENT ROW</span><span style="font-family:宋体; font-size:11pt">：当前行</span></h5><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{3}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:等线; font-size:11pt">UNBOUNDED</span><span style="font-family:宋体; font-size:11pt">：</span></h5><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">[1]</span><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:宋体; font-size:11pt">起点，</span><span style="font-family:等线; font-size:11pt">UNBOUNDED PRECEDING </span></h6><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">[2]</span><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:宋体; font-size:11pt">终点，</span><span style="font-family:等线; font-size:11pt">UNBOUNDED</span><span style="font-family:等线; font-size:11pt"> </span><span style="font-family:等线; font-size:11pt">FOLLOWING </span></h6><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{4}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:等线; font-size:11pt">n</span><span style="font-family:等线; font-size:11pt"> PRECEDING</span><span style="font-family:宋体; font-size:11pt">：往前</span><span style="font-family:等线; font-size:11pt">n</span><span style="font-family:宋体; font-size:11pt">行数据</span></h5><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{5}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:等线; font-size:11pt">n</span><span style="font-family:等线; font-size:11pt"> FOLLOWING</span><span style="font-family:宋体; font-size:11pt">：往后</span><span style="font-family:等线; font-size:11pt">n</span><span style="font-family:宋体; font-size:11pt">行数据</span></h5><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{6}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:等线; font-size:11pt">LAG(col,n</span><span style="font-family:等线; font-size:11pt">,default</span><span style="font-family:等线; font-size:11pt">)</span><span style="font-family:宋体; font-size:11pt">：</span><span style="font-family:宋体; font-size:11pt">往前第</span><span style="font-family:等线; font-size:11pt">n</span><span style="font-family:宋体; font-size:11pt">行数据，如果没有，比如第一行，用默认值</span></h5><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{7}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:等线; font-size:11pt">LEAD(col,n)</span><span style="font-family:宋体; font-size:11pt">：往后第</span><span style="font-family:等线; font-size:11pt">n</span><span style="font-family:宋体; font-size:11pt">行数据</span></h5><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{8}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:等线; font-size:11pt">first_</span><span style="font-family:等线; font-size:11pt">value(</span><span style="font-family:等线; font-size:11pt">)</span></h5><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">[1]</span><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:宋体; font-size:11pt">取分组内排序后，截止到当前行，第一个值</span><span style="font-family:等线; font-size:11pt">.</span></h6><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">[2]</span><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:宋体; font-size:11pt">如果不指定</span><span style="font-family:等线; font-size:11pt">ORDER BY</span><span style="font-family:宋体; font-size:11pt">，则默认按照记录在文件中的偏移量进行排序，会出现错误的结果</span></h6><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{9}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:等线; font-size:11pt">last_</span><span style="font-family:等线; font-size:11pt">value(</span><span style="font-family:等线; font-size:11pt">)</span></h5><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">[1]</span><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:宋体; font-size:11pt">取分组内排序后，截止到当前行，最后一个值</span></h6><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">[2]</span><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:宋体; font-size:11pt">如果不指定</span><span style="font-family:等线; font-size:11pt">ORDER BY</span><span style="font-family:宋体; font-size:11pt">，则默认按照记录在文件中的偏移量进行排序，会出现错误的结果</span></h6><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{10}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:等线; font-size:11pt">NTILE(n)</span><span style="font-family:宋体; font-size:11pt">：把有序分区中的行分发到指定数据的组中，各个组有编号，编号从</span><span style="font-family:等线; font-size:11pt">1</span><span style="font-family:宋体; font-size:11pt">开始，对于每一行，</span><span style="font-family:等线; font-size:11pt">NTILE</span><span style="font-family:宋体; font-size:11pt">返回此行所属的组的</span><span style="color:#ff0000; font-family:宋体; font-size:11pt">编号</span><span style="font-family:宋体; font-size:11pt">，是个数字。</span><span style="color:#ff0000; font-family:宋体; font-size:11pt">注意：</span><span style="color:#ff0000; font-family:等线; font-size:11pt">n</span><span style="color:#ff0000; font-family:宋体; font-size:11pt">必须为</span><span style="color:#ff0000; font-family:等线; font-size:11pt">int</span><span style="color:#ff0000; font-family:宋体; font-size:11pt">类型。</span></h5><h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">1.1.6</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt">按需求查询数据</span></h4><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{1}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt">查询在</span><span style="font-family:等线; font-size:11pt">2017</span><span style="font-family:宋体; font-size:11pt">年</span><span style="font-family:等线; font-size:11pt">4</span><span style="font-family:宋体; font-size:11pt">月份购买过的顾客及总人数</span></h5><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">[1]</span><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:宋体; font-size:11pt">不是计算每人的购买次数。</span></h6><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">select</span><span style="font-family:'Courier New'; font-size:12pt"> </span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">name,</span><span style="color:#ff0000; font-family:'Courier New'; font-size:12pt">count</span><span style="color:#ff0000; font-family:'Courier New'; font-size:12pt">(*) over () </span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">from </span><span style="font-family:'Courier New'; font-size:12pt">business</span><span style="font-family:'Courier New'; font-size:12pt"> </span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">where substring(orderdate,1,7) = '2017-04' </span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">group by name</span><span style="font-family:'Courier New'; font-size:12pt">;</span></p><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">[2]</span><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:宋体; font-size:11pt">如果</span><span style="color:#ff0000; font-family:等线; font-size:11pt">count(*) </span><span style="color:#ff0000; font-family:宋体; font-size:11pt">后面不加</span><span style="color:#ff0000; font-family:等线; font-size:11pt">over</span><span style="color:#ff0000; font-family:等线; font-size:11pt">()</span><span style="color:#ff0000; font-family:宋体; font-size:11pt">，只会计算当前分组的数量，也就是每个人购买的次数。加了</span><span style="color:#ff0000; font-family:等线; font-size:11pt">over</span><span style="color:#ff0000; font-family:宋体; font-size:11pt">，就表示</span><span style="color:#ff0000; font-family:等线; font-size:11pt">count(*) </span><span style="color:#ff0000; font-family:宋体; font-size:11pt">的计算范围是</span><span style="color:#ff0000; font-family:等线; font-size:11pt">over</span><span style="color:#ff0000; font-family:等线; font-size:11pt">()</span><span style="color:#ff0000; font-family:宋体; font-size:11pt">指定的，因为</span><span style="color:#ff0000; font-family:等线; font-size:11pt">over</span><span style="color:#ff0000; font-family:宋体; font-size:11pt">是全部，所以</span><span style="color:#ff0000; font-family:等线; font-size:11pt">count(*) </span><span style="color:#ff0000; font-family:宋体; font-size:11pt">计算全部。并且每一行都添加</span><span style="color:#ff0000; font-family:等线; font-size:11pt">count(*) </span><span style="color:#ff0000; font-family:宋体; font-size:11pt">的值。</span></h6><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{2}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt">查询顾客的购买明细及月购买总额</span></h5><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 49.9pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:'Courier New'; font-size:12pt">select </span><span style="font-family:'Courier New'; font-size:12pt">name,orderdate</span><span style="font-family:'Courier New'; font-size:12pt">,cost,sum(cost) over(partition by month(orderdate)) from </span><span style="font-family:'Courier New'; font-size:12pt">business;</span></p><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">[1]</span><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:宋体; font-size:11pt">此处</span><span style="font-family:等线; font-size:11pt">over</span><span style="font-family:宋体; font-size:11pt">按</span><span style="font-family:宋体; font-size:11pt">月分</span><span style="font-family:宋体; font-size:11pt">区，相当于一个月一</span><span style="font-family:宋体; font-size:11pt">个</span><span style="font-family:宋体; font-size:11pt">窗口</span><span style="font-family:宋体; font-size:11pt">，有多个窗口，</span><span style="font-family:等线; font-size:11pt">sum</span><span style="font-family:等线; font-size:11pt">(cost)</span><span style="font-family:宋体; font-size:11pt">就执行多次。</span></h6><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{3}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt">所有订单按日期排序后，将</span><span style="font-family:等线; font-size:11pt">cost</span><span style="font-family:宋体; font-size:11pt">按照日期进行累加</span></h5><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">[1]</span><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:宋体; font-size:11pt">窗口长度为当前行到起始行，步长为</span><span style="font-family:等线; font-size:11pt">1</span><span style="font-family:宋体; font-size:11pt">，函数为</span><span style="font-family:等线; font-size:11pt">sum</span><span style="font-family:等线; font-size:11pt">(cost)</span></h6><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">[2]</span><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:宋体; font-size:11pt">一个</span><span style="font-family:等线; font-size:11pt">select</span><span style="font-family:宋体; font-size:11pt">列表可以有多个窗口</span></h6><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 52.5pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">select</span><span style="font-family:'Courier New'; font-size:12pt"> </span><span style="font-family:'Courier New'; font-size:12pt">name,orderdate</span><span style="font-family:'Courier New'; font-size:12pt">,cost, </span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 52.5pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">sum(cost) over() as sample1,--</span><span style="font-family:宋体; font-size:12pt">所有行相加</span><span style="font-family:宋体; font-size:12pt"> </span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 52.5pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">sum(cost) over(partition by name) as sample2,--</span><span style="font-family:宋体; font-size:12pt">按</span><span style="font-family:'Courier New'; font-size:12pt">name</span><span style="font-family:宋体; font-size:12pt">分组，组内数据相加</span><span style="font-family:宋体; font-size:12pt"> </span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 52.5pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">sum(cost) over(</span><a name="_Hlk24730041"><span style="font-family:'Courier New'; font-size:12pt">partition by name order by orderdate</span></a><span style="font-family:'Courier New'; font-size:12pt">) as sample3,--</span><span style="font-family:宋体; font-size:12pt">按</span><span style="font-family:'Courier New'; font-size:12pt">name</span><span style="font-family:宋体; font-size:12pt">分组，组内数据累加</span><span style="font-family:宋体; font-size:12pt"> </span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 52.5pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">sum(cost) over(partition by name order by orderdate rows between UNBOUNDED PRECEDING and current row ) as sample4 ,--</span><span style="font-family:宋体; font-size:12pt">和</span><span style="font-family:'Courier New'; font-size:12pt">sample3</span><span style="font-family:宋体; font-size:12pt">一样</span><span style="font-family:'Courier New'; font-size:12pt">,</span><span style="font-family:宋体; font-size:12pt">由起点到当前行的聚合</span><span style="font-family:宋体; font-size:12pt"> </span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 52.5pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">sum(cost) over(partition by name order by orderdate rows between 1 PRECEDING and current row) as sample5, --</span><span style="font-family:宋体; font-size:12pt">当前行和前面一行做聚合</span><span style="font-family:宋体; font-size:12pt"> </span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 52.5pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">sum(cost) over(partition by name order by orderdate rows between 1 PRECEDING AND 1 FOLLOWING ) as sample6,--</span><span style="font-family:宋体; font-size:12pt">当前行和前边一行及后面一行</span><span style="font-family:宋体; font-size:12pt"> </span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 52.5pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">sum(cost) over(partition by name order by orderdate rows between current row and UNBOUNDED FOLLOWING ) as sample7 --</span><span style="font-family:宋体; font-size:12pt">当前行及后面所有行</span><span style="font-family:宋体; font-size:12pt"> </span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 52.5pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">from </span><span style="font-family:'Courier New'; font-size:12pt">business</span><span style="font-family:'Courier New'; font-size:12pt">;</span></p><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{4}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt">查看顾客上次的购买时间</span></h5><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">[1]</span><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:宋体; font-size:11pt">在一行订单中把该用户上次购买时间设置上</span></h6><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">[2]</span><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:宋体; font-size:11pt">窗口为当前行的前一行，不用聚合函数，直接输出</span><span style="font-family:等线; font-size:11pt">date</span><span style="font-family:宋体; font-size:11pt">。或者使用</span><span style="font-family:宋体; font-size:11pt"> </span><span style="font-family:等线; font-size:11pt">lag</span></h6><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">select </span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">name,orderdate</span><span style="font-family:'Courier New'; font-size:12pt">,cost, </span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">lag(orderdate,1,'1900-01-01') </span><span style="font-family:'Courier New'; font-size:12pt">over(</span><span style="font-family:'Courier New'; font-size:12pt">partition by name order by orderdate ) as time1, </span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">lag(orderdate,2) over (partition by name order by orderdate) as time2 </span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">from </span><span style="font-family:'Courier New'; font-size:12pt">business</span><span style="font-family:'Courier New'; font-size:12pt">;</span></p><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{5}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt">查询前</span><span style="font-family:等线; font-size:11pt">20%</span><span style="font-family:等线; font-size:11pt"> </span><span style="font-family:宋体; font-size:11pt">时间的订单信息</span></h5><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">[1]</span><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:宋体; font-size:11pt">用来计算</span><span style="font-family:等线; font-size:11pt">top</span></h6><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">[2]</span><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:宋体; font-size:11pt">给窗口函数关联的函数设置别名，要放在</span><span style="font-family:等线; font-size:11pt">over</span><span style="font-family:宋体; font-size:11pt">后面</span></h6><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">[3]</span><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:宋体; font-size:11pt">窗口函数关联函数查出的</span><span style="font-family:宋体; font-size:11pt">列不能</span><span style="font-family:宋体; font-size:11pt">直接用</span><span style="font-family:等线; font-size:11pt">where</span><span style="font-family:宋体; font-size:11pt">，要放在子查询中用</span><span style="font-family:等线; font-size:11pt">where</span></h6><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">[4]</span><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:宋体; font-size:11pt">按时间排序后用</span><span style="color:#ff0000; font-family:等线; font-size:11pt">ntile</span><span style="font-family:宋体; font-size:11pt">分成</span><span style="font-family:等线; font-size:11pt">5</span><span style="font-family:宋体; font-size:11pt">组，则第一组就是前</span><span style="font-family:等线; font-size:11pt">20%</span></h6><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">select * from (</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">    select </span><span style="font-family:'Courier New'; font-size:12pt">name,orderdate</span><span style="font-family:'Courier New'; font-size:12pt">,cost, ntile(5) over(order by orderdate) </span><span style="background-color:#ffff00; font-family:'Courier New'; font-size:12pt">sorted</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">    from business</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">) t</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">where sorted = 1;</span></p><h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt; font-style:normal">1.2</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt; font-weight:bold">排名</span></h3><h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">1.2.1</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:等线; font-size:11pt">src</span></h4><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{1}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt">用来给排序后的</span><span style="font-family:宋体; font-size:11pt">表设置</span><span style="font-family:宋体; font-size:11pt">序号</span></h5><h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">1.2.2</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:等线; font-size:11pt">usage</span></h4><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{1}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt">个</span><span style="font-family:宋体; font-size:11pt">论</span></h5><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">[1]</span><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:等线; font-size:11pt">RANK</span><span style="font-family:等线; font-size:11pt">() </span><span style="font-family:宋体; font-size:11pt">排序</span><span style="font-family:宋体; font-size:11pt">依据</span><span style="font-family:宋体; font-size:11pt">相同时，</span><span style="font-family:宋体; font-size:11pt">排名会重复，序号会跳跃</span><span style="font-family:宋体; font-size:11pt"> </span><span style="font-family:等线; font-size:11pt">113</span></h6><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">[2]</span><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:等线; font-size:11pt">DENSE_RANK</span><span style="font-family:等线; font-size:11pt">()</span><span style="font-family:等线; font-size:11pt"> </span><span style="font-family:宋体; font-size:11pt">排序相同时，</span><span style="font-family:宋体; font-size:11pt">排名会重复，不会跳跃，最大序号会变小</span><span style="font-family:宋体; font-size:11pt"> </span><span style="font-family:等线; font-size:11pt">112</span></h6><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">[3]</span><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:等线; font-size:11pt">ROW_NUMBER</span><span style="font-family:等线; font-size:11pt">() </span><span style="font-family:宋体; font-size:11pt">会根据顺序计算</span><span style="font-family:宋体; font-size:11pt">，不会重复，不会跳跃</span><span style="font-family:宋体; font-size:11pt"> </span><span style="font-family:等线; font-size:11pt">123</span></h6><p style="line-height:10.5pt; margin:7.8pt 0pt; text-indent:73.5pt"><img src="e47d4dce-ad87-4c89-863a-a523d6e65b80.001.png" width="402" height="141" alt="" style="-aw-left-pos:0pt; -aw-rel-hpos:column; -aw-rel-vpos:paragraph; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{2}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt">后面必须跟</span><span style="font-family:等线; font-size:11pt">over</span><span style="font-family:宋体; font-size:11pt">，也就是说，必须在窗口函数中执行。排序依据就是</span><span style="font-family:等线; font-size:11pt">over</span><span style="font-family:宋体; font-size:11pt">中的排序依据</span></h5><p style="line-height:10.5pt; margin:7.8pt 0pt; text-indent:63pt"><img src="e47d4dce-ad87-4c89-863a-a523d6e65b80.002.png" width="830" height="47" alt="" style="-aw-left-pos:0pt; -aw-rel-hpos:column; -aw-rel-vpos:paragraph; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">1.2.3</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt">数据准备</span></h4><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">name</span><span style="width:13.2pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Courier New'; font-size:12pt">subject</span><span style="width:12.59pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Courier New'; font-size:12pt">score</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">孙悟空</span><span style="width:6pt; text-indent:0pt; display:inline-block"></span><span style="font-family:宋体; font-size:12pt">语文</span><span style="width:18pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Courier New'; font-size:12pt">87</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">孙悟空</span><span style="width:6pt; text-indent:0pt; display:inline-block"></span><span style="font-family:宋体; font-size:12pt">数学</span><span style="width:18pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Courier New'; font-size:12pt">95</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">孙悟空</span><span style="width:6pt; text-indent:0pt; display:inline-block"></span><span style="font-family:宋体; font-size:12pt">英语</span><span style="width:18pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Courier New'; font-size:12pt">68</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">大海</span><span style="width:18pt; text-indent:0pt; display:inline-block"></span><span style="font-family:宋体; font-size:12pt">语文</span><span style="width:18pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Courier New'; font-size:12pt">94</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">大海</span><span style="width:18pt; text-indent:0pt; display:inline-block"></span><span style="font-family:宋体; font-size:12pt">数学</span><span style="width:18pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Courier New'; font-size:12pt">56</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">大海</span><span style="width:18pt; text-indent:0pt; display:inline-block"></span><span style="font-family:宋体; font-size:12pt">英语</span><span style="width:18pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Courier New'; font-size:12pt">84</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">宋</span><span style="font-family:宋体; font-size:12pt">宋</span><span style="width:18pt; text-indent:0pt; display:inline-block"></span><span style="font-family:宋体; font-size:12pt">语文</span><span style="width:18pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Courier New'; font-size:12pt">64</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">宋</span><span style="font-family:宋体; font-size:12pt">宋</span><span style="width:18pt; text-indent:0pt; display:inline-block"></span><span style="font-family:宋体; font-size:12pt">数学</span><span style="width:18pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Courier New'; font-size:12pt">86</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">宋</span><span style="font-family:宋体; font-size:12pt">宋</span><span style="width:18pt; text-indent:0pt; display:inline-block"></span><span style="font-family:宋体; font-size:12pt">英语</span><span style="width:18pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Courier New'; font-size:12pt">84</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">婷婷</span><span style="width:18pt; text-indent:0pt; display:inline-block"></span><span style="font-family:宋体; font-size:12pt">语文</span><span style="width:18pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Courier New'; font-size:12pt">65</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">婷婷</span><span style="width:18pt; text-indent:0pt; display:inline-block"></span><span style="font-family:宋体; font-size:12pt">数学</span><span style="width:18pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Courier New'; font-size:12pt">85</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">婷婷</span><span style="width:18pt; text-indent:0pt; display:inline-block"></span><span style="font-family:宋体; font-size:12pt">英语</span><span style="width:18pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Courier New'; font-size:12pt">78</span></p><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{1}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt">创建本地</span><span style="font-family:等线; font-size:11pt">movie.txt</span><span style="font-family:宋体; font-size:11pt">，导入数据</span></h5><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 63pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:'Courier New'; font-size:12pt">[dc@hadoop102 </span><span style="font-family:'Courier New'; font-size:12pt">datas]$</span><span style="font-family:'Courier New'; font-size:12pt"> vi score.txt</span></p><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{2}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt">创建</span><span style="font-family:等线; font-size:11pt">hive</span><span style="font-family:宋体; font-size:11pt">表并导入数据</span></h5><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">create table </span><span style="font-family:'Courier New'; font-size:12pt">score(</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">name string,</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">subject string, </span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">score int) </span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">row format delimited fields terminated by "\t";</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 84pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">load data local inpath '/opt/module/datas/score.txt' into table score;</span></p><h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">1.2.4</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt">需求</span></h4><p style="font-size:11pt; line-height:150%; margin:7.8pt 0pt 7.8pt 60pt; text-indent:3pt"><span style="font-family:等线; font-size:11pt">计算每门学科成绩排名</span></p><h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">1.2.5</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt">按需求查询数据</span></h4><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{1}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt">一个</span><span style="font-family:等线; font-size:11pt">select</span><span style="font-family:宋体; font-size:11pt">列表可设置多个窗口</span></h5><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 73.5pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">select name,</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 73.5pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">subject,</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 73.5pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">score,</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 73.5pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">rank(</span><span style="font-family:'Courier New'; font-size:12pt">) over(partition by subject order by score desc) rp,</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 73.5pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">dense_</span><span style="font-family:'Courier New'; font-size:12pt">rank(</span><span style="font-family:'Courier New'; font-size:12pt">) over(partition by subject order by score desc) drp,</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 73.5pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">row_</span><span style="font-family:'Courier New'; font-size:12pt">number(</span><span style="font-family:'Courier New'; font-size:12pt">) over(partition by subject order by score desc) rmp</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 73.5pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">from score;</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 73.5pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">&#xa0;</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 73.5pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">name    subject score   rp      drp     rmp</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 73.5pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">孙悟空</span><span style="font-family:宋体; font-size:12pt">  </span><span style="font-family:宋体; font-size:12pt">数学</span><span style="font-family:宋体; font-size:12pt">    </span><span style="font-family:'Courier New'; font-size:12pt">95      </span><span style="width:17.68pt; text-indent:0pt; display:inline-block"></span><span style="width:21pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Courier New'; font-size:12pt">1       1       </span><span style="font-family:'Courier New'; font-size:12pt">1</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 73.5pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">宋</span><span style="font-family:宋体; font-size:12pt">宋</span><span style="font-family:宋体; font-size:12pt">    </span><span style="font-family:宋体; font-size:12pt">数学</span><span style="font-family:宋体; font-size:12pt">    </span><span style="font-family:'Courier New'; font-size:12pt">86      </span><span style="width:15.28pt; text-indent:0pt; display:inline-block"></span><span style="width:21pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Courier New'; font-size:12pt">2       2       </span><span style="font-family:'Courier New'; font-size:12pt">2</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 73.5pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">婷婷</span><span style="font-family:宋体; font-size:12pt">    </span><span style="font-family:宋体; font-size:12pt">数学</span><span style="font-family:宋体; font-size:12pt">    </span><span style="font-family:'Courier New'; font-size:12pt">85      </span><span style="width:15.28pt; text-indent:0pt; display:inline-block"></span><span style="width:21pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Courier New'; font-size:12pt">3       3       </span><span style="font-family:'Courier New'; font-size:12pt">3</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 73.5pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">大海</span><span style="font-family:宋体; font-size:12pt">    </span><span style="font-family:宋体; font-size:12pt">数学</span><span style="font-family:宋体; font-size:12pt">    </span><span style="font-family:'Courier New'; font-size:12pt">56      </span><span style="width:15.28pt; text-indent:0pt; display:inline-block"></span><span style="width:21pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Courier New'; font-size:12pt">4       4       </span><span style="font-family:'Courier New'; font-size:12pt">4</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 73.5pt; orphans:0; text-align:justify; widows:0"><span style="color:#ff0000; font-family:宋体; font-size:12pt">宋</span><span style="color:#ff0000; font-family:宋体; font-size:12pt">宋</span><span style="color:#ff0000; font-family:宋体; font-size:12pt">    </span><span style="color:#ff0000; font-family:宋体; font-size:12pt">英语</span><span style="color:#ff0000; font-family:宋体; font-size:12pt">    </span><span style="color:#ff0000; font-family:'Courier New'; font-size:12pt">84      </span><span style="width:15.28pt; text-indent:0pt; display:inline-block"></span><span style="width:21pt; text-indent:0pt; display:inline-block"></span><span style="color:#ff0000; font-family:'Courier New'; font-size:12pt">1       1       </span><span style="color:#ff0000; font-family:'Courier New'; font-size:12pt">1</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 73.5pt; orphans:0; text-align:justify; widows:0"><span style="color:#ff0000; font-family:宋体; font-size:12pt">大海</span><span style="color:#ff0000; font-family:宋体; font-size:12pt">    </span><span style="color:#ff0000; font-family:宋体; font-size:12pt">英语</span><span style="color:#ff0000; font-family:宋体; font-size:12pt">    </span><span style="color:#ff0000; font-family:'Courier New'; font-size:12pt">84      </span><span style="width:15.28pt; text-indent:0pt; display:inline-block"></span><span style="width:21pt; text-indent:0pt; display:inline-block"></span><span style="color:#ff0000; font-family:'Courier New'; font-size:12pt">1       1       </span><span style="color:#ff0000; font-family:'Courier New'; font-size:12pt">2</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 73.5pt; orphans:0; text-align:justify; widows:0"><span style="color:#ff0000; font-family:宋体; font-size:12pt">婷婷</span><span style="color:#ff0000; font-family:宋体; font-size:12pt">    </span><span style="color:#ff0000; font-family:宋体; font-size:12pt">英语</span><span style="color:#ff0000; font-family:宋体; font-size:12pt">    </span><span style="color:#ff0000; font-family:'Courier New'; font-size:12pt">78      </span><span style="width:15.28pt; text-indent:0pt; display:inline-block"></span><span style="width:21pt; text-indent:0pt; display:inline-block"></span><span style="color:#ff0000; font-family:'Courier New'; font-size:12pt">3       2       3</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 73.5pt; orphans:0; text-align:justify; widows:0"><span style="color:#ff0000; font-family:宋体; font-size:12pt">孙悟空</span><span style="color:#ff0000; font-family:宋体; font-size:12pt">  </span><span style="color:#ff0000; font-family:宋体; font-size:12pt">英语</span><span style="color:#ff0000; font-family:宋体; font-size:12pt">    </span><span style="color:#ff0000; font-family:'Courier New'; font-size:12pt">68      </span><span style="width:17.68pt; text-indent:0pt; display:inline-block"></span><span style="width:21pt; text-indent:0pt; display:inline-block"></span><span style="color:#ff0000; font-family:'Courier New'; font-size:12pt">4       3       4</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 73.5pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">大海</span><span style="font-family:宋体; font-size:12pt">    </span><span style="font-family:宋体; font-size:12pt">语文</span><span style="font-family:宋体; font-size:12pt">    </span><span style="font-family:'Courier New'; font-size:12pt">94      </span><span style="width:15.28pt; text-indent:0pt; display:inline-block"></span><span style="width:21pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Courier New'; font-size:12pt">1       1       </span><span style="font-family:'Courier New'; font-size:12pt">1</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 73.5pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">孙悟空</span><span style="font-family:宋体; font-size:12pt">  </span><span style="font-family:宋体; font-size:12pt">语文</span><span style="font-family:宋体; font-size:12pt">    </span><span style="font-family:'Courier New'; font-size:12pt">87      </span><span style="width:17.68pt; text-indent:0pt; display:inline-block"></span><span style="width:21pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Courier New'; font-size:12pt">2       2       </span><span style="font-family:'Courier New'; font-size:12pt">2</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 73.5pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">婷婷</span><span style="font-family:宋体; font-size:12pt">    </span><span style="font-family:宋体; font-size:12pt">语文</span><span style="font-family:宋体; font-size:12pt">    </span><span style="font-family:'Courier New'; font-size:12pt">65      </span><span style="width:15.28pt; text-indent:0pt; display:inline-block"></span><span style="width:21pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Courier New'; font-size:12pt">3       3       </span><span style="font-family:'Courier New'; font-size:12pt">3</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 73.5pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">宋</span><span style="font-family:宋体; font-size:12pt">宋</span><span style="font-family:宋体; font-size:12pt">    </span><span style="font-family:宋体; font-size:12pt">语文</span><span style="font-family:宋体; font-size:12pt">    </span><span style="font-family:'Courier New'; font-size:12pt">64      </span><span style="width:15.28pt; text-indent:0pt; display:inline-block"></span><span style="width:21pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Courier New'; font-size:12pt">4       4       </span><span style="font-family:'Courier New'; font-size:12pt">4</span></p><h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt; font-style:normal">1.3</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:等线; font-size:11pt; font-weight:bold">Lateral</span><span style="font-family:等线; font-size:11pt; font-weight:bold"> View</span></h3><h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">1.3.1</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="background-color:#ffffff; color:#333333; font-family:宋体; font-size:10.5pt">一个语句生成把单行数据拆解成多行后的数据结果集</span></h4><h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">1.3.2</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:等线; font-size:11pt">lateral view explode(</span><span style="font-family:宋体; font-size:11pt">列名</span><span style="font-family:等线; font-size:11pt">)  lateral view</span><span style="font-family:宋体; font-size:11pt">把</span><span style="font-family:等线; font-size:11pt">explode</span><span style="font-family:宋体; font-size:11pt">分解产生的数组转成一个多行的虚拟表</span></h4><h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">1.3.3</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:等线; font-size:11pt">syntax</span></h4><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 63pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">LATERAL VIEW udtf(expression) tableAlias AS columnAlias (','</span><span style="font-family:'Courier New'; font-size:12pt">&#xa0;</span><span style="font-family:'Courier New'; font-size:12pt">columnAlias)*</span></p><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 63pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">select </span><span style="font-family:宋体; font-size:12pt">虚拟表的列名</span><span style="font-family:'Courier New'; font-size:12pt">from explode_lateral_view LATERAL VIEW explode(split(</span><span style="font-family:宋体; font-size:12pt">要拆的列名</span><span style="font-family:'Courier New'; font-size:12pt">,',')) </span><span style="font-family:宋体; font-size:12pt">虚拟表表名</span><span style="font-family:宋体; font-size:12pt"> </span><span style="font-family:'Courier New'; font-size:12pt">as </span><span style="font-family:宋体; font-size:12pt">虚拟表的列名</span><span style="font-family:'Courier New'; font-size:12pt">;</span></p><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{1}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt">可以有多个</span><span style="font-family:等线; font-size:11pt">lve</span></h5><p style="background-color:#e0e0e0; line-height:12pt; margin:0pt 0pt 0pt 63pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Courier New'; font-size:12pt">select mycol1, mycol2 from basetable</span><br /><span style="font-family:'Courier New'; font-size:12pt">lateral view </span><span style="font-family:'Courier New'; font-size:12pt">explode</span><span style="font-family:'Courier New'; font-size:12pt">(col1) mytable1 as mycol1</span><br /><span style="font-family:'Courier New'; font-size:12pt">lateral view explode(col2) mytable2 as mycol2;</span></p><p style="line-height:10.5pt; margin:7.8pt 0pt"><span style="font-family:等线; font-size:10.5pt">&#xa0;</span></p></div></body></html>