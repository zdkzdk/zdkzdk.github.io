<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta http-equiv="Content-Style-Type" content="text/css"/>
    <meta name="generator" content="Aspose.Words for .NET 15.1.0.0"/>
    <title></title></head>
<body>
<div><p style="line-height:12pt; margin:7.8pt 0pt"><span style="font-family:等线; font-size:12pt">overview：官方文档中的描述实际上比百度上绝大多数的</span><span
        style="font-family:等线; font-size:12pt">博客写</span><span style="font-family:等线; font-size:12pt">的要好，很全面，所以把集群配置、安全模式、HA部分翻译一下</span>
</p>
    <h1 style="margin:12pt 0pt 0pt 35.4pt; page-break-after:avoid; page-break-inside:avoid; text-indent:0pt"><span
            style="display:inline; font-family:宋体; font-size:14pt; font-style:normal; font-variant:normal; font-weight:bold; text-decoration:none; text-transform:none; vertical-align:baseline">一、</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:'等线 Light'; font-size:14pt; font-weight:bold">Hadoop</span><span
            style="font-family:'等线 Light'; font-size:14pt; font-weight:bold"> </span><span
            style="font-family:宋体; font-size:14pt; font-weight:bold">集群配置</span></h1>
    <h2 style="margin:0pt 0pt 6pt 14.15pt; text-indent:0pt"><span
            style="font-family:等线; font-size:14pt; font-style:normal">1.</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">目标</span></h2>
    <h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt; font-style:normal">1.1</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">这个文档描述了怎样安装和配置从几个节点到几千节点的</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">hadoop</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">集群，为了能够更好的使用</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">hadoop</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">，你可能需要先在单节点上实验一下。</span></h3>
    <h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt; font-style:normal">1.2</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">当前文档不包括高级</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">功能</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">比如安全</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">和</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">HA</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">的内容</span></h3>
    <h2 style="margin:0pt 0pt 6pt 14.15pt; text-indent:0pt"><span
            style="font-family:等线; font-size:14pt; font-style:normal">2.</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">准备</span></h2>
    <h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt; font-style:normal">2.1</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">安装</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">java</span></h3>
    <h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt; font-style:normal">2.2</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">从</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">apache</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">镜像</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">下载</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">稳定版</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">的</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">hadoop</span></h3>
    <h2 style="margin:0pt 0pt 6pt 14.15pt; text-indent:0pt"><span
            style="font-family:等线; font-size:14pt; font-style:normal">3.</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">安装</span></h2>
    <h2 style="margin:0pt 0pt 6pt 14.15pt; text-indent:0pt"><span
            style="font-family:等线; font-size:14pt; font-style:normal">4.</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">非安全</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">模式</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">下</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">配置</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">hadoop</span></h2>
    <h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt; font-style:normal">4.1</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">Hadoop</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">的</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">Java</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">配置是由两种类型的重要配置文件驱动</span></h3><h4
            style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span
            style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">4.1.1</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt">只读的默认配文，这个文件</span><span style="font-family:宋体; font-size:11pt">原则上不需要修改</span>
    </h4><h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span
            style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">4.1.2</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:等线; font-size:11pt">site-specific</span><span
            style="font-family:宋体; font-size:11pt">配文</span><span style="font-family:宋体; font-size:11pt">，用户用来自定义配置的，优先级比</span><span
            style="font-family:等线; font-size:11pt">default</span><span style="font-family:宋体; font-size:11pt">高</span>
    </h4>
    <h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt; font-style:normal">4.2</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">另外，也可以通过发行版的</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">bin</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">目录中的</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">hadoop</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">脚本</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">比如</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">etc/hadoop/hadoop-env.sh</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">和</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold"> </span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">etc/hadoop/yarn-env.sh</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">来配置</span></h3>
    <h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt; font-style:normal">4.3</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">要配置</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">Hadoop</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">集群，</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">有</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">2</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">处需要配置，</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold"> </span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">Hadoop</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">守护</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">进程</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">执行的环境以及</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">Hadoop</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">守护程序的配置参数。</span></h3>
    <h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt; font-style:normal">4.4</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">HDFS</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">守护程序是</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">NameNode</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">，</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">SecondaryNameNode</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">和</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">DataNode</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">。</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold"> </span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">YARN</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">进程是</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">是</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">ResourceManager</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">，</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">NodeManager</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">和</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">WebAppProxy</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">。</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold"> </span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">如果使用</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">MapReduce</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">，则</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">MapReduce</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">作业历史服务器也将运行。</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold"> </span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">对于大型</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">项目</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">，它们通常在单独的</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">节点</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">上运行</span></h3>
    <h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt; font-style:normal">4.5</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">Hadoop</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">守护</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">进程</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">执行的环境</span></h3><h4
            style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span
            style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">4.5.1</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt">使用</span><span style="font-family:等线; font-size:11pt">etc/hadoop/hadoop-env.sh</span><span
            style="font-family:宋体; font-size:11pt">和可选的</span><span style="font-family:等线; font-size:11pt">etc/hadoop/mapred-env.sh</span><span
            style="font-family:等线; font-size:11pt">&#xa0;</span><span
            style="font-family:等线; font-size:11pt">and</span><span
            style="font-family:等线; font-size:11pt">&#xa0;</span><span style="font-family:等线; font-size:11pt">etc/hadoop/yarn-env.sh</span><span
            style="font-family:宋体; font-size:11pt">脚本来</span><span style="font-family:宋体; font-size:11pt">设置</span><span
            style="font-family:宋体; font-size:11pt">自定义的</span><span
            style="font-family:等线; font-size:11pt">site-specific </span><span
            style="font-family:宋体; font-size:11pt">的</span><span
            style="font-family:等线; font-size:11pt">hadoop</span><span
            style="font-family:宋体; font-size:11pt">守护进程环境</span></h4><h4
            style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span
            style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">4.5.2</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt">至少，要在每</span><span
            style="font-family:宋体; font-size:11pt">个</span><span style="font-family:宋体; font-size:11pt">远程节点指定正确的</span><span
            style="font-family:等线; font-size:11pt">JAVA_HOME</span></h4><h4
            style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span
            style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">4.5.3</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt">可以使用如下的配置来配置独立的守护进程</span></h4>
    <p style="line-height:10.5pt; margin:7.8pt 0pt; text-indent:84pt"><img
            src="490aed95-6907-4a81-92ec-91d677c2cb20.001.png" width="741" height="163" alt=""
            style="-aw-left-pos:0pt; -aw-rel-hpos:column; -aw-rel-vpos:paragraph; -aw-top-pos:0pt; -aw-wrap-type:inline"/>
    </p><h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span
            style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">4.5.4</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt">例如，让</span><span
            style="font-family:等线; font-size:11pt">NN</span><span style="font-family:宋体; font-size:11pt">并行的</span><span
            style="font-family:等线; font-size:11pt">GC</span><span style="font-family:宋体; font-size:11pt">，则要</span><span
            style="font-family:宋体; font-size:11pt">在</span><span
            style="font-family:等线; font-size:11pt">hadoop-env.sh</span><span style="font-family:宋体; font-size:11pt">添加如下的配置</span>
    </h4>
    <p style="background-color:#ffffff; margin:6pt 0pt"><span
            style="width:45.8pt; text-indent:0pt; display:inline-block; -aw-tabstop-align:left; -aw-tabstop-pos:45.8pt"></span><span
            style="width:35.7pt; text-indent:0pt; display:inline-block; -aw-tabstop-align:left; -aw-tabstop-pos:81.5pt"></span><span
            style="font-family:宋体; font-size:10pt">export HADOOP_NAMENODE_OPTS="-</span><span
            style="font-family:宋体; font-size:10pt">XX:+</span><span style="font-family:宋体; font-size:10pt">UseParallelGC"</span>
    </p>
    <h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt; font-style:normal">4.6</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">Hadoop</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">守护</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">进程的配置参数</span></h3><h4
            style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span
            style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">4.6.1</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:等线; font-size:11pt">etc/hadoop/core-site.xml</span><span
            style="font-family:等线; font-size:11pt">  </span><span style="font-family:宋体; font-size:11pt">核心配置，也就是</span><span
            style="font-family:等线; font-size:11pt">hadoop</span><span style="font-family:宋体; font-size:11pt">的配置</span>
    </h4>
    <table cellspacing="0" cellpadding="0" style="border-collapse:collapse; margin-left:99.25pt; width:637.85pt">
        <thead>
        <tr>
            <td style="background-color:#bbbbbb; padding:1.5pt 3pt; vertical-align:top; width:141.05pt"><p
                    style="margin:0pt"><span
                    style="color:#ffffff; font-family:Verdana; font-size:10.5pt; font-weight:bold">Parameter</span></p>
            </td>
            <td style="background-color:#bbbbbb; padding:1.5pt 3pt; vertical-align:top"><p
                    style="line-height:10.5pt; margin:7.8pt 0pt"><span
                    style="color:#ffffff; font-family:Verdana; font-size:10.5pt; font-weight:bold">Value</span></p></td>
            <td style="background-color:#bbbbbb; padding:1.5pt 3pt; vertical-align:top; width:331.55pt"><p
                    style="line-height:10.5pt; margin:7.8pt 0pt"><span
                    style="color:#ffffff; font-family:Verdana; font-size:10.5pt; font-weight:bold">Notes</span></p></td>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td style="background-color:#eeeeee; padding:1.5pt 3pt; vertical-align:top; width:141.05pt"><p
                    style="line-height:10.5pt; margin:7.8pt 0pt"><span
                    style="color:#333333; font-family:宋体; font-size:10.5pt">fs.defaultFS</span></p></td>
            <td style="background-color:#eeeeee; padding:1.5pt 3pt; vertical-align:top"><p
                    style="line-height:10.5pt; margin:7.8pt 0pt"><span
                    style="color:#333333; font-family:Verdana; font-size:10.5pt">NameNode URI</span></p></td>
            <td style="background-color:#eeeeee; padding:1.5pt 3pt; vertical-align:top; width:331.55pt"><p
                    style="line-height:10.5pt; margin:7.8pt 0pt"><a style="color:#6688aa" href="hdfs://host:port/"><span
                    style="color:#6688aa; font-family:Verdana; font-size:10.5pt; text-decoration:underline">hdfs://host:port/</span></a>
            </p></td>
        </tr>
        <tr>
            <td style="background-color:#dddddd; padding:1.5pt 3pt; vertical-align:top; width:141.05pt"><p
                    style="line-height:10.5pt; margin:7.8pt 0pt"><span
                    style="color:#333333; font-family:宋体; font-size:10.5pt">io.file</span><span
                    style="color:#333333; font-family:宋体; font-size:10.5pt">.buffer.size</span></p></td>
            <td style="background-color:#dddddd; padding:1.5pt 3pt; vertical-align:top"><p
                    style="line-height:10.5pt; margin:7.8pt 0pt"><span
                    style="color:#333333; font-family:Verdana; font-size:10.5pt">131072</span></p></td>
            <td style="background-color:#dddddd; padding:1.5pt 3pt; vertical-align:top; width:331.55pt"><p
                    style="line-height:10.5pt; margin:7.8pt 0pt"><span
                    style="color:#333333; font-family:Verdana; font-size:10.5pt">Size of read/write buffer used in SequenceFiles.</span>
            </p></td>
        </tr>
        </tbody>
    </table>
    <h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span
            style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">4.6.2</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:等线; font-size:11pt">etc/hadoop/hdfs-site.xml</span><span
            style="font-family:等线; font-size:11pt">    </span><span
            style="font-family:等线; font-size:14pt">hdfs</span><span
            style="font-family:宋体; font-size:14pt">的站点配置</span><span
            style="font-family:宋体; font-size:14pt">，也就是</span><span
            style="font-family:等线; font-size:14pt">hdfs</span><span style="font-family:宋体; font-size:14pt">的配置</span>
    </h4><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">{1}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:等线; font-size:11pt">NN</span><span style="font-family:宋体; font-size:11pt">的</span></h5>
    <table cellspacing="0" cellpadding="0" style="border-collapse:collapse; margin-left:85.05pt; width:750.45pt">
        <thead>
        <tr>
            <td style="background-color:#bbbbbb; padding:1.5pt 3pt; vertical-align:top; width:69.45pt"><p
                    style="margin:0pt"><span
                    style="color:#ffffff; font-family:Verdana; font-size:10.5pt; font-weight:bold">Parameter</span></p>
            </td>
            <td style="background-color:#bbbbbb; padding:1.5pt 3pt; vertical-align:top"><p style="margin:0pt"><span
                    style="color:#ffffff; font-family:Verdana; font-size:10.5pt; font-weight:bold">Value</span></p></td>
            <td style="background-color:#bbbbbb; padding:1.5pt 3pt; vertical-align:top"><p style="margin:0pt"><span
                    style="color:#ffffff; font-family:Verdana; font-size:10.5pt; font-weight:bold">Notes</span></p></td>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td style="background-color:#eeeeee; padding:1.5pt 3pt; vertical-align:top; width:69.45pt"><p
                    style="margin:0pt"><span style="color:#333333; font-family:宋体; font-size:10.5pt">dfs.namenode.name.dir</span>
            </p></td>
            <td style="background-color:#eeeeee; padding:1.5pt 3pt; vertical-align:top"><p style="margin:0pt"><span
                    style="color:#333333; font-family:Verdana; font-size:10.5pt">NameNode </span><span
                    style="color:#333333; font-family:宋体; font-size:10.5pt">的持久化目录</span></p>
                <p style="margin:0pt"><span style="color:#333333; font-family:宋体; font-size:10.5pt">在</span><span
                        style="color:#333333; font-family:宋体; font-size:10.5pt"> </span><span
                        style="color:#333333; font-family:Verdana; font-size:10.5pt">local filesystem</span><span
                        style="color:#333333; font-family:宋体; font-size:10.5pt">保存</span><span
                        style="color:#333333; font-family:宋体; font-size:10.5pt"> </span><span
                        style="color:#333333; font-family:Verdana; font-size:10.5pt">namespace and transactions logs persistently</span><span
                        style="color:#333333; font-family:宋体; font-size:10.5pt">的</span><span
                        style="color:#333333; font-family:Verdana; font-size:10.5pt">Path </span></p></td>
            <td style="background-color:#eeeeee; padding:1.5pt 3pt; vertical-align:top"><p style="margin:0pt"><span
                    style="color:#333333; font-family:宋体; font-size:10.5pt">如果是都好分隔的，会冗余存储</span><span
                    style="color:#333333; font-family:宋体; font-size:10.5pt">，也就是多目录配置，虽然冗余，但可靠性提高</span></p></td>
        </tr>
        <tr>
            <td style="background-color:#dddddd; padding:1.5pt 3pt; vertical-align:top; width:69.45pt"><p
                    style="margin:0pt"><span
                    style="color:#333333; font-family:宋体; font-size:10.5pt">dfs.hosts</span><span
                    style="color:#333333; font-family:Verdana; font-size:10.5pt">&#xa0;</span><span
                    style="color:#333333; font-family:Verdana; font-size:10.5pt">/</span></p></td>
            <td style="background-color:#dddddd; padding:1.5pt 3pt; vertical-align:top"><p style="margin:0pt"><span
                    style="color:#333333; font-family:宋体; font-size:10.5pt">白名单</span></p></td>
            <td style="background-color:#dddddd; padding:1.5pt 3pt; vertical-align:top"><p style="margin:0pt"><span
                    style="color:#333333; font-family:宋体; font-size:10.5pt">为空表示全都可以，不为</span><span
                    style="color:#333333; font-family:宋体; font-size:10.5pt">空只认设置</span><span
                    style="color:#333333; font-family:宋体; font-size:10.5pt">的</span></p></td>
        </tr>
        <tr>
            <td style="background-color:#dddddd; padding:1.5pt 3pt; vertical-align:top; width:69.45pt"><p
                    style="margin:0pt"><span
                    style="color:#333333; font-family:宋体; font-size:10.5pt">dfs.hosts</span><span
                    style="color:#333333; font-family:宋体; font-size:10.5pt">.exclude</span></p></td>
            <td style="background-color:#dddddd; padding:1.5pt 3pt; vertical-align:top"><p style="margin:0pt"><span
                    style="color:#333333; font-family:宋体; font-size:10.5pt">黑名单</span></p></td>
            <td style="background-color:#dddddd; padding:1.5pt 3pt; vertical-align:top"><p style="margin:0pt"><span
                    style="color:#333333; font-family:宋体; font-size:10.5pt">加入意味着不能加入集群，会强制下线，下线前会复制数据</span></p></td>
        </tr>
        <tr>
            <td style="background-color:#eeeeee; padding:1.5pt 3pt; vertical-align:top; width:69.45pt"><p
                    style="margin:0pt"><span
                    style="color:#333333; font-family:宋体; font-size:10.5pt">dfs.blocksize</span></p></td>
            <td style="background-color:#eeeeee; padding:1.5pt 3pt; vertical-align:top"><p style="margin:0pt"><span
                    style="color:#333333; font-family:Verdana; font-size:10.5pt">268435456</span></p></td>
            <td style="background-color:#eeeeee; padding:1.5pt 3pt; vertical-align:top"><p style="margin:0pt"><span
                    style="color:#333333; font-family:宋体; font-size:10.5pt">块大小</span></p></td>
        </tr>
        <tr>
            <td style="background-color:#dddddd; padding:1.5pt 3pt; vertical-align:top; width:69.45pt"><p
                    style="margin:0pt"><span style="color:#333333; font-family:宋体; font-size:10.5pt">dfs.namenode</span><span
                    style="color:#333333; font-family:宋体; font-size:10.5pt">.handler.count</span></p></td>
            <td style="background-color:#dddddd; padding:1.5pt 3pt; vertical-align:top"><p style="margin:0pt"><span
                    style="color:#333333; font-family:Verdana; font-size:10.5pt">10</span></p></td>
            <td style="background-color:#dddddd; padding:1.5pt 3pt; vertical-align:top"><p style="margin:0pt"><a
                    style="color:#0563c1" href="https://blog.csdn.net/turk/article/details/79723963"><span
                    style="color:#0563c1; font-family:等线; font-size:10.5pt; text-decoration:underline">https://blog.csdn.net/turk/article/details/79723963</span></a>
            </p>
                <p style="margin:0pt"><span style="font-family:等线; font-size:10.5pt">NN中用来处理DN请求</span><span
                        style="font-family:等线; font-size:10.5pt">的线程的线程</span><span
                        style="font-family:等线; font-size:10.5pt">池的容量</span><span
                        style="color:#333333; font-family:Verdana; font-size:10.5pt">.</span></p></td>
        </tr>
        </tbody>
    </table>
    <h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">{2}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:等线; font-size:11pt">DN</span></h5>
    <table cellspacing="0" cellpadding="0" style="border-collapse:collapse; margin-left:85.05pt; width:750.45pt">
        <thead>
        <tr>
            <td style="background-color:#bbbbbb; padding:1.5pt 3pt; vertical-align:top; width:66.8pt"><p
                    style="margin:0pt"><span
                    style="color:#ffffff; font-family:Verdana; font-size:10.5pt; font-weight:bold">Parameter</span></p>
            </td>
            <td style="background-color:#bbbbbb; padding:1.5pt 3pt; vertical-align:top"><p style="margin:0pt"><span
                    style="color:#ffffff; font-family:Verdana; font-size:10.5pt; font-weight:bold">Value</span></p></td>
            <td style="background-color:#bbbbbb; padding:1.5pt 3pt; vertical-align:top"><p style="margin:0pt"><span
                    style="color:#ffffff; font-family:Verdana; font-size:10.5pt; font-weight:bold">Notes</span></p></td>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td style="background-color:#eeeeee; padding:1.5pt 3pt; vertical-align:top; width:66.8pt"><p
                    style="margin:0pt"><span style="color:#333333; font-family:宋体; font-size:10.5pt">dfs.datanode.data.dir</span>
            </p></td>
            <td style="background-color:#eeeeee; padding:1.5pt 3pt; vertical-align:top"><p style="margin:0pt"><span
                    style="color:#333333; font-family:Verdana; font-size:10.5pt">DB</span><span
                    style="color:#333333; font-family:宋体; font-size:10.5pt">的持久化目录</span></p>
                <p style="margin:0pt"><span
                        style="color:#333333; font-family:宋体; font-size:10.5pt">逗号分隔的目录列表，这个目录列表是</span><span
                        style="color:#333333; font-family:Verdana; font-size:10.5pt">DN</span><span
                        style="color:#333333; font-family:宋体; font-size:10.5pt">本地文件系统的，用来存放</span><span
                        style="color:#333333; font-family:Verdana; font-size:10.5pt">D</span><span
                        style="color:#333333; font-family:Verdana; font-size:10.5pt">N</span><span
                        style="color:#333333; font-family:宋体; font-size:10.5pt">的</span><span
                        style="color:#333333; font-family:Verdana; font-size:10.5pt">block</span></p>
                <p style="margin:0pt"><a style="color:#0563c1"
                                         href="https://www.cnblogs.com/serendipity/archive/2012/04/17/2453428.html"><span
                        style="color:#0563c1; font-family:等线; font-size:10.5pt; text-decoration:underline">https://www.cnblogs.com/serendipity/archive/2012/04/17/2453428.html</span></a>
                </p></td>
            <td style="background-color:#eeeeee; padding:1.5pt 3pt; vertical-align:top"><p style="margin:0pt"><span
                    style="color:#333333; font-family:宋体; font-size:10.5pt">用来在不同</span><span
                    style="color:#333333; font-family:宋体; font-size:10.5pt">的</span><span
                    style="color:#333333; font-family:宋体; font-size:10.5pt">目录列表中存</span><span
                    style="color:#333333; font-family:Verdana; font-size:10.5pt">block</span></p></td>
        </tr>
        </tbody>
    </table>
    <h1 style="margin:12pt 0pt 0pt 35.4pt; page-break-after:avoid; page-break-inside:avoid; text-indent:0pt"><span
            style="display:inline; font-family:宋体; font-size:14pt; font-style:normal; font-variant:normal; font-weight:bold; text-decoration:none; text-transform:none; vertical-align:baseline">二、</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:14pt; font-weight:bold">安全模式下的</span><span
            style="font-family:'等线 Light'; font-size:14pt; font-weight:bold">hadoop</span></h1>
    <h2 style="margin:0pt 0pt 6pt 14.15pt; text-indent:0pt"><span
            style="font-family:等线; font-size:14pt; font-style:normal">1.</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><a
            style="color:#0563c1"
            href="https://hadoop.apache.org/docs/r2.7.2/hadoop-project-dist/hadoop-common/SecureMode.html"><span
            style="color:#0563c1; font-family:等线; font-size:11pt; font-weight:bold; text-decoration:underline">https://hadoop.apache.org/docs/r2.7.2/hadoop-project-dist/hadoop-common/SecureMode.html</span></a>
    </h2>
    <h2 style="margin:0pt 0pt 6pt 14.15pt; text-indent:0pt"><span
            style="font-family:等线; font-size:14pt; font-style:normal">2.</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">kerberos</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">：</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold"> </span><a style="color:#0563c1"
                                                                                href="http://www.linuxidc.com/Linux/2016-09/134949.htm"><span
            style="color:#0563c1; font-family:等线; font-size:11pt; font-weight:bold; text-decoration:underline">http://www.linuxidc.com/Linux/2016-09/134949.htm</span></a>
    </h2>
    <h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt; font-style:normal">2.1</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">kerberos</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">是一种</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">linux</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">上的</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">SSO</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">认证系统</span></h3>
    <h2 style="margin:0pt 0pt 6pt 14.15pt; text-indent:0pt"><span
            style="font-family:等线; font-size:14pt; font-style:normal">3.</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">简介</span></h2>
    <h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt; font-style:normal">3.1</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">本文档描述了如何在安全模式下为</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">Hadoop</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">配置身份验证</span></h3>
    <h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt; font-style:normal">3.2</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">在默认情况下，</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">Hadoop</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">以</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">非安全</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">模式运行，不需要身份验证。通过配置</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">Hadoop</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">在安全模式下运行，每个用户和服务都需要通过</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">Kerberos</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">验证才能使用</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">Hadoop</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">服务</span></h3>
    <h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt; font-style:normal">3.3</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">Hadoop</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">的安全特性</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">由</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">Authentication</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">（认证）</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">, Service Level Authorization</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">（服务级别认证）</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">, (Authentication for Web Consoles)(http://hadoop.apache.org/docs/r2.7.3/hadoop-project-dist/hadoop-common/HttpAuthentication.html)</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">（</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">web</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">控制台认证）和</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">Data Confidentiality</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">（数据保密）组成。</span></h3>
    <h2 style="margin:0pt 0pt 6pt 14.15pt; text-indent:0pt"><span
            style="font-family:等线; font-size:14pt; font-style:normal">4.</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">认证</span></h2>
    <h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt; font-style:normal">4.1</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">终端用户</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">帐号</span></h3><h4
            style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span
            style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">4.1.1</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt">当服务级身份验证</span><span
            style="font-family:宋体; font-size:11pt">开启时</span><span
            style="font-family:宋体; font-size:11pt">，在安全模式下使用</span><span
            style="font-family:等线; font-size:11pt">Hadoop</span><span
            style="font-family:宋体; font-size:11pt">的最终用户需要通过</span><span
            style="font-family:等线; font-size:11pt">Kerberos</span><span style="font-family:宋体; font-size:11pt">进行身份验证。进行身份验证的最简单方法是使用</span><span
            style="font-family:等线; font-size:11pt">Kerberos</span><span
            style="font-family:宋体; font-size:11pt">的</span><span
            style="font-family:等线; font-size:11pt">kinit</span><span
            style="font-family:宋体; font-size:11pt">命令</span><span style="font-family:宋体; font-size:11pt">。</span><span
            style="font-family:宋体; font-size:11pt">使用</span><span
            style="font-family:等线; font-size:11pt">Kerberos keytab</span><span style="font-family:宋体; font-size:11pt">文件的程序认证可能会在使用</span><span
            style="font-family:等线; font-size:11pt">kinit</span><span style="font-family:宋体; font-size:11pt">的交互登录</span><span
            style="font-family:宋体; font-size:11pt">不</span><span style="font-family:宋体; font-size:11pt">可用时使用。</span>
    </h4>
    <h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt; font-style:normal">4.2</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">hadoop</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">集群中各个角色</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">的用户账号</span></h3><h4
            style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span
            style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">4.2.1</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt">确保</span><span
            style="font-family:等线; font-size:11pt">HDFS</span><span style="font-family:宋体; font-size:11pt">和</span><span
            style="font-family:等线; font-size:11pt">YARN</span><span
            style="font-family:宋体; font-size:11pt">在不同的用户下运行</span><span
            style="font-family:宋体; font-size:11pt">运行</span><span style="font-family:宋体; font-size:11pt">，比如</span><span
            style="font-family:等线; font-size:11pt">hdfs</span><span style="font-family:宋体; font-size:11pt">和</span><span
            style="font-family:等线; font-size:11pt">yarn</span><span
            style="font-family:宋体; font-size:11pt">用户</span><span style="font-family:宋体; font-size:11pt">。</span><span
            style="font-family:宋体; font-size:11pt">另外，确保</span><span style="font-family:等线; font-size:11pt">MapReduce JobHistory</span><span
            style="font-family:宋体; font-size:11pt">服务器作为不同的用户</span><span
            style="font-family:等线; font-size:11pt">(</span><span style="font-family:宋体; font-size:11pt">如</span><span
            style="font-family:等线; font-size:11pt">mapred</span><span
            style="font-family:宋体; font-size:11pt">用户</span><span style="font-family:等线; font-size:11pt">)</span><span
            style="font-family:宋体; font-size:11pt">运行</span><span style="font-family:宋体; font-size:11pt">。</span><span
            style="font-family:宋体; font-size:11pt">建议让它们共享一个</span><span
            style="font-family:等线; font-size:11pt">Unix</span><span
            style="font-family:宋体; font-size:11pt">用户</span><span
            style="font-family:宋体; font-size:11pt">组，例如</span><span style="font-family:等线; font-size:11pt">hadoop</span><span
            style="font-family:宋体; font-size:11pt">。</span><span style="font-family:宋体; font-size:11pt">有关组</span><span
            style="font-family:宋体; font-size:11pt">管理，请参阅“从用户到组的映射”</span></h4>
    <table cellspacing="0" cellpadding="0" style="border-collapse:collapse; margin-left:49.65pt; width:574.05pt">
        <thead>
        <tr>
            <td style="background-color:#bbbbbb; padding:1.5pt 3pt; vertical-align:top; width:218.1pt"><p
                    style="margin:0pt"><span style="font-family:等线; font-size:10pt; font-weight:normal"> </span><span
                    style="font-family:等线; font-size:10pt; font-weight:normal">            </span><span
                    style="color:#ffffff; font-family:Verdana; font-size:10pt; font-weight:bold">User:Group</span></p>
            </td>
            <td style="background-color:#bbbbbb; padding:1.5pt 3pt; vertical-align:top; width:339.45pt"><p
                    style="margin:0pt"><span
                    style="color:#ffffff; font-family:Verdana; font-size:10pt; font-weight:bold">Daemons</span></p></td>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td style="background-color:#eeeeee; padding:1.5pt 3pt; vertical-align:top; width:218.1pt"><p
                    style="margin:0pt"><span
                    style="color:#333333; font-family:Verdana; font-size:10pt">hdfs:hadoop</span></p></td>
            <td style="background-color:#eeeeee; padding:1.5pt 3pt; vertical-align:top; width:339.45pt"><p
                    style="margin:0pt"><span style="color:#333333; font-family:Verdana; font-size:10pt">NameNode, Secondary NameNode, JournalNode, DataNode</span>
            </p></td>
        </tr>
        <tr>
            <td style="background-color:#dddddd; padding:1.5pt 3pt; vertical-align:top; width:218.1pt"><p
                    style="margin:0pt"><span
                    style="color:#333333; font-family:Verdana; font-size:10pt">yarn:hadoop</span></p></td>
            <td style="background-color:#dddddd; padding:1.5pt 3pt; vertical-align:top; width:339.45pt"><p
                    style="margin:0pt"><span style="color:#333333; font-family:Verdana; font-size:10pt">ResourceManager, NodeManager</span>
            </p></td>
        </tr>
        <tr>
            <td style="background-color:#eeeeee; padding:1.5pt 3pt; vertical-align:top; width:218.1pt"><p
                    style="margin:0pt"><span
                    style="color:#333333; font-family:Verdana; font-size:10pt">mapred:hadoop</span></p></td>
            <td style="background-color:#eeeeee; padding:1.5pt 3pt; vertical-align:top; width:339.45pt"><p
                    style="margin:0pt"><span style="color:#333333; font-family:Verdana; font-size:10pt">MapReduce JobHistory Server</span>
            </p></td>
        </tr>
        </tbody>
    </table>
    <h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt; font-style:normal">4.3</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">Hadoop</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">和</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold"> </span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">Users</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">的</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">Kerberos</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">身份</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">(</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">principals</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">)</span></h3><h4
            style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span
            style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">4.3.1</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt">要在</span><span
            style="font-family:等线; font-size:11pt">hadoop</span><span
            style="font-family:宋体; font-size:11pt">中以安全模式运行</span><span
            style="font-family:等线; font-size:11pt">hadoop</span><span
            style="font-family:宋体; font-size:11pt">。</span><span style="font-family:宋体; font-size:11pt">需要</span><span
            style="background-color:#ffffff; font-family:Verdana; font-size:9pt">Kerberos</span><span
            style="background-color:#ffffff; font-family:Verdana; font-size:9pt">&#xa0;</span><span
            style="background-color:#ffffff; font-family:宋体; font-size:9pt">身份。</span><span
            style="font-family:等线; font-size:11pt">auhenticate</span><span
            style="font-family:宋体; font-size:11pt">信息</span><span style="font-family:宋体; font-size:11pt">保存在</span><span
            style="font-family:宋体; font-size:11pt">设置了适当</span><span
            style="font-family:等线; font-size:11pt">rwx</span><span
            style="font-family:宋体; font-size:11pt">权限的</span><span
            style="font-family:等线; font-size:11pt">keytab</span><span
            style="font-family:宋体; font-size:11pt">文件中</span><span style="font-family:宋体; font-size:11pt">，由</span><span
            style="font-family:宋体; font-size:11pt">服务读取</span></h4><h5
            style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">{1}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt">每个</span><span
            style="font-family:等线; font-size:11pt">Hadoop</span><span
            style="font-family:宋体; font-size:11pt">服务实例都必须配置他的</span><span style="font-family:等线; font-size:11pt">Kerberos principal</span><span
            style="font-family:宋体; font-size:11pt">和</span><span
            style="font-family:等线; font-size:11pt">keytab</span><span
            style="font-family:宋体; font-size:11pt">文件位置。</span></h5><h5
            style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">{2}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt">一个服务实体的一般格式是：服务名</span><span style="font-family:等线; font-size:11pt">/_HOST@REALM.TLD</span><span
            style="font-family:宋体; font-size:11pt">。比如：</span><span style="font-family:等线; font-size:11pt">dn/_HOST@EXAMPLE.COM</span><span
            style="font-family:宋体; font-size:11pt">。</span></h5><h5
            style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">{3}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:等线; font-size:11pt">Hadoop</span><span
            style="font-family:宋体; font-size:11pt">通过允许服务</span><span
            style="font-family:等线; font-size:11pt">principal</span><span style="font-family:宋体; font-size:11pt">的主机组件被指定为</span><span
            style="font-family:等线; font-size:11pt">_HOST</span><span style="font-family:宋体; font-size:11pt">通配符来简化配置文件的部署。每个服务实例都会用它们自己当前运行的合法主机名来代替</span><span
            style="font-family:等线; font-size:11pt">_HOST</span><span style="font-family:宋体; font-size:11pt">。这就允许管理员给所有节点部署相同设置的配置文件。但是，</span><span
            style="font-family:等线; font-size:11pt">keytab</span><span
            style="font-family:宋体; font-size:11pt">文件将会不同。</span></h5><h4
            style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span
            style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">4.3.2</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:等线; font-size:11pt">HTTP web</span><span
            style="font-family:宋体; font-size:11pt">控制台应该由与</span><span style="font-family:等线; font-size:11pt">RPC</span><span
            style="font-family:宋体; font-size:11pt">不同的主体提供服务</span></h4><h4
            style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span
            style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">4.3.3</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt">下面的小节展示了</span><span
            style="font-family:等线; font-size:11pt">Hadoop</span><span
            style="font-family:宋体; font-size:11pt">服务的</span><span
            style="font-family:等线; font-size:11pt">credentials</span><span
            style="font-family:宋体; font-size:11pt">示例</span></h4>
    <h1 style="margin:12pt 0pt 0pt 35.4pt; page-break-after:avoid; page-break-inside:avoid; text-indent:0pt"><span
            style="display:inline; font-family:宋体; font-size:14pt; font-style:normal; font-variant:normal; font-weight:bold; text-decoration:none; text-transform:none; vertical-align:baseline">三、</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:14pt; font-weight:bold">使用</span><span
            style="font-family:'等线 Light'; font-size:14pt; font-weight:bold">QJM</span><span
            style="font-family:宋体; font-size:14pt; font-weight:bold">配置</span><span
            style="font-family:'等线 Light'; font-size:14pt; font-weight:bold">HDFS</span><span
            style="font-family:'等线 Light'; font-size:14pt; font-weight:bold"> </span><span
            style="font-family:'等线 Light'; font-size:14pt; font-weight:bold">HA</span></h1>
    <h2 style="margin:0pt 0pt 6pt 14.15pt; text-indent:0pt"><span
            style="font-family:等线; font-size:14pt; font-style:normal">1.</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">目标</span></h2>
    <h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt; font-style:normal">1.1</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">这篇文档提供了</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">HDFS</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold"> </span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">HA</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">的概览和使用</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">QJM</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">方式配置</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">HDFS</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">集群的方法</span></h3>
    <h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt; font-style:normal">1.2</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">这篇文档假定读者已经有一定的</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">hdfs</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">集群知识</span></h3>
    <h2 style="margin:0pt 0pt 6pt 14.15pt; text-indent:0pt"><span
            style="font-family:等线; font-size:14pt; font-style:normal">2.</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">注意：使用</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">QJM</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">或者传统的共享存储</span></h2>
    <h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt; font-style:normal">2.1</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">本片文档讨论的时怎样使用</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">qjm</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">在</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">ANN</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">和</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">SNN</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">之间共享</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">edit</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold"> </span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">logs</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">，使用</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">NFS</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">需要查看另外一篇</span></h3>
    <h2 style="margin:0pt 0pt 6pt 14.15pt; text-indent:0pt"><span
            style="font-family:等线; font-size:14pt; font-style:normal">3.</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">背景</span></h2>
    <h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt; font-style:normal">3.1</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">在</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">Hadoop 2.0.0</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">之前，</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">NameNode</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">是</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">HDFS</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">集群中的单点故障</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">(SPOF)</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">。每个集群都有一个</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">NameNode</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">，如果该机器或进程变得</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">不</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">可用，那么整个集群将</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">不</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">可用，直到</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">NameNode</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">重新启动或在单独的机器上启动</span></h3>
    <h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt; font-style:normal">3.2</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">这从两个方面影响了</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">HDFS</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">集群的整体可用性</span></h3><h4
            style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span
            style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">3.2.1</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt">在发生意外事件</span><span
            style="font-family:等线; font-size:11pt">(</span><span
            style="font-family:宋体; font-size:11pt">如机器崩溃</span><span
            style="font-family:等线; font-size:11pt">)</span><span
            style="font-family:宋体; font-size:11pt">的情况下，在操作员重新启动</span><span style="font-family:等线; font-size:11pt">NameNode</span><span
            style="font-family:宋体; font-size:11pt">之前，集群将</span><span
            style="font-family:宋体; font-size:11pt">不</span><span style="font-family:宋体; font-size:11pt">可用</span></h4>
    <h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span
            style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">3.2.2</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt">计划的维护事件</span><span
            style="font-family:等线; font-size:11pt">(</span><span style="font-family:宋体; font-size:11pt">如</span><span
            style="font-family:等线; font-size:11pt">NameNode</span><span style="font-family:宋体; font-size:11pt">机器上的软件或硬件升级</span><span
            style="font-family:等线; font-size:11pt">)</span><span style="font-family:宋体; font-size:11pt">将导致集群停机</span>
    </h4>
    <h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt; font-style:normal">3.3</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">HDFS</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">高可用性特性解决了上述问题，它提供了在同一个集群中以主动</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">/</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">被动配置运行两个冗余的</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">namenode</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">和一个热备份的选项。这允许在机器崩溃的情况下快速地将故障转移到新的</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">NameNode</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">，或者为计划的维护提供由管理员发起的优雅的故障转移</span></h3>
    <h2 style="margin:0pt 0pt 6pt 14.15pt; text-indent:0pt"><span
            style="font-family:等线; font-size:14pt; font-style:normal">4.</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">架构</span></h2>
    <h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt; font-style:normal">4.1</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">在典型的</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">HA</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">集群中，两台独立的机器被配置为</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">NameNodes</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">。在任何时间点，其中一个</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">namenode</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">处于活动状态，另一个处于备用状态。活动的</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">NameNode</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">负责集群中的所有客户端操作，而备用服务器只是充当一个奴隶，维护足够的状态，以便在必要时提供快速故障转移</span>
    </h3>
    <h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt; font-style:normal">4.2</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">为了使备用节点的状态与活动节点保持同步，两个节点都与一组称为“</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">JournalNodes”(JNs)</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">的独立守护进程通信。当活动节点执行任何名称空间修改</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">的操作时</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">，它会将修改的记录持续记录到这些</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">JNs</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">中的大多数。备用节点能够从</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">JNs</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">读取编辑，并不断监视编辑日志的更改。当备用节点看到编辑时，它将它们应用到自己的</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">命名</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">空间。在发生故障转移时，备用服务器将确保在将自己提升到活动状态之前已从</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">JounalNodes</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">读取了所有</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">edit</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold"> </span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">logs</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">。这可以确保在发生故障转移之前完全同步</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">NN</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">的状态</span></h3>
    <h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt; font-style:normal">4.3</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">为了提供快速的故障转移，备用节点还必须具有关于集群中块的位置的最新信息。为了实现这一点，</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">datanode</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">配置了两个</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">namenode</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">的位置，并向它们发送块位置信息和心跳</span></h3>
    <h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt; font-style:normal">4.4</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">一个</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">HA</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">集群在同一时刻只有一个</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">ANN</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">是至关重要的，</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">否则，</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">NN</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">的</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">状态将很快产生分歧，可能导致数据丢失或其他不正确的结果</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">。为了确保这一点并且防止脑裂，</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">JN</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">只允许</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">ANN</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">写入。在故障转移期间，</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">要激活的</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">NameNode</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">将简单地接管向</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">JournalNodes</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">写入的任务</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">，这将会有效的组织其他</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">NN</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">继续处于</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">Active</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">状态，允许新的</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">ANN</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">安全的进行故障转移。</span></h3>
    <h2 style="margin:0pt 0pt 6pt 14.15pt; text-indent:0pt"><span
            style="font-family:等线; font-size:14pt; font-style:normal">5.</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">硬件资源</span></h2>
    <h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt; font-style:normal">5.1</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">为了部署一个</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">HA</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">集群，需要准备如下：</span></h3><h4
            style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span
            style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">5.1.1</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:等线; font-size:11pt">NN</span><span style="font-family:宋体; font-size:11pt">节点</span></h4>
    <h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span
            style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">5.1.2</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:等线; font-size:11pt">JN</span><span style="font-family:宋体; font-size:11pt">节点</span></h4>
    <h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">{1}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt">至少</span><span style="font-family:等线; font-size:11pt">3</span><span
            style="font-family:宋体; font-size:11pt">个，奇数，</span><span
            style="font-family:等线; font-size:11pt">JN</span><span
            style="font-family:宋体; font-size:11pt">集群可以在最多</span><span
            style="font-family:等线; font-size:11pt">(N-1`)/2</span><span
            style="font-family:宋体; font-size:11pt">个</span><span style="font-family:宋体; font-size:11pt">宕</span><span
            style="font-family:宋体; font-size:11pt">机中运行</span></h5>
    <h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt; font-style:normal">5.2</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">注意，</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">在</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">HA</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">集群中</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">,</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">SNN</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">也</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">可以触发</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">NN</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">的</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">checkpoints</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">,</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">因此不需要运行一个</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">S</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">econd</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">ary</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">NN</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">、</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">CheckpointNode</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">、</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">BackupNode</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">，这样做会报错。</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">这还允许将未</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">ha</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">的</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">HDFS</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">集群重新配置为</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">ha</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">，从而重用以前专门用于辅助</span><span
            style="font-family:等线; font-size:11pt; font-weight:bold">NameNode</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">的硬件</span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">。</span></h3>
    <h2 style="margin:0pt 0pt 6pt 14.15pt; text-indent:0pt"><span
            style="font-family:等线; font-size:14pt; font-style:normal">6.</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">部署</span></h2>
    <h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt; font-style:normal">6.1</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">配置概览</span></h3><h4
            style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span
            style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">6.1.1</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt">与</span><span
            style="font-family:等线; font-size:11pt">Federation</span><span
            style="font-family:宋体; font-size:11pt">配置类似，</span><span
            style="font-family:等线; font-size:11pt">HA</span><span
            style="font-family:宋体; font-size:11pt">配置是向后兼容的，允许现有的</span><span style="font-family:等线; font-size:11pt">NameNode</span><span
            style="font-family:宋体; font-size:11pt">配置无需更改即可工作。新配置的设计使集群中的所有节点可以具有相同的配置，而不需要根据节点的类型将不同的配置文件部署到不同的机器上。</span>
    </h4><h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span
            style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">6.1.2</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt">与</span><span style="font-family:等线; font-size:11pt">HDFS</span><span
            style="font-family:等线; font-size:11pt"> </span><span
            style="font-family:等线; font-size:11pt">Federation</span><span
            style="font-family:宋体; font-size:11pt">一样，</span><span style="font-family:等线; font-size:11pt">HA</span><span
            style="font-family:宋体; font-size:11pt">集群重用</span><span style="font-family:等线; font-size:11pt">nameservice ID</span><span
            style="font-family:宋体; font-size:11pt">来标识单个</span><span
            style="font-family:等线; font-size:11pt">HDFS</span><span style="font-family:宋体; font-size:11pt">实例，该实例实际上可能包含多个</span><span
            style="font-family:等线; font-size:11pt">namenode</span><span
            style="font-family:宋体; font-size:11pt">。此外，</span><span
            style="font-family:等线; font-size:11pt">HA</span><span
            style="font-family:宋体; font-size:11pt">中还添加了一个名为</span><span style="font-family:等线; font-size:11pt">NameNode ID</span><span
            style="font-family:宋体; font-size:11pt">的新</span><span style="font-family:宋体; font-size:11pt">概念</span><span
            style="font-family:宋体; font-size:11pt">。集群中的每个不同的</span><span style="font-family:等线; font-size:11pt">NameNode</span><span
            style="font-family:宋体; font-size:11pt">都有一个不同的</span><span style="font-family:等线; font-size:11pt">NameNode ID</span><span
            style="font-family:宋体; font-size:11pt">来区分它。为了支持</span><span
            style="font-family:宋体; font-size:11pt">用一个</span><span
            style="font-family:宋体; font-size:11pt">配置文件</span><span
            style="font-family:宋体; font-size:11pt">配置所有</span><span
            style="font-family:等线; font-size:11pt">NN</span><span
            style="font-family:宋体; font-size:11pt">，相关的配置参数以</span><span style="font-family:等线; font-size:11pt">nameservice ID</span><span
            style="font-family:宋体; font-size:11pt">和</span><span
            style="font-family:等线; font-size:11pt">NameNode ID</span><span
            style="font-family:宋体; font-size:11pt">作为后缀。</span></h4>
    <h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt; font-style:normal">6.2</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">配置细节</span></h3><h4
            style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span
            style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">6.2.1</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt">要配置</span><span style="font-family:等线; font-size:11pt">HA</span><span
            style="font-family:宋体; font-size:11pt">的</span><span style="font-family:等线; font-size:11pt">NN</span><span
            style="font-family:宋体; font-size:11pt">，必须添加几个服务端的配置到</span><span style="font-family:等线; font-size:11pt">hdfs-site.xml</span>
    </h4><h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span
            style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">6.2.2</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt">顺序并不重要，但必须在配置其他选项之前确定</span><span
            style="font-family:等线; font-size:11pt">dfs.nameservices</span><span
            style="font-family:宋体; font-size:11pt">和</span><span style="font-family:等线; font-size:11pt">dfs.</span><span
            style="font-family:等线; font-size:11pt">ha.namenodes</span><span style="font-family:等线; font-size:11pt">.[nameservice ID]</span><span
            style="font-family:宋体; font-size:11pt">的值</span></h4><h4
            style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span
            style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">6.2.3</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:等线; font-size:11pt">dfs.nameservices</span><span style="font-family:等线; font-size:11pt">   </span><span
            style="font-family:宋体; font-size:11pt">集群对外提供服务所暴露的逻辑名称</span></h4>
    <p style="background-color:#ffffff; margin:6pt 0pt 6pt 73.5pt"><span
            style="color:#333333; font-family:宋体; font-size:9pt">&lt;property&gt;</span></p>
    <p style="background-color:#ffffff; margin:0pt 0pt 0pt 73.5pt"><span
            style="color:#333333; font-family:宋体; font-size:9pt">  &lt;name&gt;</span><span
            style="color:#333333; font-family:宋体; font-size:9pt">dfs.nameservices</span><span
            style="color:#333333; font-family:宋体; font-size:9pt">&lt;/name&gt;</span></p>
    <p style="background-color:#ffffff; margin:0pt 0pt 0pt 73.5pt"><span
            style="color:#333333; font-family:宋体; font-size:9pt">  &lt;value&gt;mycluster&lt;/value&gt;</span></p>
    <p style="background-color:#ffffff; margin:6pt 0pt 6pt 73.5pt"><span
            style="color:#333333; font-family:宋体; font-size:9pt">&lt;/property&gt;</span></p><h4
            style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span
            style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">6.2.4</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:等线; font-size:11pt">dfs.</span><span
            style="font-family:等线; font-size:11pt">ha.namenodes</span><span style="font-family:等线; font-size:11pt">.[nameservice ID]</span><span
            style="font-family:等线; font-size:11pt">  </span><span style="font-family:等线; font-size:11pt">NN</span><span
            style="font-family:宋体; font-size:11pt">的唯一标识</span></h4>
    <p style="background-color:#ffffff; margin:6pt 0pt 6pt 63pt"><span
            style="color:#333333; font-family:宋体; font-size:9pt">&lt;property&gt;</span></p>
    <p style="background-color:#ffffff; margin:0pt 0pt 0pt 63pt"><span
            style="color:#333333; font-family:宋体; font-size:9pt">  &lt;name&gt;dfs.</span><span
            style="color:#333333; font-family:宋体; font-size:9pt">ha.namenodes</span><span
            style="color:#333333; font-family:宋体; font-size:9pt">.mycluster&lt;/name&gt;</span></p>
    <p style="background-color:#ffffff; margin:0pt 0pt 0pt 63pt"><span
            style="color:#333333; font-family:宋体; font-size:9pt">  &lt;value&gt;nn</span><span
            style="color:#333333; font-family:宋体; font-size:9pt">1,nn</span><span
            style="color:#333333; font-family:宋体; font-size:9pt">2&lt;/value&gt;</span></p>
    <p style="background-color:#ffffff; margin:6pt 0pt 6pt 63pt"><span
            style="color:#333333; font-family:宋体; font-size:9pt">&lt;/property&gt;</span></p><h5
            style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">{1}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt">目前只允许最多</span><span
            style="font-family:等线; font-size:11pt">2</span><span style="font-family:宋体; font-size:11pt">个</span><span
            style="font-family:等线; font-size:11pt">NN</span></h5><h4
            style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span
            style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">6.2.5</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:等线; font-size:11pt">rpc</span><span
            style="font-family:宋体; font-size:11pt">地址和</span><span
            style="font-family:等线; font-size:11pt">http</span><span style="font-family:宋体; font-size:11pt">地址</span>
    </h4><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">{1}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt">如果设置了安全模式，要使用</span><span style="font-family:等线; font-size:11pt">https</span>
    </h5><h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span
            style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">6.2.6</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:等线; font-size:11pt">dfs.namenode.shared.edits.dir</span><span
            style="font-family:等线; font-size:11pt">  </span><span style="font-family:等线; font-size:11pt">JNs</span><span
            style="font-family:宋体; font-size:11pt">的地址列表，</span><span
            style="font-family:宋体; font-size:11pt"> </span><span style="font-family:等线; font-size:11pt">NN</span><span
            style="font-family:宋体; font-size:11pt">用来进行读写</span></h4>
    <p style="background-color:#ffffff; margin:6pt 0pt 6pt 52.5pt"><span
            style="color:#333333; font-family:宋体; font-size:9pt">&lt;property&gt;</span></p>
    <p style="background-color:#ffffff; margin:0pt 0pt 0pt 52.5pt"><span
            style="color:#333333; font-family:宋体; font-size:9pt">  &lt;name&gt;dfs.namenode.shared.edits.dir&lt;/name&gt;</span>
    </p>
    <p style="background-color:#ffffff; margin:0pt 0pt 0pt 52.5pt"><span
            style="color:#333333; font-family:宋体; font-size:9pt">  &lt;value&gt;qjournal://node1.example.com:8485;node2.example.com:8485;node3.example.com:8485/mycluster&lt;/value&gt;</span>
    </p>
    <p style="background-color:#ffffff; margin:6pt 0pt 6pt 52.5pt"><span
            style="color:#333333; font-family:宋体; font-size:9pt">&lt;/property&gt;</span></p><h4
            style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span
            style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">6.2.7</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:等线; font-size:11pt">dfs.client</span><span style="font-family:等线; font-size:11pt">.failover.proxy.provider.[nameservice ID]</span><span
            style="font-family:等线; font-size:11pt">  </span><span
            style="font-family:等线; font-size:11pt">HDFS</span><span style="font-family:宋体; font-size:11pt">客户端用来跟</span><span
            style="font-family:等线; font-size:11pt">ANN</span><span
            style="font-family:宋体; font-size:11pt">通信的</span><span
            style="font-family:等线; font-size:11pt">java</span><span
            style="font-family:宋体; font-size:11pt">代理类</span><span
            style="font-family:宋体; font-size:11pt">，手动自动都需要</span><span style="font-family:宋体; font-size:11pt"> </span>
    </h4><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">{1}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:等线; font-size:11pt">DFS</span><span
            style="font-family:宋体; font-size:11pt">客户端</span><span
            style="font-family:宋体; font-size:11pt">将使用</span><span
            style="font-family:宋体; font-size:11pt">这个类</span><span
            style="font-family:宋体; font-size:11pt">来确定哪个</span><span
            style="font-family:等线; font-size:11pt">NameNode</span><span
            style="font-family:宋体; font-size:11pt">是当前活动的，</span><span
            style="font-family:宋体; font-size:11pt">也就是哪个</span><span
            style="font-family:等线; font-size:11pt">NN</span><span
            style="font-family:宋体; font-size:11pt">接受请求</span><span
            style="font-family:宋体; font-size:11pt">。目前与</span><span style="font-family:等线; font-size:11pt">Hadoop</span><span
            style="font-family:宋体; font-size:11pt">一起提供的唯一实现是</span><span style="font-family:等线; font-size:11pt">ConfiguredFailoverProxyProvider</span><span
            style="font-family:宋体; font-size:11pt">，所以除非您使用自定义的，否则就使用它</span></h5>
    <p style="background-color:#ffffff; margin:6pt 0pt 6pt 63pt"><span
            style="color:#333333; font-family:宋体; font-size:9pt">&lt;property&gt;</span></p>
    <p style="background-color:#ffffff; margin:0pt 0pt 0pt 63pt"><span
            style="color:#333333; font-family:宋体; font-size:9pt">  &lt;name&gt;</span><span
            style="color:#333333; font-family:宋体; font-size:9pt">dfs.client</span><span
            style="color:#333333; font-family:宋体; font-size:9pt">.failover.proxy.provider.mycluster&lt;/name&gt;</span>
    </p>
    <p style="background-color:#ffffff; margin:0pt 0pt 0pt 63pt"><span
            style="color:#333333; font-family:宋体; font-size:9pt">  &lt;value&gt;</span><span
            style="color:#333333; font-family:宋体; font-size:9pt">org.apache</span><span
            style="color:#333333; font-family:宋体; font-size:9pt">.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider&lt;/value&gt;</span>
    </p>
    <p style="background-color:#ffffff; margin:6pt 0pt 6pt 63pt"><span
            style="color:#333333; font-family:宋体; font-size:9pt">&lt;/property&gt;</span></p><h4
            style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span
            style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">6.2.8</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:等线; font-size:11pt">dfs.ha.fencing.methods</span><span
            style="font-family:等线; font-size:11pt">   </span><span
            style="font-family:宋体; font-size:11pt">将用于在故障转移期间</span><span
            style="font-family:宋体; font-size:11pt">隔离</span><span style="font-family:等线; font-size:11pt">ANN</span><span
            style="font-family:宋体; font-size:11pt">的脚本或</span><span
            style="font-family:等线; font-size:11pt">Java</span><span style="font-family:宋体; font-size:11pt">类的列表</span>
    </h4><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">{1}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt">为了保证系统的正确性，在任何给定的时间只有一个</span><span
            style="font-family:等线; font-size:11pt">NameNode</span><span
            style="font-family:宋体; font-size:11pt">处于活动状态</span><span
            style="font-family:宋体; font-size:11pt">。</span><span
            style="font-family:宋体; font-size:11pt">重要的是，在使用</span><span style="font-family:等线; font-size:11pt">Quorum Journal Manager</span><span
            style="font-family:宋体; font-size:11pt">时，只允许一个</span><span
            style="font-family:等线; font-size:11pt">NameNode</span><span
            style="font-family:宋体; font-size:11pt">向</span><span
            style="font-family:等线; font-size:11pt">JournalNodes</span><span
            style="font-family:宋体; font-size:11pt">写入，因此</span><span
            style="font-family:宋体; font-size:11pt">不会有脑裂的情况</span><span
            style="font-family:宋体; font-size:11pt">。</span><span style="font-family:宋体; font-size:11pt">然而，当一个故障转移发生时，前面的</span><span
            style="font-family:等线; font-size:11pt">ANN</span><span
            style="font-family:宋体; font-size:11pt">仍有接收客户端的读请求，</span><span style="font-family:宋体; font-size:11pt">此时响应给客户端的数据</span><span
            style="font-family:宋体; font-size:11pt">可能</span><span style="font-family:宋体; font-size:11pt">是</span><span
            style="font-family:宋体; font-size:11pt">过期</span><span style="font-family:宋体; font-size:11pt">的</span><span
            style="font-family:宋体; font-size:11pt">，直到</span><span style="font-family:宋体; font-size:11pt">新的</span><span
            style="font-family:等线; font-size:11pt">NameNode</span><span style="font-family:宋体; font-size:11pt">在尝试向日志节点写入时关闭</span><span
            style="font-family:宋体; font-size:11pt">。</span><span
            style="font-family:宋体; font-size:11pt">因此，使用</span><span
            style="font-family:等线; font-size:11pt">QJM</span><span
            style="font-family:宋体; font-size:11pt">时仍需要配置一些</span><span style="font-family:宋体; font-size:11pt">隔离</span><span
            style="font-family:宋体; font-size:11pt">方法</span><span style="font-family:宋体; font-size:11pt">。</span><span
            style="font-family:宋体; font-size:11pt">然而，为了</span><span
            style="font-family:宋体; font-size:11pt">提高</span><span
            style="font-family:宋体; font-size:11pt">隔离机制</span><span style="font-family:宋体; font-size:11pt">不</span><span
            style="font-family:宋体; font-size:11pt">可用时的可用性</span><span
            style="font-family:宋体; font-size:11pt">，建议配置托底方法</span><span style="font-family:宋体; font-size:11pt">在</span><span
            style="font-family:等线; font-size:11pt">fecing</span><span
            style="font-family:等线; font-size:11pt"> </span><span
            style="font-family:等线; font-size:11pt">method</span><span
            style="font-family:宋体; font-size:11pt">方法</span><span style="font-family:宋体; font-size:11pt">不</span><span
            style="font-family:宋体; font-size:11pt">可用时返回</span><span
            style="font-family:等线; font-size:11pt">true</span><span style="font-family:宋体; font-size:11pt">。</span><span
            style="font-family:宋体; font-size:11pt">注意，如果你选择不使用托底，仍然需要配置一些配置，比如</span><span
            style="font-family:宋体; font-size:11pt">“</span><span style="font-family:等线; font-size:11pt">shell(/bin/true)”</span><span
            style="font-family:宋体; font-size:11pt">。</span><span style="font-family:宋体; font-size:11pt">故障转移期间的隔离方法以一个回车分割的列表的形式来配置，在隔离成功之前会一直按序尝试。有</span><span
            style="font-family:等线; font-size:11pt">2</span><span style="font-family:宋体; font-size:11pt">种方式，</span><span
            style="font-family:等线; font-size:11pt">shell</span><span
            style="font-family:宋体; font-size:11pt">和</span><span
            style="font-family:等线; font-size:11pt">sshfence</span><span
            style="font-family:宋体; font-size:11pt">，也可以自定义。</span></h5><h5
            style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">{2}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:等线; font-size:11pt">sshfence</span><span style="font-family:等线; font-size:11pt">  </span><span
            style="font-family:等线; font-size:11pt">SSH</span><span style="font-family:宋体; font-size:11pt">登录</span><span
            style="font-family:宋体; font-size:11pt">到</span><span style="font-family:等线; font-size:11pt">ANN</span><span
            style="font-family:宋体; font-size:11pt">并且</span><span
            style="font-family:等线; font-size:11pt">kill</span><span style="font-family:宋体; font-size:11pt">进程</span>
    </h5><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">[1]</span><span style="font:7.0pt 'Times New Roman'"> </span><span
            style="font-family:等线; font-size:11pt">sshfence</span><span
            style="font-family:宋体; font-size:11pt">方式会</span><span style="font-family:宋体; font-size:11pt">将</span><span
            style="font-family:等线; font-size:11pt">ssh</span><span
            style="font-family:宋体; font-size:11pt">登陆到</span><span
            style="font-family:宋体; font-size:11pt">目标节点，并使用</span><span
            style="font-family:等线; font-size:11pt">fuser</span><span
            style="font-family:宋体; font-size:11pt">终止监听服务的</span><span style="font-family:等线; font-size:11pt">TCP</span><span
            style="font-family:宋体; font-size:11pt">端口的进程。为了使这个隔离</span><span
            style="font-family:宋体; font-size:11pt">方法</span><span
            style="font-family:宋体; font-size:11pt">工作，它必须</span><span
            style="font-family:宋体; font-size:11pt">能够在</span><span
            style="font-family:宋体; font-size:11pt">免密钥</span><span
            style="font-family:宋体; font-size:11pt">的情况下通过</span><span
            style="font-family:等线; font-size:11pt">SSH</span><span style="font-family:宋体; font-size:11pt">连接到目标节点。因此，还必须配置</span><span
            style="font-family:等线; font-size:11pt">dfs.ha.fencing.ssh.private-key-files</span><span
            style="font-family:宋体; font-size:11pt">，它是一个以逗号分隔的</span><span
            style="font-family:等线; font-size:11pt">SSH</span><span
            style="font-family:宋体; font-size:11pt">私有密钥文件列表</span></h6>
    <p style="background-color:#ffffff; margin:6pt 0pt 6pt 73.5pt; text-indent:21pt"><span
            style="color:#333333; font-family:宋体; font-size:11pt">&lt;property&gt;</span></p>
    <p style="background-color:#ffffff; margin:0pt 0pt 0pt 73.5pt"><span
            style="color:#333333; font-family:宋体; font-size:11pt">      &lt;name&gt;dfs.</span><span
            style="color:#333333; font-family:宋体; font-size:11pt">ha.fencing</span><span
            style="color:#333333; font-family:宋体; font-size:11pt">.methods&lt;/name&gt;</span></p>
    <p style="background-color:#ffffff; margin:0pt 0pt 0pt 73.5pt"><span
            style="color:#333333; font-family:宋体; font-size:11pt">      &lt;value&gt;sshfence&lt;/value&gt;</span></p>
    <p style="background-color:#ffffff; margin:0pt 0pt 0pt 73.5pt"><span
            style="color:#333333; font-family:宋体; font-size:11pt">    &lt;/property&gt;</span></p>
    <p style="background-color:#ffffff; margin:0pt 0pt 0pt 73.5pt"><span
            style="color:#333333; font-family:宋体; font-size:9pt">    &lt;property&gt;</span></p>
    <p style="background-color:#ffffff; margin:0pt 0pt 0pt 73.5pt"><span
            style="color:#333333; font-family:宋体; font-size:9pt">      &lt;name&gt;</span><span
            style="color:#333333; font-family:宋体; font-size:9pt">dfs.ha.fencing.ssh.private</span><span
            style="color:#333333; font-family:宋体; font-size:9pt">-key-files&lt;/name&gt;</span></p>
    <p style="background-color:#ffffff; margin:0pt 0pt 0pt 73.5pt"><span
            style="color:#333333; font-family:宋体; font-size:9pt">      &lt;value&gt;/home/exampleuser/.ssh/id_rsa&lt;/value&gt;</span>
    </p>
    <p style="background-color:#ffffff; margin:6pt 0pt 6pt 73.5pt; text-indent:18pt"><span
            style="color:#333333; font-family:宋体; font-size:9pt">&lt;/property&gt;</span></p><h6
            style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">[2]</span><span style="font:7.0pt 'Times New Roman'"> </span><span
            style="font-family:宋体; font-size:11pt">可选的，可以配置一个非标准的用户名或者端口执行</span><span
            style="font-family:等线; font-size:11pt">SSH</span><span
            style="font-family:宋体; font-size:11pt">，可以配置</span><span
            style="font-family:宋体; font-size:11pt">毫秒为</span><span style="font-family:宋体; font-size:11pt">单位的过期时间。之后，隔离方法会失效。</span>
    </h6>
    <p style="background-color:#ffffff; margin:6pt 0pt 6pt 84pt"><span
            style="color:#333333; font-family:宋体; font-size:9pt">&lt;property&gt;</span></p>
    <p style="background-color:#ffffff; margin:0pt 0pt 0pt 84pt"><span
            style="color:#333333; font-family:宋体; font-size:9pt">      &lt;name&gt;dfs.</span><span
            style="color:#333333; font-family:宋体; font-size:9pt">ha.fencing</span><span
            style="color:#333333; font-family:宋体; font-size:9pt">.methods&lt;/name&gt;</span></p>
    <p style="background-color:#ffffff; margin:0pt 0pt 0pt 84pt"><span
            style="color:#333333; font-family:宋体; font-size:9pt">      &lt;value&gt;sshfence([[username]</span><span
            style="color:#333333; font-family:宋体; font-size:9pt">[:port</span><span
            style="color:#333333; font-family:宋体; font-size:9pt">]])&lt;/value&gt;</span></p>
    <p style="background-color:#ffffff; margin:0pt 0pt 0pt 84pt"><span
            style="color:#333333; font-family:宋体; font-size:9pt">    &lt;/property&gt;</span></p>
    <p style="background-color:#ffffff; margin:0pt 0pt 0pt 84pt"><span
            style="color:#333333; font-family:宋体; font-size:9pt">    &lt;property&gt;</span></p>
    <p style="background-color:#ffffff; margin:0pt 0pt 0pt 84pt"><span
            style="color:#333333; font-family:宋体; font-size:9pt">      &lt;name&gt;</span><span
            style="color:#333333; font-family:宋体; font-size:9pt">dfs.ha.fencing.ssh.connect</span><span
            style="color:#333333; font-family:宋体; font-size:9pt">-timeout&lt;/name&gt;</span></p>
    <p style="background-color:#ffffff; margin:0pt 0pt 0pt 84pt"><span
            style="color:#333333; font-family:宋体; font-size:9pt">      &lt;value&gt;30000&lt;/value&gt;</span></p>
    <p style="background-color:#ffffff; margin:6pt 0pt 6pt 84pt; text-indent:18pt"><span
            style="color:#333333; font-family:宋体; font-size:9pt">&lt;/property&gt;</span></p><h5
            style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">{3}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:等线; font-size:11pt">shell</span><span
            style="font-family:等线; font-size:11pt">  </span><span
            style="font-family:宋体; font-size:11pt">运行一个</span><span
            style="font-family:等线; font-size:11pt">shell</span><span
            style="font-family:宋体; font-size:11pt">脚本命令去隔离</span><span style="font-family:等线; font-size:11pt">ANN</span>
    </h5>
    <p style="background-color:#ffffff; margin:6pt 0pt 6pt 73.5pt"><span
            style="color:#333333; font-family:宋体; font-size:9pt">&lt;property&gt;</span></p>
    <p style="background-color:#ffffff; margin:0pt 0pt 0pt 73.5pt"><span
            style="color:#333333; font-family:宋体; font-size:9pt">      &lt;name&gt;dfs.</span><span
            style="color:#333333; font-family:宋体; font-size:9pt">ha.fencing</span><span
            style="color:#333333; font-family:宋体; font-size:9pt">.methods&lt;/name&gt;</span></p>
    <p style="background-color:#ffffff; margin:0pt 0pt 0pt 73.5pt"><span
            style="color:#333333; font-family:宋体; font-size:9pt">      &lt;value&gt;</span><span
            style="color:#333333; font-family:宋体; font-size:9pt">shell(</span><span
            style="color:#333333; font-family:宋体; font-size:9pt">/path/to/my/script.sh arg1 arg2 ...)&lt;/value&gt;</span>
    </p>
    <p style="background-color:#ffffff; margin:6pt 0pt 6pt 73.5pt; text-indent:18pt"><span
            style="color:#333333; font-family:宋体; font-size:9pt">&lt;/property&gt;</span></p><h4
            style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span
            style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">6.2.9</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:等线; font-size:11pt">dfs.ha.fencing.methods</span><span
            style="font-family:宋体; font-size:11pt">参数的理解，官方文档直译不好理解。</span></h4><h5
            style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">{1}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt">当配置了</span><span
            style="font-family:等线; font-size:11pt">HDFS HA</span><span
            style="font-family:宋体; font-size:11pt">集群时，会有两个</span><span
            style="font-family:等线; font-size:11pt">NameNode</span><span
            style="font-family:宋体; font-size:11pt">，为了避免</span><span
            style="font-family:宋体; font-size:11pt">脑裂。也就是</span><span
            style="font-family:宋体; font-size:11pt">两个</span><span style="font-family:等线; font-size:11pt">NN</span><span
            style="font-family:宋体; font-size:11pt">都为</span><span
            style="font-family:等线; font-size:11pt">Active</span><span
            style="font-family:宋体; font-size:11pt">状态</span><span style="font-family:等线; font-size:11pt">(split-brain scenario)</span><span
            style="font-family:宋体; font-size:11pt">。</span><span style="font-family:宋体; font-size:11pt">当发生</span><span
            style="font-family:等线; font-size:11pt">failover</span><span style="font-family:宋体; font-size:11pt">时，</span><span
            style="font-family:等线; font-size:11pt">Standby</span><span style="font-family:宋体; font-size:11pt">节点要</span><span
            style="font-family:宋体; font-size:11pt">先</span><span style="font-family:宋体; font-size:11pt">执行</span><span
            style="font-family:等线; font-size:11pt">fence</span><span
            style="font-family:宋体; font-size:11pt">方法把</span><span
            style="font-family:等线; font-size:11pt">old-</span><span style="font-family:等线; font-size:11pt">Active</span><span
            style="font-family:宋体; font-size:11pt">节点中不健康的</span><span
            style="font-family:等线; font-size:11pt">NameNode</span><span style="font-family:宋体; font-size:11pt">服务给杀掉（这个过程就称为</span><span
            style="font-family:等线; font-size:11pt">fence</span><span
            style="font-family:宋体; font-size:11pt">）</span><span
            style="font-family:宋体; font-size:11pt">，然后再提升为</span><span
            style="font-family:等线; font-size:11pt">active</span><span
            style="font-family:宋体; font-size:11pt">。</span><span
            style="font-family:等线; font-size:11pt">fence</span><span
            style="font-family:宋体; font-size:11pt">有</span><span style="font-family:等线; font-size:11pt">2</span><span
            style="font-family:宋体; font-size:11pt">种，</span><span style="font-family:等线; font-size:11pt">sshfence</span><span
            style="font-family:宋体; font-size:11pt">和</span><span
            style="font-family:等线; font-size:11pt">shell</span><span style="font-family:宋体; font-size:11pt">。</span>
    </h5><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">{2}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:等线; font-size:11pt">&lt;</span><span
            style="font-family:等线; font-size:11pt">value</span><span
            style="font-family:等线; font-size:11pt">&gt;</span><span
            style="font-family:宋体; font-size:11pt">的所有方法都会被顺序的执行</span><span style="font-family:宋体; font-size:11pt">，是一个回车分割的列表</span><span
            style="font-family:宋体; font-size:11pt">，最后返回结果即为</span><span
            style="font-family:等线; font-size:11pt">fence</span><span
            style="font-family:宋体; font-size:11pt">过程的结果。如果</span><span
            style="font-family:等线; font-size:11pt">fence</span><span
            style="font-family:宋体; font-size:11pt">执行成功，就把原来为</span><span
            style="font-family:等线; font-size:11pt">Standby</span><span
            style="font-family:宋体; font-size:11pt">的</span><span
            style="font-family:等线; font-size:11pt">NameNode</span><span
            style="font-family:宋体; font-size:11pt">的状态提升为</span><span
            style="font-family:等线; font-size:11pt">Active</span><span
            style="font-family:宋体; font-size:11pt">。</span><span
            style="font-family:等线; font-size:11pt">sshfence</span><span
            style="font-family:宋体; font-size:11pt">方法会通过</span><span
            style="font-family:等线; font-size:11pt">ssh</span><span
            style="font-family:宋体; font-size:11pt">远程调用</span><span
            style="font-family:等线; font-size:11pt">fuser</span><span style="font-family:宋体; font-size:11pt">命令去找到</span><span
            style="font-family:等线; font-size:11pt">NameNode</span><span style="font-family:宋体; font-size:11pt">服务并杀死它。我们的目标是当发生</span><span
            style="font-family:等线; font-size:11pt">failover</span><span style="font-family:宋体; font-size:11pt">时，不论如何，就算前面的</span><span
            style="font-family:等线; font-size:11pt">sshfence</span><span style="font-family:宋体; font-size:11pt">执行失败（比如服务器上不存在</span><span
            style="font-family:等线; font-size:11pt">fuser</span><span
            style="font-family:宋体; font-size:11pt">命令），依然把</span><span
            style="font-family:等线; font-size:11pt">Standby</span><span
            style="font-family:宋体; font-size:11pt">节点的状态提升为</span><span
            style="font-family:等线; font-size:11pt">Active</span><span style="font-family:宋体; font-size:11pt">，所以最后无论如何要配置一个</span><span
            style="font-family:等线; font-size:11pt">shell(/bin/true)</span><span
            style="font-family:宋体; font-size:11pt">，</span><span
            style="font-family:宋体; font-size:11pt">也就是托底方法。</span><span style="font-family:宋体; font-size:11pt">保证不论前面的方法执行的情况如何，最后</span><span
            style="font-family:等线; font-size:11pt">fence</span><span
            style="font-family:宋体; font-size:11pt">过程返回的结果都为</span><span
            style="font-family:等线; font-size:11pt">true</span><span style="font-family:宋体; font-size:11pt">。</span><span
            style="font-family:等线; font-size:11pt">dfs.ha.fencing.ssh.private-key-files</span><span
            style="font-family:宋体; font-size:11pt">配置了</span><span
            style="font-family:宋体; font-size:11pt">执行远程</span><span
            style="font-family:等线; font-size:11pt">ssh</span><span
            style="font-family:宋体; font-size:11pt">命令所需要用到的私</span><span style="font-family:宋体; font-size:11pt">钥</span><span
            style="font-family:宋体; font-size:11pt">。</span></h5>
    <table cellspacing="0" cellpadding="0" style="border-collapse:collapse; margin-left:63pt">
        <tr>
            <td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; padding-left:5.03pt; padding-right:5.03pt; vertical-align:top; width:404pt">
                <p style="line-height:11pt; margin:0pt"><span
                        style="color:#000080; font-family:Consolas; font-size:11pt">&lt;property&gt;</span></p>
                <p style="line-height:11pt; margin:0pt"><span
                        style="color:#333333; font-family:Consolas; font-size:11pt">    </span><span
                        style="color:#000080; font-family:Consolas; font-size:11pt">&lt;name&gt;</span><span
                        style="color:#333333; font-family:Consolas; font-size:11pt">dfs.</span><span
                        style="color:#333333; font-family:Consolas; font-size:11pt">ha.fencing</span><span
                        style="color:#333333; font-family:Consolas; font-size:11pt">.methods</span><span
                        style="color:#000080; font-family:Consolas; font-size:11pt">&lt;/name&gt;</span></p>
                <p style="line-height:11pt; margin:0pt"><span
                        style="color:#333333; font-family:Consolas; font-size:11pt">    </span><span
                        style="color:#000080; font-family:Consolas; font-size:11pt">&lt;value&gt;</span></p>
                <p style="line-height:11pt; margin:0pt"><span
                        style="color:#333333; font-family:Consolas; font-size:11pt">        sshfence</span></p>
                <p style="line-height:11pt; margin:0pt"><span
                        style="color:#333333; font-family:Consolas; font-size:11pt">        shell(/bin/true)</span></p>
                <p style="line-height:11pt; margin:0pt"><span
                        style="color:#333333; font-family:Consolas; font-size:11pt">    </span><span
                        style="color:#000080; font-family:Consolas; font-size:11pt">&lt;/value&gt;</span></p>
                <p style="line-height:11pt; margin:0pt"><span
                        style="color:#000080; font-family:Consolas; font-size:11pt">&lt;/property&gt;</span></p>
                <p style="line-height:11pt; margin:0pt"><span
                        style="color:#000080; font-family:Consolas; font-size:11pt">&lt;property&gt;</span></p>
                <p style="line-height:11pt; margin:0pt"><span
                        style="color:#333333; font-family:Consolas; font-size:11pt">    </span><span
                        style="color:#000080; font-family:Consolas; font-size:11pt">&lt;name&gt;</span><span
                        style="color:#333333; font-family:Consolas; font-size:11pt">dfs.ha.fencing.ssh.private</span><span
                        style="color:#333333; font-family:Consolas; font-size:11pt">-key-files</span><span
                        style="color:#000080; font-family:Consolas; font-size:11pt">&lt;/name&gt;</span></p>
                <p style="line-height:11pt; margin:0pt"><span
                        style="color:#333333; font-family:Consolas; font-size:11pt">    </span><span
                        style="color:#000080; font-family:Consolas; font-size:11pt">&lt;value&gt;</span><span
                        style="color:#333333; font-family:Consolas; font-size:11pt">/home/</span><span
                        style="color:#333333; font-family:Consolas; font-size:11pt">dc</span><span
                        style="color:#333333; font-family:Consolas; font-size:11pt">/.ssh/id_rsa</span><span
                        style="color:#000080; font-family:Consolas; font-size:11pt">&lt;/value&gt;</span></p>
                <p style="line-height:11pt; margin:0pt"><span
                        style="color:#000080; font-family:Consolas; font-size:11pt">&lt;/property&gt;</span></p></td>
        </tr>
    </table>
    <h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span
            style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">6.2.10</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt">部署细节</span></h4><h5
            style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">{1}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt">所有必要的设置完成后，必须先开启</span><span style="font-family:等线; font-size:11pt">JN</span><span
            style="font-family:宋体; font-size:11pt">进程，使用</span><span style="font-family:等线; font-size:11pt">hadoop-daemon.sh start journalnode</span>
    </h5><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">{2}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt">一旦</span><span style="font-family:等线; font-size:11pt">JN</span><span
            style="font-family:宋体; font-size:11pt">集群启动完毕，必须</span><span
            style="font-family:宋体; font-size:11pt">首先同步两个</span><span
            style="font-family:等线; font-size:11pt">HA namenode</span><span
            style="font-family:宋体; font-size:11pt">的磁盘元数据</span></h5><h6
            style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">[1]</span><span style="font:7.0pt 'Times New Roman'"> </span><span
            style="font-family:宋体; font-size:11pt">如果要设置新的</span><span
            style="font-family:等线; font-size:11pt">HDFS</span><span
            style="font-family:宋体; font-size:11pt">集群，应该首先在其中一个</span><span style="font-family:等线; font-size:11pt">namenode</span><span
            style="font-family:宋体; font-size:11pt">上运行</span><span
            style="font-family:等线; font-size:11pt">format</span><span
            style="font-family:宋体; font-size:11pt">命令</span><span style="font-family:等线; font-size:11pt">(HDFS namenode -format)</span>
    </h6><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span
            style="color:#ff0000; font-family:等线; font-size:11pt">[2]</span><span
            style="font:7.0pt 'Times New Roman'"> </span><span
            style="font-family:宋体; font-size:11pt">如果您已经格式化了</span><span
            style="font-family:等线; font-size:11pt">NameNode</span><span
            style="font-family:宋体; font-size:11pt">，或者正在将不支持</span><span
            style="font-family:等线; font-size:11pt">ha</span><span style="font-family:宋体; font-size:11pt">的集群转换为支持</span><span
            style="font-family:等线; font-size:11pt">ha</span><span style="font-family:宋体; font-size:11pt">的集群，那么现在应该通过在未格式化的</span><span
            style="font-family:等线; font-size:11pt">NameNode</span><span
            style="font-family:宋体; font-size:11pt">上运行</span><span style="font-family:等线; font-size:11pt">“hdfs NameNode -bootstrapStandby”</span><span
            style="font-family:宋体; font-size:11pt">命令，将</span><span style="font-family:宋体; font-size:11pt">已经格式化的</span><span
            style="font-family:等线; font-size:11pt">NameNode</span><span style="font-family:宋体; font-size:11pt">元数据目录的内容复制到</span><span
            style="font-family:宋体; font-size:11pt">当前</span><span
            style="font-family:宋体; font-size:11pt">未格式化的</span><span
            style="font-family:等线; font-size:11pt">NameNode</span><span
            style="font-family:宋体; font-size:11pt">。</span><span style="color:#ff0000; font-family:宋体; font-size:11pt">运行此命令还将确保</span><span
            style="color:#ff0000; font-family:等线; font-size:11pt">JournalNodes(</span><span
            style="color:#ff0000; font-family:宋体; font-size:11pt">由</span><span
            style="color:#ff0000; font-family:等线; font-size:11pt">dfs.namenode.share .edit .dir</span><span
            style="color:#ff0000; font-family:宋体; font-size:11pt">配置</span><span
            style="color:#ff0000; font-family:等线; font-size:11pt">)</span><span
            style="color:#ff0000; font-family:宋体; font-size:11pt">包含足够的编辑事务，以便能够启动两个</span><span
            style="color:#ff0000; font-family:等线; font-size:11pt">namenode</span></h6><h6
            style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">[3]</span><span style="font:7.0pt 'Times New Roman'"> </span><span
            style="font-family:宋体; font-size:11pt">如果要将非</span><span
            style="font-family:等线; font-size:11pt">HA NameNode</span><span
            style="font-family:宋体; font-size:11pt">转换为</span><span style="font-family:等线; font-size:11pt">HA</span><span
            style="font-family:宋体; font-size:11pt">，应该运行</span><span style="font-family:等线; font-size:11pt">“hdfs NameNode - initializesharede”</span><span
            style="font-family:宋体; font-size:11pt">命令，该命令将使用本地</span><span style="font-family:等线; font-size:11pt">NameNode</span><span
            style="font-family:宋体; font-size:11pt">编辑目录中的编辑数据初始化</span><span
            style="font-family:等线; font-size:11pt">JN</span><span style="font-family:宋体; font-size:11pt">集群</span></h6>
    <h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">{3}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt">此时，您可以启动两个</span><span style="font-family:等线; font-size:11pt">HA NameNode</span><span
            style="font-family:宋体; font-size:11pt">，就像您通常启动</span><span
            style="font-family:等线; font-size:11pt">NameNode</span><span style="font-family:宋体; font-size:11pt">一样</span>
    </h5><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">{4}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt">您可以通过浏览它们配置的</span><span
            style="font-family:等线; font-size:11pt">HTTP</span><span
            style="font-family:宋体; font-size:11pt">地址来分别访问</span><span
            style="font-family:等线; font-size:11pt">namenode</span><span
            style="font-family:宋体; font-size:11pt">的每个</span><span
            style="font-family:等线; font-size:11pt">web</span><span style="font-family:宋体; font-size:11pt">页面。您应该注意到，在配置的地址旁边是</span><span
            style="font-family:等线; font-size:11pt">NameNode</span><span
            style="font-family:宋体; font-size:11pt">的</span><span style="font-family:等线; font-size:11pt">HA</span><span
            style="font-family:宋体; font-size:11pt">状态</span><span style="font-family:等线; font-size:11pt">(“</span><span
            style="font-family:宋体; font-size:11pt">备用</span><span style="font-family:等线; font-size:11pt">”</span><span
            style="font-family:宋体; font-size:11pt">或</span><span style="font-family:等线; font-size:11pt">“</span><span
            style="font-family:宋体; font-size:11pt">活动</span><span style="font-family:等线; font-size:11pt">”)</span><span
            style="font-family:宋体; font-size:11pt">。无论何时启动</span><span style="font-family:等线; font-size:11pt">HA NameNode</span><span
            style="font-family:宋体; font-size:11pt">，它最初都处于备用状态</span></h5><h4
            style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span
            style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">6.2.11</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt">命令</span></h4><h5
            style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">{1}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt">现在已经配置并启动了</span><span style="font-family:等线; font-size:11pt">HA namenode</span><span
            style="font-family:宋体; font-size:11pt">，您将可以访问一些额外的命令来管理</span><span style="font-family:等线; font-size:11pt">HA HDFS</span><span
            style="font-family:宋体; font-size:11pt">集群。具体来说，您应该熟悉</span><span style="font-family:等线; font-size:11pt">“hdfs haadmin”</span><span
            style="font-family:宋体; font-size:11pt">命令的所有子命令。</span></h5>
    <p style="background-color:#ffffff; margin:6pt 0pt 6pt 84pt"><span style="font-family:宋体; font-size:10pt">Usage: haadmin</span>
    </p>
    <p style="background-color:#ffffff; margin:0pt 0pt 0pt 84pt"><span style="font-family:宋体; font-size:10pt">    [-transitionToActive &lt;serviceId&gt;]</span>
    </p>
    <p style="background-color:#ffffff; margin:0pt 0pt 0pt 84pt"><span style="font-family:宋体; font-size:10pt">    [-transitionToStandby &lt;serviceId&gt;]</span>
    </p>
    <p style="background-color:#ffffff; margin:0pt 0pt 0pt 84pt"><span style="font-family:宋体; font-size:10pt">    [-failover [--forcefence] [--forceactive] &lt;serviceId&gt; &lt;serviceId&gt;]</span>
    </p>
    <p style="background-color:#ffffff; margin:0pt 0pt 0pt 84pt"><span style="font-family:宋体; font-size:10pt">    [-getServiceState &lt;serviceId&gt;]</span>
    </p>
    <p style="background-color:#ffffff; margin:0pt 0pt 0pt 84pt"><span style="font-family:宋体; font-size:10pt">    [-checkHealth &lt;serviceId&gt;]</span>
    </p>
    <p style="background-color:#ffffff; margin:6pt 0pt 6pt 84pt; text-indent:20.25pt"><span
            style="font-family:宋体; font-size:10pt">[-help &lt;command&gt;]</span></p><h5
            style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">{2}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt">下面这个指南描述了上面命令的高级用法，</span></h5><h6
            style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">[1]</span><span style="font:7.0pt 'Times New Roman'"> </span><span
            style="font-family:等线; font-size:11pt">transitionToActive and transitionToStandby</span></h6>
    <p style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 85.05pt; page-break-after:avoid; page-break-inside:avoid; text-indent:0pt">
        <span style="font-family:'等线 Light'; font-size:11pt">(1)</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="color:#1f3864; font-family:'等线 Light'; font-size:11pt">转变给定的a或s的状态</span></p>
    <p style="line-height:12pt; margin:7.8pt 0pt 7.8pt 84pt"><span
            style="font-family:等线; font-size:12pt">这些子命令分别将给定的</span><span style="font-family:等线; font-size:12pt">NameNode转换为活动状态或备用状态。这些命令不尝试执行任何</span><span
            style="font-family:等线; font-size:12pt">fence隔离方法</span><span
            style="font-family:等线; font-size:12pt">，因此</span><span
            style="font-family:等线; font-size:12pt">一般不</span><span style="font-family:等线; font-size:12pt">使</span><span
            style="font-family:等线; font-size:12pt">用</span><span style="font-family:等线; font-size:12pt">。应该使用“hdfs haadmin -failover”子命令</span><span
            style="font-family:等线; font-size:12pt">替代</span></p><h6
            style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">[2]</span><span style="font:7.0pt 'Times New Roman'"> </span><span
            style="font-family:等线; font-size:11pt">failover</span><span style="font-family:等线; font-size:11pt"> </span>
    </h6>
    <p style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 85.05pt; page-break-after:avoid; page-break-inside:avoid; text-indent:0pt">
        <span style="font-family:'等线 Light'; font-size:11pt">(1)</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="color:#1f3864; font-family:'等线 Light'; font-size:11pt">启动两个</span><span
            style="color:#1f3864; font-family:'等线 Light'; font-size:11pt">namenode之间的故障转移</span></p>
    <p style="line-height:12pt; margin:7.8pt 0pt 7.8pt 84pt"><span
            style="font-family:等线; font-size:12pt">这个子命令</span><span
            style="font-family:等线; font-size:12pt">会</span><span style="font-family:等线; font-size:12pt">触发</span><span
            style="font-family:等线; font-size:12pt">2个NN的故障转移机制</span><span
            style="font-family:等线; font-size:12pt">。</span></p>
    <p style="line-height:12pt; margin:7.8pt 0pt 7.8pt 84pt"><span style="font-family:等线; font-size:12pt">如果第一个NameNode处于</span><span
            style="font-family:等线; font-size:12pt">standby</span><span style="font-family:等线; font-size:12pt">，则此命令将第二个NameNode转换为</span><span
            style="font-family:等线; font-size:12pt">active</span><span
            style="font-family:等线; font-size:12pt">，不会</span><span style="font-family:等线; font-size:12pt">报错</span><span
            style="font-family:等线; font-size:12pt">。</span></p>
    <p style="line-height:12pt; margin:7.8pt 0pt 7.8pt 84pt"><span style="font-family:等线; font-size:12pt">如果第一个NameNode处于</span><span
            style="font-family:等线; font-size:12pt">acitve</span><span style="font-family:等线; font-size:12pt">，则尝试将其优雅地转换为</span><span
            style="font-family:等线; font-size:12pt">standby</span><span style="font-family:等线; font-size:12pt">。如果失败，将依次尝试</span><span
            style="font-family:等线; font-size:12pt">隔离方法</span><span
            style="font-family:等线; font-size:12pt">方法</span><span style="font-family:等线; font-size:12pt">(由dfs.ha. fence .methods配置</span><span
            style="font-family:等线; font-size:12pt">，回车分隔，多个</span><span style="font-family:等线; font-size:12pt">)，直到成功为止。只有</span><span
            style="font-family:等线; font-size:12pt">隔离方法返回true</span><span style="font-family:等线; font-size:12pt">，第二个NameNode才会被转换为</span><span
            style="font-family:等线; font-size:12pt">active</span><span
            style="font-family:等线; font-size:12pt">。如果</span><span
            style="font-family:等线; font-size:12pt">fence</span><span
            style="font-family:等线; font-size:12pt">方法</span><span
            style="font-family:等线; font-size:12pt">执行到最后一个都没有成功</span><span style="font-family:等线; font-size:12pt">，第二个NameNode将不会转换为</span><span
            style="font-family:等线; font-size:12pt">active</span><span
            style="font-family:等线; font-size:12pt">，并返回一个错误</span></p><h6
            style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">[3]</span><span style="font:7.0pt 'Times New Roman'"> </span><span
            style="font-family:等线; font-size:11pt">getServiceState</span></h6>
    <p style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 85.05pt; page-break-after:avoid; page-break-inside:avoid; text-indent:0pt">
        <span style="font-family:'等线 Light'; font-size:11pt">(1)</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="color:#1f3864; font-family:'等线 Light'; font-size:11pt">确定给定的</span><span
            style="color:#1f3864; font-family:'等线 Light'; font-size:11pt">NameNode是活动的还是备用的</span></p>
    <p style="line-height:12pt; margin:7.8pt 0pt 7.8pt 84pt"><span
            style="font-family:等线; font-size:12pt">连接到提供的</span><span style="font-family:等线; font-size:12pt">NameNode以确定其当前状态，将“standby”或“active”打印到标准输出。cron作业或监视脚本可能会使用这个子命令，它们需要根据NameNode当前是活动的还是备用的而采取不同的行为</span>
    </p><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">[4]</span><span style="font:7.0pt 'Times New Roman'"> </span><span
            style="font-family:等线; font-size:11pt">checkHealth</span></h6>
    <p style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 85.05pt; page-break-after:avoid; page-break-inside:avoid; text-indent:0pt">
        <span style="font-family:'等线 Light'; font-size:11pt">(1)</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="color:#1f3864; font-family:'等线 Light'; font-size:11pt">检查给定</span><span
            style="color:#1f3864; font-family:'等线 Light'; font-size:11pt">NameNode的健康状况</span></p>
    <p style="line-height:12pt; margin:7.8pt 0pt 7.8pt 84pt"><span
            style="font-family:等线; font-size:12pt">连接到提供的</span><span style="font-family:等线; font-size:12pt">NameNode以检查其健康状况。NameNode能够对自身执行一些诊断，包括检查内部服务是否按预期运行。如果NameNode是健康的，这个命令将返回0，否则返回非0。可以使用此命令进行监视</span>
    </p>
    <p style="line-height:12pt; margin:7.8pt 0pt 7.8pt 84pt"><span
            style="font-family:等线; font-size:12pt">此命令还没有实现既定功能，</span><span style="font-family:等线; font-size:12pt">目前总是返回成功，除非给定的</span><span
            style="font-family:等线; font-size:12pt">NameNode完全关闭</span></p>
    <p style="line-height:10.5pt; margin:7.8pt 0pt"><span style="font-family:等线; font-size:10.5pt">&#xa0;</span></p>
    <h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt; font-style:normal">6.3</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt; font-weight:bold">自动故障转移</span></h3><h4
            style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span
            style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">6.3.1</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt">简介</span></h4><h5
            style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">{1}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt">上面的部分描述了如何配置手动故障转移。在这种模式下</span><span
            style="font-family:等线; font-size:11pt">,</span><span style="font-family:宋体; font-size:11pt">系统不会自动触发从</span><span
            style="font-family:等线; font-size:11pt">active</span><span
            style="font-family:宋体; font-size:11pt">到</span><span style="font-family:等线; font-size:11pt">SNN</span><span
            style="font-family:宋体; font-size:11pt">的故障转移</span><span
            style="font-family:宋体; font-size:11pt">，</span><span style="font-family:等线; font-size:11pt">,</span><span
            style="font-family:宋体; font-size:11pt">即使</span><span style="font-family:等线; font-size:11pt">ANN</span><span
            style="font-family:宋体; font-size:11pt">宕</span><span style="font-family:宋体; font-size:11pt">机了</span><span
            style="font-family:宋体; font-size:11pt">。本节描述如何配置和部署自动故障转移</span></h5><h4
            style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span
            style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">6.3.2</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt">组件</span></h4><h5
            style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">{1}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt">自动故障转移向</span><span
            style="font-family:等线; font-size:11pt">HDFS</span><span
            style="font-family:宋体; font-size:11pt">部署添加了两个新组件</span><span style="font-family:等线; font-size:11pt">:ZooKeeper quorum</span><span
            style="font-family:宋体; font-size:11pt">和</span><span style="font-family:等线; font-size:11pt">ZKFailoverController</span><span
            style="font-family:宋体; font-size:11pt">进程</span><span style="font-family:等线; font-size:11pt">(</span><span
            style="font-family:宋体; font-size:11pt">缩写为</span><span style="font-family:等线; font-size:11pt">ZKFC)</span>
    </h5><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">{2}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:等线; font-size:11pt">Apache ZooKeeper</span><span style="font-family:宋体; font-size:11pt">是一种高可用性的服务，用于维护少量的协调数据、通知客户端数据的更改以及监控客户端故障。自动</span><span
            style="font-family:等线; font-size:11pt">HDFS</span><span style="font-family:宋体; font-size:11pt">故障转移的实现在以下方面依赖于</span><span
            style="font-family:等线; font-size:11pt">ZooKeeper</span></h5><h6
            style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">[1]</span><span style="font:7.0pt 'Times New Roman'"> </span><span
            style="font-family:宋体; font-size:11pt">失败检测</span></h6>
    <p style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 85.05pt; page-break-after:avoid; page-break-inside:avoid; text-indent:0pt">
        <span style="font-family:'等线 Light'; font-size:11pt">(1)</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="color:#1f3864; font-family:'等线 Light'; font-size:11pt">集群中的每个</span><span
            style="color:#1f3864; font-family:'等线 Light'; font-size:11pt">NameNode机器都在ZooKeeper中维护一个持久会话。如果机器崩溃，ZooKeeper会话将到期，通知另一个NameNode应该触发故障转移</span>
    </p><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">[2]</span><span style="font:7.0pt 'Times New Roman'"> </span><span
            style="font-family:宋体; font-size:11pt">选举</span><span style="font-family:等线; font-size:11pt">ANN</span></h6>
    <p style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 85.05pt; page-break-after:avoid; page-break-inside:avoid; text-indent:0pt">
        <span style="font-family:'等线 Light'; font-size:11pt">(1)</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="color:#1f3864; font-family:'等线 Light'; font-size:11pt">ZooKeeper提供了一个简单的机制来</span><span
            style="color:#1f3864; font-family:'等线 Light'; font-size:11pt">选举</span><span
            style="color:#1f3864; font-family:'等线 Light'; font-size:11pt">一个</span><span
            style="color:#1f3864; font-family:'等线 Light'; font-size:11pt">ANN</span><span
            style="color:#1f3864; font-family:'等线 Light'; font-size:11pt">。如果当前</span><span
            style="color:#1f3864; font-family:'等线 Light'; font-size:11pt">ANN</span><span
            style="color:#1f3864; font-family:'等线 Light'; font-size:11pt">崩溃，则另一个节点可能在ZooKeeper中获取一个独占锁，指示它应该成为下一个</span><span
            style="color:#1f3864; font-family:'等线 Light'; font-size:11pt">ANN</span></p><h5
            style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">{3}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:等线; font-size:11pt">ZKFailoverController (ZKFC)</span><span
            style="font-family:宋体; font-size:11pt">是一个新的组件，它是</span><span
            style="font-family:等线; font-size:11pt">hadoop</span><span
            style="font-family:宋体; font-size:11pt">提供的</span><span style="font-family:宋体; font-size:11pt">一个</span><span
            style="font-family:等线; font-size:11pt">ZooKeeper</span><span style="font-family:宋体; font-size:11pt">客户端，同时监控和管理</span><span
            style="font-family:等线; font-size:11pt">NameNode</span><span
            style="font-family:宋体; font-size:11pt">的状态。运行</span><span
            style="font-family:等线; font-size:11pt">NameNode</span><span
            style="font-family:宋体; font-size:11pt">的每台机器也运行</span><span
            style="font-family:宋体; font-size:11pt">着一个</span><span
            style="font-family:等线; font-size:11pt">ZKFC</span><span style="font-family:宋体; font-size:11pt">，</span><span
            style="font-family:等线; font-size:11pt">zkfc</span><span style="font-family:宋体; font-size:11pt">的作用：</span>
    </h5><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">[1]</span><span style="font:7.0pt 'Times New Roman'"> </span><span
            style="font-family:宋体; font-size:11pt">健康检查</span></h6>
    <p style="line-height:12pt; margin:7.8pt 0pt 7.8pt 63pt; text-indent:21pt"><span
            style="font-family:等线; font-size:12pt">ZKFC通过一个健康检查命令定期ping它</span><span
            style="font-family:等线; font-size:12pt">的</span><span style="font-family:等线; font-size:12pt">本地NameNode。只要NameNode及时</span><span
            style="font-family:等线; font-size:12pt">并且以</span><span style="font-family:等线; font-size:12pt">健康状态响应，ZKFC就认为节点是健康的。如果节点崩溃、冻结或以其他方式进入不健康状态，则健康监视器将其标记为不健康</span>
    </p><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">[2]</span><span style="font:7.0pt 'Times New Roman'"> </span><span
            style="font-family:等线; font-size:11pt">ZooKeeper session management</span></h6>
    <p style="line-height:12pt; margin:7.8pt 0pt 7.8pt 63pt; text-indent:21pt"><span
            style="font-family:等线; font-size:12pt">如果本地NN</span><span style="font-family:等线; font-size:12pt">是健康的，ZKFC会在ZooKeeper中打开一个会话。如果本地NameNode是活动的，它还持有一个特殊的znode</span><span
            style="font-family:等线; font-size:12pt">：</span><span style="font-family:等线; font-size:12pt">“锁”</span><span
            style="font-family:等线; font-size:12pt">。此锁使用ZooKeeper的</span><span style="font-family:等线; font-size:12pt">临时节点</span><span
            style="font-family:等线; font-size:12pt">;如果会话过期，锁节点将被自动删除</span></p><h6
            style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">[3]</span><span style="font:7.0pt 'Times New Roman'"> </span><span
            style="font-family:等线; font-size:11pt">ZooKeeper-based election</span></h6>
    <p style="line-height:12pt; margin:7.8pt 0pt 7.8pt 70.9pt; text-indent:13.1pt"><span
            style="font-family:等线; font-size:12pt">如果本地NameNode是健康的,ZKFC看到没有其他节点保存锁znode,它就会试图获得锁。如果成功,那么它就“赢得了选举”,并负责运行一个故障转移,使其本地NameNode</span><span
            style="font-family:等线; font-size:12pt">转为active</span><span style="font-family:等线; font-size:12pt">。故障转移过程类似于上面描述的手动故障转移:首先,</span><span
            style="font-family:等线; font-size:12pt">之前的ANN被成功的割裂。</span><span style="font-family:等线; font-size:12pt">然后本地NameNode转换到活动状态</span>
    </p><h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span
            style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">6.3.3</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:等线; font-size:11pt">core-site.xml</span></h4>
    <p style="background-color:#ffffff; margin:6pt 0pt 6pt 52.5pt"><span style="font-family:宋体; font-size:10pt">&lt;property&gt;</span>
    </p>
    <p style="background-color:#ffffff; margin:0pt 0pt 0pt 52.5pt"><span style="font-family:宋体; font-size:10pt">   &lt;name&gt;</span><span
            style="font-family:宋体; font-size:10pt">ha.zookeeper</span><span style="font-family:宋体; font-size:10pt">.quorum&lt;/name&gt;</span>
    </p>
    <p style="background-color:#ffffff; margin:0pt 0pt 0pt 52.5pt"><span style="font-family:宋体; font-size:10pt">   &lt;value&gt;</span><span
            style="font-family:宋体; font-size:10pt">zk1.example.com:2181,zk2.example.com:2181</span><span
            style="font-family:宋体; font-size:10pt">,zk3.example.com:2181&lt;/value&gt;</span></p>
    <p style="background-color:#ffffff; margin:6pt 0pt 6pt 52.5pt"><span style="font-family:宋体; font-size:10pt"> &lt;/property&gt;</span>
    </p><h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span
            style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">6.3.4</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:等线; font-size:11pt">hdfs-site.xml</span></h4>
    <p style="background-color:#ffffff; margin:6pt 0pt 6pt 42pt; text-indent:10.5pt"><span
            style="font-family:宋体; font-size:10pt">&lt;property&gt;</span></p>
    <p style="background-color:#ffffff; margin:0pt 0pt 0pt 42pt"><span style="font-family:宋体; font-size:10pt">   &lt;name&gt;dfs.</span><span
            style="font-family:宋体; font-size:10pt">ha.automatic</span><span style="font-family:宋体; font-size:10pt">-failover.enabled&lt;/name&gt;</span>
    </p>
    <p style="background-color:#ffffff; margin:0pt 0pt 0pt 42pt"><span style="font-family:宋体; font-size:10pt">   &lt;value&gt;true&lt;/value&gt;</span>
    </p>
    <p style="background-color:#ffffff; margin:6pt 0pt 6pt 42pt"><span style="font-family:宋体; font-size:10pt"> &lt;/property&gt;</span>
    </p><h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span
            style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">6.3.5</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt">在</span><span style="font-family:等线; font-size:11pt">zk</span><span
            style="font-family:宋体; font-size:11pt">上初始化</span></h4>
    <p style="background-color:#ffffff; margin:6pt 0pt"><span
            style="width:45.8pt; text-indent:0pt; display:inline-block; -aw-tabstop-align:left; -aw-tabstop-pos:45.8pt"></span><span
            style="width:6.45pt; text-indent:0pt; display:inline-block; -aw-tabstop-align:left; -aw-tabstop-pos:52.25pt"></span><span
            style="font-family:宋体; font-size:11pt">bin/hdfs zkfc -formatZK</span></p>
    <p style="background-color:#ffffff; margin:6pt 0pt"><span
            style="width:45.8pt; text-indent:0pt; display:inline-block; -aw-tabstop-align:left; -aw-tabstop-pos:45.8pt"></span><span
            style="width:6.45pt; text-indent:0pt; display:inline-block; -aw-tabstop-align:left; -aw-tabstop-pos:52.25pt"></span><span
            style="font-family:宋体; font-size:11pt">这将在</span><span style="font-family:宋体; font-size:11pt">ZooKeeper中创建一个znode，自动故障转移系统将其数据存储在znode中</span>
    </p><h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span
            style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">6.3.6</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt">使用群起脚本</span><span style="font-family:等线; font-size:11pt">start-dfs.sh</span><span
            style="font-family:宋体; font-size:11pt">启动集群</span></h4>
    <p style="line-height:12pt; margin:7.8pt 0pt 7.8pt 42pt; text-indent:21pt"><span
            style="background-color:#f7f8fa; color:#333333; font-family:等线; font-size:12pt">由于在配置中启用了自动故障转移，</span><span
            style="background-color:#f7f8fa; color:#333333; font-family:Arial; font-size:12pt">start-dfs.sh</span><span
            style="background-color:#f7f8fa; color:#333333; font-family:等线; font-size:12pt">脚本将在任何运行</span><span
            style="background-color:#f7f8fa; color:#333333; font-family:Arial; font-size:12pt">NN</span><span
            style="background-color:#f7f8fa; color:#333333; font-family:等线; font-size:12pt">的</span><span
            style="background-color:#f7f8fa; color:#333333; font-family:等线; font-size:12pt">节点</span><span
            style="background-color:#f7f8fa; color:#333333; font-family:等线; font-size:12pt">上自动启动</span><span
            style="background-color:#f7f8fa; color:#333333; font-family:Arial; font-size:12pt">ZKFC</span><span
            style="background-color:#f7f8fa; color:#333333; font-family:等线; font-size:12pt">守护进程。当</span><span
            style="background-color:#f7f8fa; color:#333333; font-family:Arial; font-size:12pt">zkfc</span><span
            style="background-color:#f7f8fa; color:#333333; font-family:等线; font-size:12pt">启动时，它们将自动选择要激活的</span><span
            style="background-color:#f7f8fa; color:#333333; font-family:Arial; font-size:12pt">namenode</span><span
            style="background-color:#f7f8fa; color:#333333; font-family:等线; font-size:12pt">之一</span></p><h5
            style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">{1}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt">也可以手动启动集群</span></h5>
    <p style="background-color:#ffffff; margin:6pt 0pt 6pt 63pt"><span style="font-family:宋体; font-size:12pt">sbin/hadoop-daemon.sh</span>
    </p>
    <p style="background-color:#ffffff; margin:6pt 0pt 6pt 63pt"><span style="font-family:宋体; font-size:12pt">bin/hdfs start zkfc</span>
    </p><h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span
            style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">6.3.7</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt">安全访问</span><span style="font-family:等线; font-size:11pt">zk</span>
    </h4><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">{1}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt">如果您正在运行一个安全集群</span><span
            style="font-family:等线; font-size:11pt">,</span><span
            style="font-family:宋体; font-size:11pt">您可能希望确保存储在</span><span style="font-family:等线; font-size:11pt">ZooKeeper</span><span
            style="font-family:宋体; font-size:11pt">的信息也安全。这可以防止恶意客户机修改</span><span
            style="font-family:等线; font-size:11pt">ZooKeeper</span><span
            style="font-family:宋体; font-size:11pt">的元数据</span><span style="font-family:等线; font-size:11pt">,</span><span
            style="font-family:宋体; font-size:11pt">或者可能触发错误故障转移</span></h5><h5
            style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">{2}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt">为了保护</span><span
            style="font-family:等线; font-size:11pt">ZooKeeper</span><span style="font-family:宋体; font-size:11pt">中的信息，首先将以下内容添加到您的</span><span
            style="font-family:等线; font-size:11pt">core-site.xml</span><span
            style="font-family:宋体; font-size:11pt">文件中</span></h5>
    <p style="background-color:#ffffff; margin:6pt 0pt 6pt 73.5pt"><span style="font-family:宋体; font-size:10pt">&lt;property&gt;</span>
    </p>
    <p style="background-color:#ffffff; margin:0pt 0pt 0pt 73.5pt"><span style="font-family:宋体; font-size:10pt">   &lt;name&gt;</span><span
            style="font-family:宋体; font-size:10pt">ha.zookeeper</span><span style="font-family:宋体; font-size:10pt">.auth&lt;/name&gt;</span>
    </p>
    <p style="background-color:#ffffff; margin:0pt 0pt 0pt 73.5pt"><span style="font-family:宋体; font-size:10pt">   &lt;value&gt;@/path/to/zk-auth.txt&lt;/value&gt;</span>
    </p>
    <p style="background-color:#ffffff; margin:0pt 0pt 0pt 73.5pt"><span style="font-family:宋体; font-size:10pt"> &lt;/property&gt;</span>
    </p>
    <p style="background-color:#ffffff; margin:0pt 0pt 0pt 73.5pt"><span style="font-family:宋体; font-size:10pt"> &lt;property&gt;</span>
    </p>
    <p style="background-color:#ffffff; margin:0pt 0pt 0pt 73.5pt"><span style="font-family:宋体; font-size:10pt">   &lt;name&gt;ha.zookeeper.acl&lt;/name&gt;</span>
    </p>
    <p style="background-color:#ffffff; margin:0pt 0pt 0pt 73.5pt"><span style="font-family:宋体; font-size:10pt">   &lt;value&gt;@/path/to/zk-acl.txt&lt;/value&gt;</span>
    </p>
    <p style="background-color:#ffffff; margin:6pt 0pt 6pt 73.5pt"><span style="font-family:宋体; font-size:10pt"> &lt;/property&gt;</span>
    </p><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">[1]</span><span style="font:7.0pt 'Times New Roman'"> </span><span
            style="font-family:宋体; font-size:11pt">请注意这些值中的“</span><span
            style="font-family:等线; font-size:11pt">@”</span><span style="font-family:宋体; font-size:11pt">字符</span><span
            style="font-family:等线; font-size:11pt">—</span><span style="font-family:宋体; font-size:11pt">这指定配置不是内联的，而是指向磁盘上的文件</span>
    </h6><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">[2]</span><span style="font:7.0pt 'Times New Roman'"> </span><span
            style="font-family:宋体; font-size:11pt">第一个配置文件指定了一个</span><span style="font-family:等线; font-size:11pt">ZooKeeper</span><span
            style="font-family:宋体; font-size:11pt">身份验证列表，其格式与</span><span
            style="font-family:等线; font-size:11pt">ZK CLI</span><span style="font-family:宋体; font-size:11pt">使用的格式相同。例如，您可以指定如下内容</span>
    </h6>
    <p style="background-color:#ffffff; margin:6pt 0pt"><span
            style="width:45.8pt; text-indent:0pt; display:inline-block; -aw-tabstop-align:left; -aw-tabstop-pos:45.8pt"></span><span
            style="width:35.7pt; text-indent:0pt; display:inline-block; -aw-tabstop-align:left; -aw-tabstop-pos:81.5pt"></span><span
            style="font-family:宋体; font-size:10pt">digest:hdfs</span><span style="font-family:宋体; font-size:10pt">-zkfcs:mypassword</span>
    </p><h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span
            style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">6.3.8</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt">测试</span><span style="font-family:宋体; font-size:11pt">自动故障转移</span>
    </h4><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">{1}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt">设置了自动故障转移之后，应该测试它的操作。为此，首先找到活动的</span><span
            style="font-family:等线; font-size:11pt">NameNode</span><span
            style="font-family:宋体; font-size:11pt">。您可以通过访问</span><span style="font-family:等线; font-size:11pt">NameNode web</span><span
            style="font-family:宋体; font-size:11pt">接口来判断哪个节点是活动的</span><span
            style="font-family:等线; font-size:11pt">——</span><span
            style="font-family:宋体; font-size:11pt">每个节点在页面的顶部报告其</span><span
            style="font-family:等线; font-size:11pt">HA</span><span style="font-family:宋体; font-size:11pt">状态</span></h5>
    <h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">{2}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt">一旦定位了活动的</span><span
            style="font-family:等线; font-size:11pt">NameNode</span><span
            style="font-family:宋体; font-size:11pt">，</span><span style="font-family:宋体; font-size:11pt">就可以</span><span
            style="font-family:宋体; font-size:11pt">认为认为</span><span
            style="font-family:宋体; font-size:11pt">故意制造一些故障</span><span
            style="font-family:宋体; font-size:11pt">。例如，您可以使用</span><span style="font-family:等线; font-size:11pt">kill -9 &lt;pid of NN&gt;</span><span
            style="font-family:宋体; font-size:11pt">来模拟</span><span
            style="font-family:等线; font-size:11pt">JVM</span><span style="font-family:宋体; font-size:11pt">崩溃。或者，您可以对机器进行电源循环或拔掉它的网络接口，以模拟不同类型的停机。在触发您希望测试的停机之后，另一个</span><span
            style="font-family:等线; font-size:11pt">NameNode</span><span style="font-family:宋体; font-size:11pt">应该在几秒钟内自动激活。检测故障并触发故障转移所需的时间取决于</span><span
            style="font-family:等线; font-size:11pt">ha.zookeeper.session-timeout</span><span
            style="font-family:宋体; font-size:11pt">的配置，但默认为</span><span
            style="font-family:等线; font-size:11pt">5</span><span style="font-family:宋体; font-size:11pt">秒</span></h5><h5
            style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">{3}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt">如果测试不成功，则可能是配置错误。检查</span><span
            style="font-family:等线; font-size:11pt">zkfc</span><span
            style="font-family:宋体; font-size:11pt">守护进程和</span><span
            style="font-family:等线; font-size:11pt">NameNode</span><span style="font-family:宋体; font-size:11pt">守护进程的日志，以便进一步诊断问题</span>
    </h5><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">{4}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt">自动故障转移问答</span></h5><h6
            style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">[1]</span><span style="font:7.0pt 'Times New Roman'"> </span><span
            style="font-family:等线; font-size:11pt">zkfc</span><span style="font-family:宋体; font-size:11pt">和</span><span
            style="font-family:等线; font-size:11pt">NN</span><span
            style="font-family:宋体; font-size:11pt">进程的启动顺序有先后吗？</span></h6>
    <p style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 85.05pt; page-break-after:avoid; page-break-inside:avoid; text-indent:0pt">
        <span style="font-family:'等线 Light'; font-size:11pt">(1)</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="color:#1f3864; font-family:'等线 Light'; font-size:11pt">没有，随意</span></p><h6
            style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">[2]</span><span style="font:7.0pt 'Times New Roman'"> </span><span
            style="font-family:宋体; font-size:11pt">我应该设置哪些额外的监视</span><span
            style="font-family:宋体; font-size:11pt">？</span></h6>
    <p style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 85.05pt; page-break-after:avoid; page-break-inside:avoid; text-indent:0pt">
        <span style="font-family:'等线 Light'; font-size:11pt">(1)</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="color:#1f3864; font-family:'等线 Light'; font-size:11pt">要添加zk的监控，您应该在运行</span><span
            style="color:#1f3864; font-family:'等线 Light'; font-size:11pt">NameNode的每个主机上添加监控，以确保ZKFC保持运行。例如，在某些类型的ZooKeeper故障中，ZKFC可能会意外退出，应该重新启动以确保系统准备好进行自动故障转移。</span><span
            style="color:#1f3864; font-family:'等线 Light'; font-size:11pt">另外，您应该监视</span><span
            style="color:#1f3864; font-family:'等线 Light'; font-size:11pt">ZooKeeper</span><span
            style="color:#1f3864; font-family:'等线 Light'; font-size:11pt">集群</span><span
            style="color:#1f3864; font-family:'等线 Light'; font-size:11pt">中的每个</span><span
            style="color:#1f3864; font-family:'等线 Light'; font-size:11pt">节点</span><span
            style="color:#1f3864; font-family:'等线 Light'; font-size:11pt">。如果</span><span
            style="color:#1f3864; font-family:'等线 Light'; font-size:11pt">zk</span><span
            style="color:#1f3864; font-family:'等线 Light'; font-size:11pt">崩溃，那么自动故障转移将不起作用</span></p><h6
            style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">[3]</span><span style="font:7.0pt 'Times New Roman'"> </span><span
            style="font-family:宋体; font-size:11pt">如果</span><span style="font-family:等线; font-size:11pt">zk</span><span
            style="font-family:宋体; font-size:11pt">崩溃会怎样？</span></h6>
    <p style="font-weight:normal; line-height:11pt; margin:6pt 0pt 6pt 85.05pt; page-break-after:avoid; page-break-inside:avoid; text-indent:0pt">
        <span style="font-family:'等线 Light'; font-size:11pt">(1)</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="color:#1f3864; font-family:'等线 Light'; font-size:11pt">如果</span><span
            style="color:#1f3864; font-family:'等线 Light'; font-size:11pt">ZooKeeper集群崩溃，则不会触发自动故障转移。但是，HDFS将继续运行，不会受到任何影响。当ZooKeeper重新启动时，HDFS将重新连接</span>
    </p><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">[4]</span><span style="font:7.0pt 'Times New Roman'"> </span><span
            style="font-family:宋体; font-size:11pt">可以指定</span><span
            style="font-family:等线; font-size:11pt">NN</span><span
            style="font-family:宋体; font-size:11pt">节点为优先</span><span
            style="font-family:等线; font-size:11pt">actice</span><span style="font-family:宋体; font-size:11pt">的吗？</span>
    </h6>
    <p style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 85.05pt; page-break-after:avoid; page-break-inside:avoid; text-indent:0pt">
        <span style="font-family:'等线 Light'; font-size:11pt">(1)</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="color:#1f3864; font-family:'等线 Light'; font-size:11pt">不。目前，这是不支持的。</span><span
            style="color:#1f3864; font-family:'等线 Light'; font-size:11pt">但是</span><span
            style="color:#1f3864; font-family:'等线 Light'; font-size:11pt">首先启动的</span><span
            style="color:#1f3864; font-family:'等线 Light'; font-size:11pt">NameNode将成为活动的。您可以选择以特定的顺序启动集群，以便首选节点首先启动</span>
    </p><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">[5]</span><span style="font:7.0pt 'Times New Roman'"> </span><span
            style="font-family:宋体; font-size:11pt">在配置自动故障转移</span><span
            style="font-family:宋体; font-size:11pt">的情况下</span><span
            style="font-family:宋体; font-size:11pt">启动手动故障转移</span></h6>
    <p style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 85.05pt; page-break-after:avoid; page-break-inside:avoid; text-indent:0pt">
        <span style="font-family:'等线 Light'; font-size:11pt">(1)</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="color:#1f3864; font-family:'等线 Light'; font-size:11pt">即使配置了自动故障转移，您也可以使用相同的</span><span
            style="color:#1f3864; font-family:'等线 Light'; font-size:11pt">hdfs haadmin命令启动手动故障转移。它将执行协调的故障转移</span></p>
    <h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span
            style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">6.3.9</span><span
            style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt">在</span><span style="font-family:等线; font-size:11pt">HA</span><span
            style="font-family:宋体; font-size:11pt">的集群上进行更新</span><span
            style="font-family:等线; font-size:11pt">/</span><span style="font-family:宋体; font-size:11pt">终结</span><span
            style="font-family:等线; font-size:11pt">/</span><span style="font-family:宋体; font-size:11pt">回滚</span><span
            style="font-family:等线; font-size:11pt">HDFS</span></h4><h5
            style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">{1}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt">当在不同版本的</span><span
            style="font-family:等线; font-size:11pt">HDFS</span><span style="font-family:宋体; font-size:11pt">之间移动时，有时可以简单地安装较新的软件并重新启动集群。然而，有时候，升级正在运行的</span><span
            style="font-family:等线; font-size:11pt">HDFS</span><span style="font-family:宋体; font-size:11pt">版本可能需要更改磁盘上的数据。在这种情况下，必须在安装新软件之后使用</span><span
            style="font-family:等线; font-size:11pt">HDFS Upgrade/Finalization/Rollback</span><span
            style="font-family:等线; font-size:11pt"> </span><span style="font-family:宋体; font-size:11pt">功能。在</span><span
            style="font-family:等线; font-size:11pt">HA</span><span style="font-family:宋体; font-size:11pt">环境中，这个过程会变得更加复杂，因为</span><span
            style="font-family:等线; font-size:11pt">NN</span><span style="font-family:宋体; font-size:11pt">所依赖的磁盘元数据是分布式的，既分布在对中的两个</span><span
            style="font-family:等线; font-size:11pt">HA NNs</span><span
            style="font-family:宋体; font-size:11pt">上，也分布在</span><span
            style="font-family:等线; font-size:11pt">QJM</span><span
            style="font-family:宋体; font-size:11pt">用于共享编辑存储的</span><span style="font-family:等线; font-size:11pt">JournalNodes</span><span
            style="font-family:宋体; font-size:11pt">上。本文档</span><span
            style="font-family:宋体; font-size:11pt">旨在说明如何使用</span><span style="font-family:等线; font-size:11pt">HDFS Upgrade/Finalize/Rollback</span><span
            style="font-family:等线; font-size:11pt"> </span><span style="font-family:宋体; font-size:11pt">功能</span></h5>
    <h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">{2}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt">执行</span><span style="font-family:等线; font-size:11pt">HA</span><span
            style="font-family:等线; font-size:11pt"> </span><span style="font-family:等线; font-size:11pt">upgrade</span>
    </h5><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">[1]</span><span style="font:7.0pt 'Times New Roman'"> </span><span
            style="font-family:宋体; font-size:11pt">关闭所有</span><span
            style="font-family:等线; font-size:11pt">NNs,</span><span
            style="font-family:宋体; font-size:11pt">并安装新软件。</span></h6><h6
            style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">[2]</span><span style="font:7.0pt 'Times New Roman'"> </span><span
            style="font-family:宋体; font-size:11pt">启动所有的</span><span
            style="font-family:等线; font-size:11pt">JNs</span><span
            style="font-family:宋体; font-size:11pt">。注意</span><span style="font-family:宋体; font-size:11pt">，</span><span
            style="font-family:宋体; font-size:11pt">当执行升级、</span><span
            style="font-family:宋体; font-size:11pt">回滚或</span><span
            style="font-family:宋体; font-size:11pt">最终化操作时</span><span
            style="font-family:等线; font-size:11pt">,</span><span style="font-family:等线; font-size:11pt">JNs</span><span
            style="font-family:宋体; font-size:11pt">任何一个节点都不能</span><span style="font-family:宋体; font-size:11pt">宕</span><span
            style="font-family:宋体; font-size:11pt">机</span><span style="font-family:宋体; font-size:11pt">。</span><span
            style="font-family:宋体; font-size:11pt">否则</span><span style="font-family:宋体; font-size:11pt">操作将会失败。</span>
    </h6><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">[3]</span><span style="font:7.0pt 'Times New Roman'"> </span><span
            style="font-family:宋体; font-size:11pt">启动一个</span><span
            style="font-family:等线; font-size:11pt">NN</span><span style="font-family:宋体; font-size:11pt">并使用</span><span
            style="font-family:等线; font-size:11pt">-upgrade</span><span style="font-family:宋体; font-size:11pt">参数</span>
    </h6><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">[4]</span><span style="font:7.0pt 'Times New Roman'"> </span><span
            style="font-family:宋体; font-size:11pt">在启动时，此</span><span
            style="font-family:等线; font-size:11pt">NN</span><span style="font-family:宋体; font-size:11pt">将不像</span><span
            style="font-family:等线; font-size:11pt">HA</span><span style="font-family:宋体; font-size:11pt">设置中那样进入备用状态。相反，该</span><span
            style="font-family:等线; font-size:11pt">NN</span><span style="font-family:宋体; font-size:11pt">将立即进入活动状态，执行本地存储</span><span
            style="font-family:宋体; font-size:11pt">目录</span><span style="font-family:宋体; font-size:11pt">的升级，并执行共享编辑日志的升级</span>
    </h6><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">[5]</span><span style="font:7.0pt 'Times New Roman'"> </span><span
            style="font-family:宋体; font-size:11pt">此时，</span><span style="font-family:等线; font-size:11pt">HA</span><span
            style="font-family:宋体; font-size:11pt">对中的另一个</span><span
            style="font-family:等线; font-size:11pt">NN</span><span
            style="font-family:宋体; font-size:11pt">将与升级后的</span><span
            style="font-family:等线; font-size:11pt">NN</span><span
            style="font-family:宋体; font-size:11pt">不同步。为了使它恢复同步并再次</span><span
            style="font-family:宋体; font-size:11pt">实现</span><span
            style="font-family:宋体; font-size:11pt">高可用性，应该</span><span
            style="font-family:宋体; font-size:11pt">运行</span><span style="font-family:宋体; font-size:11pt"> </span><span
            style="font-family:等线; font-size:11pt">“</span><span style="font-family:宋体; font-size:12pt">sbin/hadoop-daemon.sh</span><span
            style="font-family:等线; font-size:11pt"> </span><span style="font-family:等线; font-size:11pt">-bootstrapStandby”</span><span
            style="font-family:宋体; font-size:11pt">重新引导这个</span><span
            style="font-family:等线; font-size:11pt">NameNode</span><span style="font-family:宋体; font-size:11pt">。用</span><span
            style="font-family:等线; font-size:11pt">“-upgrade”</span><span
            style="font-family:宋体; font-size:11pt">参数启动</span><span
            style="font-family:宋体; font-size:11pt">第二个</span><span style="font-family:等线; font-size:11pt">NN</span><span
            style="font-family:宋体; font-size:11pt">是一个错误</span></h6><h6
            style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">[6]</span><span style="font:7.0pt 'Times New Roman'"> </span><span
            style="font-family:宋体; font-size:11pt">注意，如果您想在完成升级</span><span
            style="font-family:宋体; font-size:11pt">或回滚升级</span><span
            style="font-family:宋体; font-size:11pt">之前重新启动</span><span
            style="font-family:等线; font-size:11pt">namenode</span><span
            style="font-family:宋体; font-size:11pt">，您应该像往常</span><span
            style="font-family:宋体; font-size:11pt">一样启动</span><span
            style="font-family:等线; font-size:11pt">NNs</span><span
            style="font-family:宋体; font-size:11pt">，即不使用任何特殊的启动标志</span></h6><h5
            style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">{3}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt">结束一个在</span><span
            style="font-family:等线; font-size:11pt">HA</span><span
            style="font-family:宋体; font-size:11pt">状态下运行的</span><span style="font-family:等线; font-size:11pt">NN</span>
    </h5><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">[1]</span><span style="font:7.0pt 'Times New Roman'"> </span><span
            style="font-family:宋体; font-size:11pt">当</span><span style="font-family:等线; font-size:11pt">NNs</span><span
            style="font-family:宋体; font-size:11pt">正在运行且其中一个处于活动状态时，操作员将使用</span><span
            style="font-family:等线; font-size:11pt">' hdfs dfsadmin -finalizeUpgrade'</span><span
            style="font-family:宋体; font-size:11pt">命令。此时的活动</span><span style="font-family:等线; font-size:11pt">NN</span><span
            style="font-family:宋体; font-size:11pt">将执行共享日志的结束，其</span><span
            style="font-family:宋体; font-size:11pt">包含前一个</span><span
            style="font-family:等线; font-size:11pt">FS</span><span style="font-family:宋体; font-size:11pt">状态的</span><span
            style="font-family:宋体; font-size:11pt">本地存储</span><span style="font-family:宋体; font-size:11pt">目录会被删除</span>
    </h6><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">{4}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span
            style="font-family:宋体; font-size:11pt">执行升级后的回滚</span></h5><h6
            style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span
            style="font-family:等线; font-size:11pt">[1]</span><span style="font:7.0pt 'Times New Roman'"> </span><span
            style="font-family:宋体; font-size:11pt">两个</span><span style="font-family:等线; font-size:11pt">NN</span><span
            style="font-family:宋体; font-size:11pt">都应该先关闭。</span><span style="font-family:宋体; font-size:11pt">开发者</span><span
            style="font-family:宋体; font-size:11pt">应该在启动升级过程的</span><span
            style="font-family:等线; font-size:11pt">NN</span><span style="font-family:宋体; font-size:11pt">上</span><span
            style="font-family:宋体; font-size:11pt">运行回滚</span><span
            style="font-family:宋体; font-size:11pt">命令，该命令将对本地</span><span
            style="font-family:等线; font-size:11pt">dirs</span><span style="font-family:宋体; font-size:11pt">以及共享日志</span><span
            style="font-family:等线; font-size:11pt">(NFS</span><span style="font-family:宋体; font-size:11pt">或</span><span
            style="font-family:等线; font-size:11pt">JNs)</span><span style="font-family:宋体; font-size:11pt">执行回滚。之后，应该启动这个</span><span
            style="font-family:等线; font-size:11pt">NN</span><span style="font-family:宋体; font-size:11pt">，</span><span
            style="font-family:宋体; font-size:11pt">开发者</span><span
            style="font-family:宋体; font-size:11pt">应该在另一个</span><span
            style="font-family:等线; font-size:11pt">NN</span><span style="font-family:宋体; font-size:11pt">上运行</span><span
            style="font-family:等线; font-size:11pt">' -bootstrapStandby'</span><span
            style="font-family:宋体; font-size:11pt">，使两个</span><span
            style="font-family:等线; font-size:11pt">NNs</span><span style="font-family:宋体; font-size:11pt">与</span><span
            style="font-family:宋体; font-size:11pt">这个回滚</span><span
            style="font-family:宋体; font-size:11pt">的文件系统状态保持同步。</span></h6>
    <p style="line-height:10.5pt; margin:7.8pt 0pt"><span style="font-family:等线; font-size:10.5pt">&#xa0;</span></p>
    <p style="line-height:10.5pt; margin:7.8pt 0pt"><span style="font-family:等线; font-size:10.5pt">&#xa0;</span></p>
    <p style="background-color:#ffffff; margin:6pt 0pt"><span style="font-family:宋体; font-size:10pt">&#xa0;</span></p>
    <p style="line-height:10.5pt; margin:7.8pt 0pt 7.8pt 63pt"><span
            style="font-family:等线; font-size:10.5pt">&#xa0;</span></p>
    <p style="line-height:10.5pt; margin:7.8pt 0pt"><span style="font-family:等线; font-size:10.5pt">&#xa0;</span></p>
    <p style="line-height:10.5pt; margin:7.8pt 0pt"><span style="font-family:等线; font-size:10.5pt">&#xa0;</span></p>
    <p style="line-height:10.5pt; margin:7.8pt 0pt"><span style="font-family:等线; font-size:10.5pt">&#xa0;</span></p>
    <p style="line-height:10.5pt; margin:7.8pt 0pt"><span style="font-family:等线; font-size:10.5pt">&#xa0;</span></p>
    <p style="line-height:10.5pt; margin:7.8pt 0pt"><span style="font-family:等线; font-size:10.5pt">&#xa0;</span></p>
    <p style="line-height:10.5pt; margin:7.8pt 0pt"><span style="font-family:等线; font-size:10.5pt">&#xa0;</span></p>
    <p style="line-height:10.5pt; margin:7.8pt 0pt"><span style="font-family:等线; font-size:10.5pt">&#xa0;</span></p>
</div>
<div class="cnzz" style="display: none;">
    <script src="https://s23.cnzz.com/z_stat.php?id=1277655852&web_id=1277655852" language="JavaScript"></script>
</div>
<div class="docpe" style="position: absolute;color: white;margin-left:-450;">
    <a target="_blank" href="http://www.docpe.com">档铺网——在线文档免费处理</a>
</div>
</body>
</html>
