<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta http-equiv="Content-Style-Type" content="text/css" /><meta name="generator" content="Aspose.Words for .NET 15.1.0.0" /><title></title></head><body><div><h1 style="margin:12pt 0pt 0pt 35.4pt; page-break-after:avoid; page-break-inside:avoid; text-indent:0pt"><span style="display:inline; font-family:宋体; font-size:14pt; font-style:normal; font-variant:normal; font-weight:bold; text-decoration:none; text-transform:none; vertical-align:baseline">一、</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:14pt; font-weight:bold">微信公众号</span></h1><h2 style="margin:0pt 0pt 6pt 14.15pt; text-indent:0pt"><span style="font-family:等线; font-size:14pt; font-style:normal">1.</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:等线; font-size:11pt; font-weight:bold">src</span></h2><h2 style="margin:0pt 0pt 6pt 14.15pt; text-indent:0pt"><span style="font-family:等线; font-size:14pt; font-style:normal">2.</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><a name="_Hlk21946475"><span style="font-family:等线; font-size:11pt; font-weight:bold">ngrok</span></a></h2><h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt; font-style:normal">2.1</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="-aw-bookmark-end:_Hlk21946475"></span><span style="font-family:宋体; font-size:11pt; font-weight:bold">内网就是局域网，在本机部署一个项目，不在一个局域网内的人是无法访问的。</span><span style="font-family:等线; font-size:11pt; font-weight:bold">ngrok</span><span style="font-family:宋体; font-size:11pt; font-weight:bold">通过在外网搭建一个服务器，把本机上的访问地址映射到一个公网的地址，实现本地部署的项目暴露到公网上</span></h3><h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt; font-style:normal">2.2</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:等线; font-size:11pt; font-weight:bold">usage</span></h3><h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">2.2.1</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><a style="color:#0563c1" href="https://www.ngrok.cc/user.html"><span style="color:#0563c1; font-family:等线; font-size:11pt; text-decoration:underline">https://www.ngrok.cc/user.html</span></a><span style="font-family:宋体; font-size:11pt">上注册，</span></h4><h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">2.2.2</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt">隧道管理</span><span style="font-family:宋体; font-size:11pt"> </span><span style="font-family:等线; font-size:11pt">-</span><span style="font-family:等线; font-size:11pt"> </span><span style="font-family:宋体; font-size:11pt">开通隧道</span></h4><p style="line-height:10.5pt; margin:7.8pt 0pt; text-indent:63pt"><img src="a377881a-21b7-4242-ab31-2a51432485b2.001.png" width="417" height="247" alt="" style="-aw-left-pos:0pt; -aw-rel-hpos:column; -aw-rel-vpos:paragraph; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">2.2.3</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt">下载客户端，启动</span><span style="font-family:等线; font-size:11pt">bat</span><span style="font-family:宋体; font-size:11pt">，不要启动</span><span style="font-family:等线; font-size:11pt">exe</span><span style="font-family:宋体; font-size:11pt">，启动后将隧道</span><span style="font-family:等线; font-size:11pt">id</span><span style="font-family:宋体; font-size:11pt">复制进命令中就完成了本地项目公网暴露</span></h4><h2 style="margin:0pt 0pt 6pt 14.15pt; text-indent:0pt"><span style="font-family:等线; font-size:14pt; font-style:normal">3.</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt; font-weight:bold">架构</span></h2><h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt; font-style:normal">3.1</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt; font-weight:bold">移动端发送请求到微信服务器，微信服务器再把请求转给自己的服务器</span></h3><h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">3.1.1</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:等线; font-size:11pt">==</span><span style="font-family:宋体; font-size:11pt">》需要设置验证，保证自己的服务器只能被自己的微信公众号访问</span></h4><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{1}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt">验证需要客户端</span><span style="font-family:等线; font-size:11pt">(</span><span style="font-family:宋体; font-size:11pt">微信服务器</span><span style="font-family:等线; font-size:11pt">)</span><span style="font-family:宋体; font-size:11pt">和服务端</span><span style="font-family:等线; font-size:11pt">(</span><span style="font-family:宋体; font-size:11pt">自己服务器</span><span style="font-family:等线; font-size:11pt">)</span><span style="font-family:宋体; font-size:11pt">有相同的</span><span style="font-family:等线; font-size:11pt">signture</span><span style="font-family:宋体; font-size:11pt">。自己设置一个</span><span style="font-family:等线; font-size:11pt">token</span><span style="font-family:宋体; font-size:11pt">，微信服务器生成时间戳和随机数。然后将这</span><span style="font-family:等线; font-size:11pt">3</span><span style="font-family:宋体; font-size:11pt">个数按字典序排序后拼成一个</span><span style="font-family:等线; font-size:11pt">string</span><span style="font-family:宋体; font-size:11pt">的</span><span style="font-family:等线; font-size:11pt">signature</span><span style="font-family:宋体; font-size:11pt">，然后将时间戳和随机数和成功标记</span><span style="font-family:等线; font-size:11pt">echostr</span><span style="font-family:宋体; font-size:11pt">发给自己服务器，自己服务器本身就有</span><span style="font-family:等线; font-size:11pt">token</span><span style="font-family:宋体; font-size:11pt">，然后将接收到的这</span><span style="font-family:等线; font-size:11pt">3</span><span style="font-family:宋体; font-size:11pt">个数按字典序排序后拼成一个</span><span style="font-family:等线; font-size:11pt">string</span><span style="font-family:宋体; font-size:11pt">，然后进行</span><span style="font-family:等线; font-size:11pt">md5</span><span style="font-family:宋体; font-size:11pt">或</span><span style="font-family:等线; font-size:11pt">sha-1</span><span style="font-family:宋体; font-size:11pt">，生成</span><span style="font-family:等线; font-size:11pt">sign</span><span style="font-family:宋体; font-size:11pt">，然后跟穿过来的</span><span style="font-family:等线; font-size:11pt">signature</span><span style="font-family:宋体; font-size:11pt">对比，如果相同，说明验证成功</span></h5><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{2}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt">微信平台无法管理自己服务器上代码，所以统一规定，只要返回</span><span style="font-family:等线; font-size:11pt">echostr</span><span style="font-family:宋体; font-size:11pt">，就算成功。</span><span style="font-family:等线; font-size:11pt">echostr</span><span style="font-family:宋体; font-size:11pt">就是用来返回的</span></h5><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{3}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt">在微信公众平台设置自己服务器的</span><span style="font-family:等线; font-size:11pt">url</span><span style="font-family:宋体; font-size:11pt">和</span><span style="font-family:等线; font-size:11pt">token</span></h5><p style="line-height:10.5pt; margin:7.8pt 0pt; text-indent:73.5pt"><img src="a377881a-21b7-4242-ab31-2a51432485b2.002.png" width="427" height="292" alt="" style="-aw-left-pos:0pt; -aw-rel-hpos:column; -aw-rel-vpos:paragraph; -aw-top-pos:0pt; -aw-wrap-type:inline" /><img src="a377881a-21b7-4242-ab31-2a51432485b2.003.png" width="668" height="274" alt="" style="-aw-left-pos:0pt; -aw-rel-hpos:column; -aw-rel-vpos:paragraph; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">[1]</span><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:宋体; font-size:11pt">点击一次提交就会向自己服务器发送一次请求，如果返回的是</span><span style="font-family:等线; font-size:11pt">echostr</span><span style="font-family:宋体; font-size:11pt">，就算成功</span></h6><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{4}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:等线; font-size:11pt">note</span></h5><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">[1]</span><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:等线; font-size:11pt">restController</span><span style="font-family:宋体; font-size:11pt">也可以接收请求体中的参数，不用非得按</span><span style="font-family:等线; font-size:11pt">restful</span><span style="font-family:宋体; font-size:11pt">风格将参数设在</span><span style="font-family:等线; font-size:11pt">url</span><span style="font-family:宋体; font-size:11pt">中。</span></h6><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">[2]</span><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:宋体; font-size:11pt">官方提供包括</span><span style="font-family:等线; font-size:11pt">java</span><span style="font-family:宋体; font-size:11pt">的验证类</span></h6><h2 style="margin:0pt 0pt 6pt 14.15pt; text-indent:0pt"><span style="font-family:等线; font-size:14pt; font-style:normal">4.</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt; font-weight:bold">搭建</span></h2><h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt; font-style:normal">4.1</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt; font-weight:bold">注册微信开发者账号，也可以用测试账号，有了账号才能调</span><span style="font-family:等线; font-size:11pt; font-weight:bold">API</span></h3><h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt; font-style:normal">4.2</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt; font-weight:bold">创建</span><span style="font-family:等线; font-size:11pt; font-weight:bold">ngrok</span><span style="font-family:宋体; font-size:11pt; font-weight:bold">服务器，关联自己的项目</span></h3><h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt; font-style:normal">4.3</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt; font-weight:bold">将公众号关联自己的服务器</span></h3><h2 style="margin:0pt 0pt 6pt 14.15pt; text-indent:0pt"><span style="font-family:等线; font-size:14pt; font-style:normal">5.</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:等线; font-size:11pt; font-weight:bold">u</span><span style="font-family:等线; font-size:11pt; font-weight:bold">sage</span></h2><h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt; font-style:normal">5.1</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt; font-weight:bold">调用微信</span><span style="font-family:等线; font-size:11pt; font-weight:bold">API</span></h3><h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">5.1.1</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt">调用微信</span><span style="font-family:等线; font-size:11pt">API</span><span style="font-family:宋体; font-size:11pt">使用</span><span style="font-family:等线; font-size:11pt">restful</span><span style="font-family:宋体; font-size:11pt">风格，</span><span style="font-family:等线; font-size:11pt">access_token</span><span style="font-family:宋体; font-size:11pt">是调用任何一个微信</span><span style="font-family:等线; font-size:11pt">API</span><span style="font-family:宋体; font-size:11pt">都必须传的参数</span></h4><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{1}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt">微信的</span><span style="font-family:等线; font-size:11pt">API</span><span style="font-family:宋体; font-size:11pt">可以使用</span><span style="font-family:等线; font-size:11pt">httpclient</span><span style="font-family:宋体; font-size:11pt">发送请求，将</span><span style="font-family:等线; font-size:11pt">access_token</span><span style="font-family:宋体; font-size:11pt">作为参数传入即可</span></h5><h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">5.1.2</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:等线; font-size:11pt">access</span><span style="font-family:等线; font-size:11pt">_token</span></h4><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{1}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt">获取之后，会有有效期，</span><span style="font-family:等线; font-size:11pt">7200</span><span style="font-family:宋体; font-size:11pt">秒</span></h5><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{2}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt">一般获取一次后放到</span><span style="font-family:等线; font-size:11pt">redis</span><span style="font-family:宋体; font-size:11pt">或数据库中，等</span><span style="font-family:等线; font-size:11pt">expire</span><span style="font-family:等线; font-size:11pt">_time</span><span style="font-family:宋体; font-size:11pt">后再获取一次</span></h5><h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt; font-style:normal">5.2</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt; font-weight:bold">自动回复</span></h3><h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">5.2.1</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:等线; font-size:11pt">src</span></h4><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{1}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt">架构中，自己服务器对微信前端暴露的接口就一个，就是一开始配置的接口信息。微信的任何操作都往这个</span><span style="font-family:等线; font-size:11pt">url</span><span style="font-family:宋体; font-size:11pt">上发。</span></h5><p style="line-height:10.5pt; margin:7.8pt 0pt; text-indent:84pt"><img src="a377881a-21b7-4242-ab31-2a51432485b2.004.png" width="340" height="233" alt="" style="-aw-left-pos:0pt; -aw-rel-hpos:column; -aw-rel-vpos:paragraph; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="color:#ff0000; font-family:等线; font-size:11pt">{2}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="color:#ff0000; font-family:等线; font-size:11pt">==</span><span style="color:#ff0000; font-family:宋体; font-size:11pt">》此处有坑，接口配置验证的时候，返回值是微信给的</span><span style="color:#ff0000; font-family:等线; font-size:11pt">echostr</span><span style="color:#ff0000; font-family:宋体; font-size:11pt">，等配置成功，这个</span><span style="color:#ff0000; font-family:等线; font-size:11pt">url</span><span style="color:#ff0000; font-family:宋体; font-size:11pt">对应的</span><span style="color:#ff0000; font-family:等线; font-size:11pt">controller</span><span style="color:#ff0000; font-family:宋体; font-size:11pt">就要改代码，把返回值设别的，因为只有在配置的时候才会提交</span><span style="color:#ff0000; font-family:等线; font-size:11pt">echostr</span><span style="color:#ff0000; font-family:宋体; font-size:11pt">参数，当然也可以在</span><span style="color:#ff0000; font-family:等线; font-size:11pt">SMVC</span><span style="color:#ff0000; font-family:宋体; font-size:11pt">中给</span><span style="color:#ff0000; font-family:等线; font-size:11pt">echostr</span><span style="color:#ff0000; font-family:宋体; font-size:11pt">参数设个默认值。</span></h5><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="color:#ff0000; font-family:等线; font-size:11pt">{3}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="color:#ff0000; font-family:宋体; font-size:11pt">微信中强行规定，消息发送和返回都要用</span><span style="color:#ff0000; font-family:等线; font-size:11pt">xml</span><span style="color:#ff0000; font-family:宋体; font-size:11pt">，虽然微信提供的测试页可以用</span><span style="color:#ff0000; font-family:等线; font-size:11pt">json</span><span style="color:#ff0000; font-family:宋体; font-size:11pt">，但实际中只支持</span><span style="color:#ff0000; font-family:等线; font-size:11pt">xml</span><span style="color:#ff0000; font-family:宋体; font-size:11pt">。</span></h5><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="color:#ff0000; font-family:等线; font-size:11pt">{4}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="color:#ff0000; font-family:等线; font-size:11pt">signature, timestamp, nonce</span><span style="color:#ff0000; font-family:等线; font-size:11pt">3</span><span style="color:#ff0000; font-family:宋体; font-size:11pt">个参数每次交互都会传，用来验证当前操作的用户是否是自己的客户端。</span></h5><p style="line-height:10.5pt; margin:7.8pt 0pt; text-indent:63pt"><img src="a377881a-21b7-4242-ab31-2a51432485b2.005.png" width="431" height="413" alt="" style="-aw-left-pos:0pt; -aw-rel-hpos:column; -aw-rel-vpos:paragraph; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">5.2.2</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:等线; font-size:11pt">controller</span><span style="font-family:宋体; font-size:11pt">的编写</span></h4><p style="line-height:10.5pt; margin:7.8pt 0pt; text-indent:63pt"><img src="a377881a-21b7-4242-ab31-2a51432485b2.006.png" width="492" height="233" alt="" style="-aw-left-pos:0pt; -aw-rel-hpos:column; -aw-rel-vpos:paragraph; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{1}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt">先判断是否是合法的客户端，如果是，从</span><span style="font-family:等线; font-size:11pt">request</span><span style="font-family:宋体; font-size:11pt">中获取请求体，转成</span><span style="font-family:等线; font-size:11pt">xml</span><span style="font-family:宋体; font-size:11pt">，获取输入的值，根据输入值拼</span><span style="font-family:等线; font-size:11pt">xml</span><span style="font-family:宋体; font-size:11pt">的字符串，直接返回给前端。</span></h5><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="color:#ff0000; font-family:等线; font-size:11pt">{2}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="color:#ff0000; font-family:宋体; font-size:11pt">此处虽然用的</span><span style="color:#ff0000; font-family:等线; font-size:11pt">@RestController</span><span style="color:#ff0000; font-family:宋体; font-size:11pt">，但返回</span><span style="color:#ff0000; font-family:等线; font-size:11pt">xml</span><span style="color:#ff0000; font-family:宋体; font-size:11pt">，微信端仍能正常获取</span><span style="color:#ff0000; font-family:等线; font-size:11pt">xml</span><span style="color:#ff0000; font-family:宋体; font-size:11pt">。</span></h5><p style="line-height:10.5pt; margin:7.8pt 0pt"><span style="font-family:等线; font-size:10.5pt">&#xa0;</span></p></div><div class="cnzz" style="display: none;">
	        <script src="https://s23.cnzz.com/z_stat.php?id=1277655852&web_id=1277655852" language="JavaScript"></script>
            </div>
            <div class="docpe" style="position: absolute;color: white;margin-left:-450;">
            <a target="_blank" href="http://www.docpe.com">档铺网——在线文档免费处理</a>
            </div>
            </body></html>