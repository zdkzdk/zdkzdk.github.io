<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta http-equiv="Content-Style-Type" content="text/css" /><meta name="generator" content="Aspose.Words for .NET 15.1.0.0" /><title></title></head><body><div><h2 style="margin:0pt 0pt 6pt 14.15pt; text-indent:0pt"><span style="font-family:等线; font-size:14pt; font-style:normal">1.</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt; font-weight:bold">资源调度</span></h2><h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt; font-style:normal">1.1</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:等线; font-size:11pt; font-weight:bold">driver</span><span style="font-family:宋体; font-size:11pt; font-weight:bold">的</span><span style="font-family:等线; font-size:11pt; font-weight:bold">TS</span><span style="font-family:宋体; font-size:11pt; font-weight:bold">向</span><span style="font-family:等线; font-size:11pt; font-weight:bold">master</span><span style="font-family:宋体; font-size:11pt; font-weight:bold">申请资源，</span><span style="font-family:等线; font-size:11pt; font-weight:bold">master</span><span style="font-family:宋体; font-size:11pt; font-weight:bold">分配资源，</span><span style="font-family:等线; font-size:11pt; font-weight:bold">executor</span><span style="font-family:宋体; font-size:11pt; font-weight:bold">向</span><span style="font-family:等线; font-size:11pt; font-weight:bold">driver</span><span style="font-family:宋体; font-size:11pt; font-weight:bold">中反向注册，然后在</span><span style="font-family:等线; font-size:11pt; font-weight:bold">worker</span><span style="font-family:宋体; font-size:11pt; font-weight:bold">中启动</span></h3><h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt; font-style:normal">1.2</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt; font-weight:bold">图</span></h3><p style="line-height:10.5pt; margin:7.8pt 0pt; text-indent:31.5pt"><img src="161caaeb-29aa-4e17-ab46-f59cbe732f45.001.jpeg" width="682" height="882" alt="" style="-aw-left-pos:0pt; -aw-rel-hpos:column; -aw-rel-vpos:paragraph; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><p style="line-height:10.5pt; margin:7.8pt 0pt; text-indent:31.5pt"><img src="161caaeb-29aa-4e17-ab46-f59cbe732f45.002.jpeg" width="673" height="1" alt="" style="-aw-left-pos:0pt; -aw-rel-hpos:column; -aw-rel-vpos:paragraph; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><p style="line-height:12pt; margin:7.8pt 0pt; text-indent:21pt"><span style="font-family:等线; font-size:12pt">文字描述：</span></p><h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt; font-style:normal">1.3</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:等线; font-size:11pt; font-weight:bold">src</span></h3><h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">1.3.1</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt">回顾启动和提交</span></h4><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{1}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt">启动集群，分别执行</span><span style="font-family:等线; font-size:11pt">master</span><span style="font-family:宋体; font-size:11pt">和</span><span style="font-family:等线; font-size:11pt">worker</span><span style="font-family:宋体; font-size:11pt">的脚本，执行</span><span style="font-family:等线; font-size:11pt">Master</span><span style="font-family:宋体; font-size:11pt">的</span><span style="font-family:等线; font-size:11pt">main</span><span style="font-family:宋体; font-size:11pt">，创建基于</span><span style="font-family:等线; font-size:11pt">netty</span><span style="font-family:宋体; font-size:11pt">的</span><span style="font-family:等线; font-size:11pt">RPCEnv</span><span style="font-family:宋体; font-size:11pt">通信环境，并且把</span><span style="font-family:等线; font-size:11pt">master</span><span style="font-family:宋体; font-size:11pt">的</span><span style="font-family:等线; font-size:11pt">Endpoint</span><span style="font-family:宋体; font-size:11pt">对象注册到框架中</span></h5><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{2}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt">在</span><span style="font-family:等线; font-size:11pt">client</span><span style="font-family:宋体; font-size:11pt">执行</span><span style="font-family:等线; font-size:11pt">SparkSubmit</span><span style="font-family:宋体; font-size:11pt">，执行</span><span style="font-family:等线; font-size:11pt">SparkSubmit</span><span style="font-family:宋体; font-size:11pt">的</span><span style="font-family:等线; font-size:11pt">main</span><span style="font-family:宋体; font-size:11pt">，封装参数，创建</span><span style="font-family:等线; font-size:11pt">RPC</span><span style="font-family:宋体; font-size:11pt">通信环境把</span><span style="font-family:等线; font-size:11pt">Client</span><span style="font-family:宋体; font-size:11pt">的</span><span style="font-family:等线; font-size:11pt">ClientEndPoint</span><span style="font-family:宋体; font-size:11pt">注册到环境中，调用</span><span style="font-family:等线; font-size:11pt">Master</span><span style="font-family:宋体; font-size:11pt">在随机</span><span style="font-family:等线; font-size:11pt">Worker</span><span style="font-family:宋体; font-size:11pt">中创建</span><span style="font-family:等线; font-size:11pt">dirver</span><span style="font-family:宋体; font-size:11pt">，然后</span><span style="font-family:等线; font-size:11pt">driver</span><span style="font-family:宋体; font-size:11pt">会执行提交的</span><span style="font-family:等线; font-size:11pt">jar</span><span style="font-family:宋体; font-size:11pt">的</span><span style="font-family:等线; font-size:11pt">main</span></h5><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{3}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt">提交，封装参数，启动</span><span style="font-family:等线; font-size:11pt">client</span><span style="font-family:宋体; font-size:11pt">的主类，向</span><span style="font-family:等线; font-size:11pt">master</span><span style="font-family:宋体; font-size:11pt">发送启动消息，</span><span style="font-family:等线; font-size:11pt">master</span><span style="font-family:宋体; font-size:11pt">创建</span><span style="font-family:等线; font-size:11pt">driverDesc</span><span style="font-family:宋体; font-size:11pt">，</span><span style="font-family:等线; font-size:11pt">master</span><span style="font-family:宋体; font-size:11pt">随机在</span><span style="font-family:等线; font-size:11pt">worker</span><span style="font-family:宋体; font-size:11pt">上启动</span><span style="font-family:等线; font-size:11pt">driver</span><span style="font-family:宋体; font-size:11pt">，执行提交的</span><span style="font-family:等线; font-size:11pt">jar</span><span style="font-family:宋体; font-size:11pt">的主类的</span><span style="font-family:等线; font-size:11pt">main</span><span style="font-family:宋体; font-size:11pt">，执行</span><span style="font-family:等线; font-size:11pt">new</span><span style="font-family:等线; font-size:11pt"> </span><span style="font-family:等线; font-size:11pt">sparkContext</span><span style="font-family:宋体; font-size:11pt">，创建</span><span style="font-family:等线; font-size:11pt">DS</span><span style="font-family:宋体; font-size:11pt">和</span><span style="font-family:等线; font-size:11pt">TS</span><span style="font-family:宋体; font-size:11pt">，</span></h5><h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt; font-style:normal">1.4</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt; font-weight:bold">创建并启动</span><span style="font-family:等线; font-size:11pt; font-weight:bold">TS</span></h3><p style="line-height:10.5pt; margin:7.8pt 0pt; text-indent:52.5pt"><img src="161caaeb-29aa-4e17-ab46-f59cbe732f45.003.png" width="721" height="225" alt="" style="-aw-left-pos:0pt; -aw-rel-hpos:column; -aw-rel-vpos:paragraph; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">1.4.1</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:等线; font-size:11pt">SparkContext.createTaskScheduler(this, master, deployMode)</span><span style="font-family:等线; font-size:11pt"> </span><span style="font-family:宋体; font-size:11pt">根据提交任务的命令匹配处理方法，创建通信对象和</span><span style="font-family:等线; font-size:11pt">TS</span><span style="font-family:宋体; font-size:11pt">对象</span><span style="font-family:等线; font-size:11pt">(</span><span style="font-family:等线; font-size:11pt">TaskSchedulerImpl)</span><span style="font-family:宋体; font-size:11pt">，并以对偶元组的形式返回</span></h4><p style="line-height:10.5pt; margin:7.8pt 0pt; text-indent:52.5pt"><img src="161caaeb-29aa-4e17-ab46-f59cbe732f45.004.png" width="658" height="232" alt="" style="-aw-left-pos:0pt; -aw-rel-hpos:column; -aw-rel-vpos:paragraph; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt; font-style:normal">1.5</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:等线; font-size:11pt; font-weight:bold">TS</span><span style="font-family:宋体; font-size:11pt; font-weight:bold">负责资源申请，会创建</span><span style="font-family:等线; font-size:11pt; font-weight:bold">CoarseGrainedSchedulerBackend</span><span style="font-family:宋体; font-size:11pt; font-weight:bold">的对象来调用</span><span style="font-family:等线; font-size:11pt; font-weight:bold">start</span><span style="font-family:宋体; font-size:11pt; font-weight:bold">方法。</span><span style="font-family:等线; font-size:11pt; font-weight:bold">CoarseGrainedSchedulerBackend</span><span style="font-family:宋体; font-size:11pt; font-weight:bold">封装了粗粒度申请资源的方法</span></h3><p style="line-height:10.5pt; margin:7.8pt 0pt; text-indent:42pt"><img src="161caaeb-29aa-4e17-ab46-f59cbe732f45.005.png" width="662" height="289" alt="" style="-aw-left-pos:0pt; -aw-rel-hpos:column; -aw-rel-vpos:paragraph; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">1.5.1</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:等线; font-size:11pt">backend</span><span style="font-family:宋体; font-size:11pt">调用</span><span style="font-family:等线; font-size:11pt">start</span><span style="font-family:宋体; font-size:11pt">跟进去会发现调用的是</span><span style="font-family:等线; font-size:11pt">super.start()</span><span style="font-family:宋体; font-size:11pt">，而</span><span style="font-family:等线; font-size:11pt">super</span><span style="font-family:宋体; font-size:11pt">就是粗粒度的</span><span style="font-family:等线; font-size:11pt">CoarseGrainedSchedulerBackend</span><span style="font-family:宋体; font-size:11pt">，作用就是创建</span><span style="font-family:等线; font-size:11pt">driverEndpoint</span><span style="font-family:宋体; font-size:11pt">并注册</span></h4><p style="line-height:10.5pt; margin:7.8pt 0pt; text-indent:52.5pt"><img src="161caaeb-29aa-4e17-ab46-f59cbe732f45.006.png" width="588" height="99" alt="" style="-aw-left-pos:0pt; -aw-rel-hpos:column; -aw-rel-vpos:paragraph; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><p style="line-height:10.5pt; margin:7.8pt 0pt; text-indent:52.5pt"><img src="161caaeb-29aa-4e17-ab46-f59cbe732f45.007.png" width="690" height="153" alt="" style="-aw-left-pos:0pt; -aw-rel-hpos:column; -aw-rel-vpos:paragraph; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt; font-style:normal">1.6</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt; font-weight:bold">通信环境准备好之后，开始申请资源，首先要确定的就是申请多少资源，然后再向</span><span style="font-family:等线; font-size:11pt; font-weight:bold">master</span><span style="font-family:宋体; font-size:11pt; font-weight:bold">发消息申请？</span><span style="font-family:等线; font-size:11pt; font-weight:bold">==</span><span style="font-family:宋体; font-size:11pt; font-weight:bold">》</span><span style="font-family:宋体; font-size:11pt; font-weight:bold">创建</span><span style="font-family:等线; font-size:11pt; font-weight:bold">Command</span><span style="font-family:宋体; font-size:11pt; font-weight:bold">对象，用</span><span style="font-family:等线; font-size:11pt; font-weight:bold">ApplicationDesc</span><span style="font-family:宋体; font-size:11pt; font-weight:bold">对象封装，然后再用</span><span style="font-family:等线; font-size:11pt; font-weight:bold">StandaloneAppClient</span><span style="font-family:宋体; font-size:11pt; font-weight:bold">封装</span></h3><p style="line-height:10.5pt; margin:7.8pt 0pt; text-indent:52.5pt"><img src="161caaeb-29aa-4e17-ab46-f59cbe732f45.008.png" width="667" height="260" alt="" style="-aw-left-pos:0pt; -aw-rel-hpos:column; -aw-rel-vpos:paragraph; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">1.6.1</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt">创建一个</span><span style="font-family:等线; font-size:11pt">AppClient</span><span style="font-family:宋体; font-size:11pt">对象，执行</span><span style="font-family:宋体; font-size:11pt"> </span><span style="font-family:等线; font-size:11pt">StandaloneAppClient</span><span style="font-family:宋体; font-size:11pt">的</span><span style="font-family:等线; font-size:11pt">start</span><span style="font-family:宋体; font-size:11pt">，</span><span style="font-family:等线; font-size:11pt">AppClient</span><span style="font-family:宋体; font-size:11pt">向</span><span style="font-family:等线; font-size:11pt">Master</span><span style="font-family:宋体; font-size:11pt">申请资源，调用第二个参数</span><span style="font-family:等线; font-size:11pt">Endpoint</span><span style="font-family:宋体; font-size:11pt">的</span><span style="font-family:等线; font-size:11pt">onStart</span><span style="font-family:宋体; font-size:11pt">方法。获取</span><span style="font-family:等线; font-size:11pt">master</span><span style="font-family:宋体; font-size:11pt">的引用，给</span><span style="font-family:等线; font-size:11pt">master</span><span style="font-family:宋体; font-size:11pt">发消息，申请资源</span></h4><p style="line-height:10.5pt; margin:7.8pt 0pt; text-indent:63pt"><img src="161caaeb-29aa-4e17-ab46-f59cbe732f45.009.png" width="719" height="121" alt="" style="-aw-left-pos:0pt; -aw-rel-hpos:column; -aw-rel-vpos:paragraph; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{1}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt">向所有</span><span style="font-family:等线; font-size:11pt">master</span><span style="font-family:宋体; font-size:11pt">注册，因为</span><span style="font-family:等线; font-size:11pt">master</span><span style="font-family:宋体; font-size:11pt">会有</span><span style="font-family:等线; font-size:11pt">HA</span><span style="font-family:宋体; font-size:11pt">，有多个</span></h5><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{2}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:等线; font-size:11pt">masterRef.send</span><span style="font-family:宋体; font-size:11pt">就是给</span><span style="font-family:等线; font-size:11pt">master</span><span style="font-family:宋体; font-size:11pt">发消息</span></h5><p style="line-height:10.5pt; margin:7.8pt 0pt; text-indent:63pt"><img src="161caaeb-29aa-4e17-ab46-f59cbe732f45.010.png" width="672" height="342" alt="" style="-aw-left-pos:0pt; -aw-rel-hpos:column; -aw-rel-vpos:paragraph; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt; font-style:normal">1.7</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt; font-weight:bold">回到</span><span style="font-family:等线; font-size:11pt; font-weight:bold">Master</span><span style="font-family:宋体; font-size:11pt; font-weight:bold">，观测</span><span style="font-family:等线; font-size:11pt; font-weight:bold">Master</span><span style="font-family:宋体; font-size:11pt; font-weight:bold">怎么处理申请资源的消息</span></h3><h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">1.7.1</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:等线; font-size:11pt">receive</span><span style="font-family:宋体; font-size:11pt">方法中用模式匹配判断是否是申请</span><span style="font-family:等线; font-size:11pt">APP</span><span style="font-family:宋体; font-size:11pt">的消息，调用</span><span style="font-family:等线; font-size:11pt">createApplication</span><span style="font-family:宋体; font-size:11pt">，把</span><span style="font-family:等线; font-size:11pt">ApplicationDesc</span><span style="font-family:宋体; font-size:11pt">对象传入。注册</span><span style="font-family:等线; font-size:11pt">App</span><span style="font-family:宋体; font-size:11pt">，会在等待注册的</span><span style="font-family:等线; font-size:11pt">app</span><span style="font-family:宋体; font-size:11pt">集合中添加。最后执行</span><span style="font-family:等线; font-size:11pt">schedule</span><span style="font-family:宋体; font-size:11pt">，这个方法在注册</span><span style="font-family:等线; font-size:11pt">driver</span><span style="font-family:宋体; font-size:11pt">中就调用过，用来执行申请资源的逻辑。</span></h4><p style="line-height:10.5pt; margin:7.8pt 0pt; text-indent:63pt"><img src="161caaeb-29aa-4e17-ab46-f59cbe732f45.011.png" width="736" height="291" alt="" style="-aw-left-pos:0pt; -aw-rel-hpos:column; -aw-rel-vpos:paragraph; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><p style="line-height:10.5pt; margin:7.8pt 0pt; text-indent:63pt"><img src="161caaeb-29aa-4e17-ab46-f59cbe732f45.012.png" width="553" height="124" alt="" style="-aw-left-pos:0pt; -aw-rel-hpos:column; -aw-rel-vpos:paragraph; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><p style="line-height:10.5pt; margin:7.8pt 0pt; text-indent:63pt"><img src="161caaeb-29aa-4e17-ab46-f59cbe732f45.013.png" width="588" height="251" alt="" style="-aw-left-pos:0pt; -aw-rel-hpos:column; -aw-rel-vpos:paragraph; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">1.7.2</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:等线; font-size:11pt">schedule</span><span style="font-family:宋体; font-size:11pt">会调用</span><span style="font-family:等线; font-size:11pt">startExecutorsOnWorkers()</span><span style="font-family:宋体; font-size:11pt">，给</span><span style="font-family:等线; font-size:11pt">app</span><span style="font-family:宋体; font-size:11pt">调度资源。先获取资源申请信息，然后遍历</span><span style="font-family:等线; font-size:11pt">worker</span><span style="font-family:宋体; font-size:11pt">，过滤出可用的且硬件资源足够的，然后以</span><span style="font-family:等线; font-size:11pt">core</span><span style="font-family:宋体; font-size:11pt">空闲数大到小排序。创建</span><span style="font-family:等线; font-size:11pt">Executor</span><span style="font-family:宋体; font-size:11pt">。</span></h4><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{1}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:等线; font-size:11pt">cluster</span><span style="font-family:宋体; font-size:11pt">模式分配</span><span style="font-family:等线; font-size:11pt">driver</span><span style="font-family:宋体; font-size:11pt">时是选择</span><span style="font-family:等线; font-size:11pt">worker</span><span style="font-family:宋体; font-size:11pt">是随机。但这里选择启动</span><span style="font-family:等线; font-size:11pt">e</span><span style="font-family:等线; font-size:11pt">xecutor</span><span style="font-family:宋体; font-size:11pt">的</span><span style="font-family:等线; font-size:11pt">worker</span><span style="font-family:宋体; font-size:11pt">时，是按可用资源的大小排序的。</span></h5><p style="line-height:10.5pt; margin:7.8pt 0pt; text-indent:52.5pt"><img src="161caaeb-29aa-4e17-ab46-f59cbe732f45.014.png" width="824" height="567" alt="" style="-aw-left-pos:0pt; -aw-rel-hpos:column; -aw-rel-vpos:paragraph; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{2}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt">确定</span><span style="font-family:等线; font-size:11pt">executor</span><span style="font-family:宋体; font-size:11pt">的</span><span style="font-family:等线; font-size:11pt">cores</span><span style="font-family:宋体; font-size:11pt">数：从</span><span style="font-family:等线; font-size:11pt">app</span><span style="font-family:等线; font-size:11pt">.desc</span><span style="font-family:宋体; font-size:11pt">也就是</span><span style="font-family:等线; font-size:11pt">ApplicationDesc</span><span style="font-family:宋体; font-size:11pt">对象中获取资源信息</span></h5><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">[1]</span><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:等线; font-size:11pt">app.desc.coresPerExecutor.getOrElse(1) </span><span style="font-family:宋体; font-size:11pt">就是</span><span style="font-family:等线; font-size:11pt">--executor-core</span><span style="font-family:宋体; font-size:11pt">，如果没指定，默认为</span><span style="font-family:等线; font-size:11pt">1</span></h6><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{3}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt">判断</span><span style="font-family:等线; font-size:11pt">cores</span><span style="font-family:宋体; font-size:11pt">数是否分配完毕：</span><span style="font-family:等线; font-size:11pt">app.coresleft</span><span style="font-family:等线; font-size:11pt">  </span><span style="font-family:宋体; font-size:11pt">判断是否给</span><span style="font-family:等线; font-size:11pt">application</span><span style="font-family:宋体; font-size:11pt">分配够了</span><span style="font-family:等线; font-size:11pt">core</span><span style="font-family:宋体; font-size:11pt">，</span><span style="font-family:宋体; font-size:11pt">后面每次给</span><span style="font-family:等线; font-size:11pt">application </span><span style="font-family:宋体; font-size:11pt">分配</span><span style="font-family:等线; font-size:11pt">core</span><span style="font-family:宋体; font-size:11pt">后</span><span style="font-family:宋体; font-size:11pt"> </span><span style="font-family:等线; font-size:11pt">app.coresLeft </span><span style="font-family:宋体; font-size:11pt">都会相应的减去分配的</span><span style="font-family:等线; font-size:11pt">core</span><span style="font-family:宋体; font-size:11pt">数</span></h5><p style="line-height:10.5pt; margin:7.8pt 0pt; text-indent:73.5pt"><img src="161caaeb-29aa-4e17-ab46-f59cbe732f45.015.png" width="841" height="141" alt="" style="-aw-left-pos:0pt; -aw-rel-hpos:column; -aw-rel-vpos:paragraph; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">[1]</span><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:等线; font-size:11pt">private val requestedCores = desc.maxCores.getOrElse(defaultCores)</span><span style="font-family:等线; font-size:11pt"> </span><span style="font-family:等线; font-size:11pt">requestedCores</span><span style="font-family:宋体; font-size:11pt">就是默认的总</span><span style="font-family:等线; font-size:11pt">cores</span><span style="font-family:宋体; font-size:11pt">数，</span><span style="font-family:等线; font-size:11pt">int</span><span style="font-family:宋体; font-size:11pt">的最大值，</span></h6><p style="line-height:10.5pt; margin:7.8pt 0pt; text-indent:84pt"><img src="161caaeb-29aa-4e17-ab46-f59cbe732f45.016.png" width="604" height="168" alt="" style="-aw-left-pos:0pt; -aw-rel-hpos:column; -aw-rel-vpos:paragraph; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><p style="line-height:10.5pt; margin:7.8pt 0pt; text-indent:94.5pt"><img src="161caaeb-29aa-4e17-ab46-f59cbe732f45.017.png" width="865" height="65" alt="" style="-aw-left-pos:0pt; -aw-rel-hpos:column; -aw-rel-vpos:paragraph; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">[2]</span><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:等线; font-size:11pt">usableWorkers</span><span style="font-family:宋体; font-size:11pt">：</span><span style="font-family:宋体; font-size:11pt"> </span><span style="font-family:宋体; font-size:11pt">遍历</span><span style="font-family:等线; font-size:11pt">worker</span><span style="font-family:宋体; font-size:11pt">，过滤出可用的且硬件资源足够的，然后以</span><span style="font-family:等线; font-size:11pt">cores</span><span style="font-family:宋体; font-size:11pt">空闲数大到小排序</span></h6><p style="line-height:10.5pt; margin:7.8pt 0pt; text-indent:84pt"><img src="161caaeb-29aa-4e17-ab46-f59cbe732f45.018.png" width="742" height="96" alt="" style="-aw-left-pos:0pt; -aw-rel-hpos:column; -aw-rel-vpos:paragraph; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="color:#ff0000; font-family:等线; font-size:11pt">{4}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="background-color:#ffff00; color:#ff0000; font-family:宋体; font-size:11pt">为每个</span><span style="background-color:#ffff00; color:#ff0000; font-family:等线; font-size:11pt">worker</span><span style="background-color:#ffff00; color:#ff0000; font-family:宋体; font-size:11pt">和</span><span style="background-color:#ffff00; color:#ff0000; font-family:等线; font-size:11pt">executor</span><span style="background-color:#ffff00; color:#ff0000; font-family:宋体; font-size:11pt">分配资源</span><span style="background-color:#ffff00; color:#ff0000; font-family:宋体; font-size:11pt">：</span><span style="color:#ff0000; font-family:等线; font-size:11pt">val assignedCores = scheduleExecutorsOnWorkers(app, usableWorkers, spreadOutApps) </span><span style="color:#ff0000; font-family:宋体; font-size:11pt">上面已经获取了可用的</span><span style="color:#ff0000; font-family:等线; font-size:11pt">worker</span><span style="color:#ff0000; font-family:宋体; font-size:11pt">，现在开始划分并启动</span><span style="color:#ff0000; font-family:等线; font-size:11pt">executor</span></h5><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">[1]</span><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:宋体; font-size:11pt">顾名思义，在</span><span style="font-family:等线; font-size:11pt">worer</span><span style="font-family:宋体; font-size:11pt">上划分</span><span style="font-family:等线; font-size:11pt">executor</span><span style="font-family:宋体; font-size:11pt">，</span></h6><p style="line-height:10.5pt; margin:7.8pt 0pt; text-indent:73.5pt"><img src="161caaeb-29aa-4e17-ab46-f59cbe732f45.019.png" width="830" height="109" alt="" style="-aw-left-pos:0pt; -aw-rel-hpos:column; -aw-rel-vpos:paragraph; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><p style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 85.05pt; page-break-after:avoid; page-break-inside:avoid; text-indent:0pt"><span style="font-family:'等线 Light'; font-size:11pt">(1)</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="color:#1f3864; font-family:'等线 Light'; font-size:11pt">一个executor的cores，启动一个executor最少需要1个core</span></p><p style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 85.05pt; page-break-after:avoid; page-break-inside:avoid; text-indent:0pt"><span style="font-family:'等线 Light'; font-size:11pt">(2)</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="color:#1f3864; font-family:'等线 Light'; font-size:11pt">一个executor的memory</span></p><p style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 85.05pt; page-break-after:avoid; page-break-inside:avoid; text-indent:0pt"><span style="font-family:'等线 Light'; font-size:11pt">(3)</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="color:#1f3864; font-family:'等线 Light'; font-size:11pt">设置worker和executor的调度信息，master设置完这些信息，之后executor启动时，会向worker要这些资源</span></p><p style="font-weight:normal; line-height:10.5pt; margin:0pt 0pt 0pt 99.25pt; page-break-after:avoid; page-break-inside:avoid; text-indent:0pt"><span style="color:#ff0000; font-family:'等线 Light'; font-size:10.5pt">1st</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="color:#ff0000; font-family:'等线 Light'; font-size:10.5pt">获取可用worker的长度，然后创建2个数组，</span><span style="color:#ff0000; font-family:'等线 Light'; font-size:10.5pt"> </span></p><p style="line-height:10.5pt; margin:7.8pt 0pt; text-indent:94.5pt"><img src="161caaeb-29aa-4e17-ab46-f59cbe732f45.020.png" width="849" height="42" alt="" style="-aw-left-pos:0pt; -aw-rel-hpos:column; -aw-rel-vpos:paragraph; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><p style="line-height:12pt; margin:7.8pt 0pt 7.8pt 73.5pt; text-indent:21pt"><span style="color:#ff0000; font-family:等线; font-size:12pt">这2个数组长度是可用的worker，值是每个worker能提供的cores数</span><span style="color:#ff0000; font-family:等线; font-size:12pt">，。</span></p><p style="line-height:12pt; margin:7.8pt 0pt 7.8pt 73.5pt; text-indent:21pt"><span style="color:#ff0000; font-family:等线; font-size:12pt">下图中：</span></p><p style="line-height:12pt; margin:7.8pt 0pt 7.8pt 73.5pt; text-indent:21pt"><span style="color:#ff0000; font-family:等线; font-size:12pt">assignedCores</span><span style="color:#ff0000; font-family:等线; font-size:12pt">数组的意思是一共有5个可用worker，0号worker为app提供了1个core</span></p><p style="line-height:12pt; margin:7.8pt 0pt 7.8pt 73.5pt; text-indent:21pt"><span style="color:#ff0000; font-family:等线; font-size:12pt">assignedExecutors</span><span style="color:#ff0000; font-family:等线; font-size:12pt">的意思是一共有5个可用worker，0号worker为app启动了1个executor</span></p><p style="line-height:10.5pt; margin:7.8pt 0pt; text-indent:94.5pt"><img src="161caaeb-29aa-4e17-ab46-f59cbe732f45.021.png" width="605" height="358" alt="" style="-aw-left-pos:0pt; -aw-rel-hpos:column; -aw-rel-vpos:paragraph; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><p style="font-weight:normal; line-height:10.5pt; margin:0pt 0pt 0pt 99.25pt; page-break-after:avoid; page-break-inside:avoid; text-indent:0pt"><span style="color:#262626; font-family:'等线 Light'; font-size:10.5pt">2nd</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="color:#262626; font-family:'等线 Light'; font-size:10.5pt">创建完数组，开始向里面写值</span></p><p style="line-height:10.5pt; margin:7.8pt 0pt; text-indent:94.5pt"><img src="161caaeb-29aa-4e17-ab46-f59cbe732f45.022.png" width="901" height="93" alt="" style="-aw-left-pos:0pt; -aw-rel-hpos:column; -aw-rel-vpos:paragraph; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><p style="line-height:10.5pt; margin:7.8pt 0pt; text-indent:94.5pt"><span style="font-family:等线; font-size:10.5pt">usableWorkers.map(_.coresFree).sum</span><span style="font-family:等线; font-size:10.5pt">是可用worker一共多少个cores，</span><span style="font-family:等线; font-size:10.5pt">跟设置</span><span style="font-family:等线; font-size:10.5pt">的cores取小，得到总的cores</span></p><p style="line-height:10.5pt; margin:7.8pt 0pt; text-indent:94.5pt"><span style="font-family:等线; font-size:10.5pt">canLaunchExecutor</span><span style="font-family:等线; font-size:10.5pt">：安全判断 </span><span style="font-family:等线; font-size:10.5pt"> </span><span style="font-family:等线; font-size:10.5pt">var freeWorkers = (0 until numUsable).filter(canLaunchExecutor)</span></p><p style="line-height:10.5pt; margin:7.8pt 0pt; text-indent:94.5pt"><span style="color:#ff0000; font-family:等线; font-size:10.5pt">每台worker上分配几个core，自动几个executor</span></p><p style="line-height:10.5pt; margin:7.8pt 0pt; text-indent:94.5pt"><img src="161caaeb-29aa-4e17-ab46-f59cbe732f45.023.png" width="702" height="330" alt="" style="-aw-left-pos:0pt; -aw-rel-hpos:column; -aw-rel-vpos:paragraph; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><p style="line-height:10.5pt; margin:7.8pt 0pt; text-indent:94.5pt"><span style="color:#ff0000; font-family:等线; font-size:10.5pt">最终返回</span><span style="color:#ff0000; font-family:等线; font-size:10.5pt">assignedCores</span><span style="color:#ff0000; font-family:等线; font-size:10.5pt">数组，也就是每台worker的cores</span></p><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{5}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt">现在资源已经分配完成，在</span><span style="font-family:等线; font-size:11pt">worker</span><span style="font-family:宋体; font-size:11pt">中给</span><span style="font-family:等线; font-size:11pt">executor</span><span style="font-family:宋体; font-size:11pt">划分资源，然后启动</span></h5><p style="line-height:10.5pt; margin:7.8pt 0pt; text-indent:84pt"><img src="161caaeb-29aa-4e17-ab46-f59cbe732f45.024.png" width="759" height="128" alt="" style="-aw-left-pos:0pt; -aw-rel-hpos:column; -aw-rel-vpos:paragraph; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">[1]</span><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:等线; font-size:11pt">allocateWorkerResourceToExecutors</span><span style="font-family:等线; font-size:11pt">==</span><span style="font-family:宋体; font-size:11pt">》</span><span style="font-family:等线; font-size:11pt">launchExecutor</span></h6><p style="line-height:10.5pt; margin:7.8pt 0pt; text-indent:84pt"><img src="161caaeb-29aa-4e17-ab46-f59cbe732f45.025.png" width="548" height="222" alt="" style="-aw-left-pos:0pt; -aw-rel-hpos:column; -aw-rel-vpos:paragraph; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt; font-style:normal">1.8</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt; font-weight:bold">回到</span><span style="font-family:等线; font-size:11pt; font-weight:bold">worker</span><span style="font-family:宋体; font-size:11pt; font-weight:bold">，反向注册之后启动</span><span style="font-family:等线; font-size:11pt; font-weight:bold">executor</span></h3><h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">1.8.1</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:等线; font-size:11pt">case</span></h4><p style="line-height:10.5pt; margin:7.8pt 0pt; text-indent:73.5pt"><img src="161caaeb-29aa-4e17-ab46-f59cbe732f45.026.png" width="684" height="223" alt="" style="-aw-left-pos:0pt; -aw-rel-hpos:column; -aw-rel-vpos:paragraph; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">1.8.2</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:等线; font-size:11pt">executor</span><span style="font-family:宋体; font-size:11pt">先向</span><span style="font-family:等线; font-size:11pt">driver</span><span style="font-family:宋体; font-size:11pt">反向注册，然后启动</span></h4><p style="line-height:10.5pt; margin:7.8pt 0pt; text-indent:84pt"><img src="161caaeb-29aa-4e17-ab46-f59cbe732f45.027.png" width="604" height="136" alt="" style="-aw-left-pos:0pt; -aw-rel-hpos:column; -aw-rel-vpos:paragraph; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><p style="line-height:10.5pt; margin:7.8pt 0pt; text-indent:84pt"><img src="161caaeb-29aa-4e17-ab46-f59cbe732f45.028.png" width="670" height="225" alt="" style="-aw-left-pos:0pt; -aw-rel-hpos:column; -aw-rel-vpos:paragraph; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><h3 style="margin:0pt 0pt 6pt 28.35pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt; font-style:normal">1.9</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt; font-weight:bold">资源调度的</span><span style="font-family:等线; font-size:11pt; font-weight:bold">summary</span></h3><h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">1.9.1</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt">提交</span><span style="font-family:等线; font-size:11pt">app</span><span style="font-family:宋体; font-size:11pt">时，</span><span style="font-family:等线; font-size:11pt">Executor</span><span style="font-family:宋体; font-size:11pt">是在集群中分散启动的，有利于计算本地化。这样发送</span><span style="font-family:等线; font-size:11pt">task</span><span style="font-family:宋体; font-size:11pt">时，可以选择数据所在的节点，如果</span><span style="font-family:等线; font-size:11pt">executor</span><span style="font-family:宋体; font-size:11pt">都在一个节点上，还要拉取数据</span></h4><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{1}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt">比如</span><span style="font-family:等线; font-size:11pt">--total-executor-cores</span><span style="font-family:等线; font-size:11pt"> </span><span style="font-family:宋体; font-size:11pt">设置为</span><span style="font-family:等线; font-size:11pt">2</span><span style="font-family:宋体; font-size:11pt">，</span><span style="font-family:等线; font-size:11pt">--executor-cores</span><span style="font-family:宋体; font-size:11pt">为</span><span style="font-family:等线; font-size:11pt">1</span><span style="font-family:宋体; font-size:11pt">，</span><span style="font-family:等线; font-size:11pt">spark-env.sh</span><span style="font-family:宋体; font-size:11pt">中每个</span><span style="font-family:等线; font-size:11pt">executor</span><span style="font-family:宋体; font-size:11pt">也设置为</span><span style="font-family:等线; font-size:11pt">1</span><span style="font-family:宋体; font-size:11pt">，理论上一个</span><span style="font-family:等线; font-size:11pt">worker</span><span style="font-family:宋体; font-size:11pt">上启动一个</span><span style="font-family:等线; font-size:11pt">executor</span><span style="font-family:宋体; font-size:11pt">就可以，但</span><span style="font-family:等线; font-size:11pt">spark</span><span style="font-family:宋体; font-size:11pt">仍然会分散在</span><span style="font-family:等线; font-size:11pt">2</span><span style="font-family:宋体; font-size:11pt">个</span><span style="font-family:等线; font-size:11pt">worker</span><span style="font-family:宋体; font-size:11pt">上启动</span><span style="font-family:等线; font-size:11pt">2</span><span style="font-family:宋体; font-size:11pt">个</span><span style="font-family:等线; font-size:11pt">executor</span><span style="font-family:等线; font-size:11pt"> </span></h5><h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">1.9.2</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt">默认在命令行不指定任何参数时，即使在</span><span style="font-family:等线; font-size:11pt">spark-env</span><span style="font-family:宋体; font-size:11pt">中指定了</span><span style="font-family:等线; font-size:11pt">core</span><span style="font-family:宋体; font-size:11pt">和</span><span style="font-family:等线; font-size:11pt">memory</span><span style="font-family:宋体; font-size:11pt">，会为每个</span><span style="font-family:等线; font-size:11pt">worker</span><span style="font-family:宋体; font-size:11pt">启动</span><span style="font-family:等线; font-size:11pt">1</span><span style="font-family:宋体; font-size:11pt">个</span><span style="font-family:等线; font-size:11pt">executor</span><span style="font-family:宋体; font-size:11pt">，</span><span style="font-family:等线; font-size:11pt">standalone</span><span style="font-family:宋体; font-size:11pt">下，所有</span><span style="font-family:等线; font-size:11pt">cores</span><span style="font-family:宋体; font-size:11pt">和</span><span style="font-family:等线; font-size:11pt">1G</span><span style="font-family:宋体; font-size:11pt">内存，</span><span style="font-family:等线; font-size:11pt">yarn</span><span style="font-family:宋体; font-size:11pt">下，</span><span style="font-family:等线; font-size:11pt">1</span><span style="font-family:宋体; font-size:11pt">个</span><span style="font-family:等线; font-size:11pt">core</span><span style="font-family:宋体; font-size:11pt">和</span><span style="font-family:等线; font-size:11pt">1G</span><span style="font-family:宋体; font-size:11pt">内存</span></h4><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{1}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:等线; font-size:11pt">standalone-cluster</span><span style="font-family:宋体; font-size:11pt">时，如果一个节点</span><span style="font-family:等线; font-size:11pt">env</span><span style="font-family:宋体; font-size:11pt">中指定了</span><span style="font-family:等线; font-size:11pt">2</span><span style="font-family:宋体; font-size:11pt">个</span><span style="font-family:等线; font-size:11pt">cores</span><span style="font-family:宋体; font-size:11pt">，如果</span><span style="font-family:等线; font-size:11pt">driver</span><span style="font-family:宋体; font-size:11pt">也在这个节点上，那么</span><span style="font-family:等线; font-size:11pt">worker</span><span style="font-family:宋体; font-size:11pt">会分配</span><span style="font-family:等线; font-size:11pt">1</span><span style="font-family:宋体; font-size:11pt">个</span><span style="font-family:等线; font-size:11pt">core</span><span style="font-family:宋体; font-size:11pt">，因为</span><span style="font-family:等线; font-size:11pt">driver</span><span style="font-family:宋体; font-size:11pt">也要占用</span><span style="font-family:等线; font-size:11pt">1</span><span style="font-family:宋体; font-size:11pt">个</span><span style="font-family:等线; font-size:11pt">core</span></h5><h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">1.9.3</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:等线; font-size:11pt">executor</span><span style="font-family:宋体; font-size:11pt">的数量同时受</span><span style="font-family:等线; font-size:11pt">core</span><span style="font-family:宋体; font-size:11pt">和内存的限制</span></h4><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{1}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt">想要在</span><span style="font-family:等线; font-size:11pt">1</span><span style="font-family:宋体; font-size:11pt">个</span><span style="font-family:等线; font-size:11pt">worker</span><span style="font-family:宋体; font-size:11pt">启动多个</span><span style="font-family:等线; font-size:11pt">executor</span><span style="font-family:宋体; font-size:11pt">，提交时指定</span><span style="font-family:等线; font-size:11pt">--executor-cores</span></h5><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">[1]</span><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:宋体; font-size:11pt">比如一共</span><span style="font-family:等线; font-size:11pt">2</span><span style="font-family:宋体; font-size:11pt">个</span><span style="font-family:等线; font-size:11pt">worker</span><span style="font-family:宋体; font-size:11pt">，每个</span><span style="font-family:等线; font-size:11pt">worker</span><span style="font-family:宋体; font-size:11pt">在</span><span style="font-family:等线; font-size:11pt">env</span><span style="font-family:宋体; font-size:11pt">中设置了</span><span style="font-family:等线; font-size:11pt">2</span><span style="font-family:宋体; font-size:11pt">个</span><span style="font-family:等线; font-size:11pt">cores</span><span style="font-family:宋体; font-size:11pt">，如果提交</span><span style="font-family:等线; font-size:11pt">app</span><span style="font-family:宋体; font-size:11pt">时，设置了</span><span style="font-family:等线; font-size:11pt">--executor-cores</span><span style="font-family:宋体; font-size:11pt">为</span><span style="font-family:等线; font-size:11pt">1</span><span style="font-family:宋体; font-size:11pt">，则每个</span><span style="font-family:等线; font-size:11pt">worker</span><span style="font-family:宋体; font-size:11pt">会启动</span><span style="font-family:等线; font-size:11pt">2</span><span style="font-family:宋体; font-size:11pt">个</span><span style="font-family:等线; font-size:11pt">executor</span></h6><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">[2]</span><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:宋体; font-size:11pt">一般在</span><span style="font-family:等线; font-size:11pt">1</span><span style="font-family:宋体; font-size:11pt">个</span><span style="font-family:等线; font-size:11pt">worker</span><span style="font-family:宋体; font-size:11pt">就启动一个</span><span style="font-family:等线; font-size:11pt">executor</span><span style="font-family:宋体; font-size:11pt">，只有在内存不足时才会在</span><span style="font-family:等线; font-size:11pt">1</span><span style="font-family:宋体; font-size:11pt">个</span><span style="font-family:等线; font-size:11pt">worker</span><span style="font-family:宋体; font-size:11pt">上启动多个</span><span style="font-family:等线; font-size:11pt">executor</span><span style="font-family:宋体; font-size:11pt">，这样可以让一个</span><span style="font-family:等线; font-size:11pt">worker</span><span style="font-family:宋体; font-size:11pt">中为所有</span><span style="font-family:等线; font-size:11pt">executor</span><span style="font-family:宋体; font-size:11pt">分配的总内存变多。</span></h6><h5 style="font-weight:normal; line-height:11pt; margin:0pt 0pt 0pt 56.7pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">{2}</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt">如果内存设置的跟</span><span style="font-family:等线; font-size:11pt">spark-env</span><span style="font-family:宋体; font-size:11pt">中设置的一样大，一个</span><span style="font-family:等线; font-size:11pt">worker</span><span style="font-family:宋体; font-size:11pt">只会启动</span><span style="font-family:等线; font-size:11pt">1</span><span style="font-family:宋体; font-size:11pt">个</span><span style="font-family:等线; font-size:11pt">executor</span></h5><h6 style="font-weight:normal; margin:0pt 0pt 0pt 70.9pt; text-indent:0pt"><span style="font-family:等线; font-size:11pt">[1]</span><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:等线; font-size:11pt">--executor-memory</span><span style="font-family:等线; font-size:11pt"> </span><span style="font-family:等线; font-size:11pt">2g</span></h6><h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">1.9.4</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:11pt">如果提交时指定</span><span style="font-family:等线; font-size:11pt">--total-executor-cores</span><span style="font-family:宋体; font-size:11pt">指定</span><span style="font-family:等线; font-size:11pt">app</span><span style="font-family:宋体; font-size:11pt">最多使用的</span><span style="font-family:等线; font-size:11pt">cores</span></h4><p style="line-height:10.5pt; margin:7.8pt 0pt; text-indent:63pt"><img src="161caaeb-29aa-4e17-ab46-f59cbe732f45.029.png" width="1336" height="47" alt="" style="-aw-left-pos:0pt; -aw-rel-hpos:column; -aw-rel-vpos:paragraph; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><h4 style="font-weight:normal; margin:0pt 0pt 6pt 42.55pt; text-indent:0pt"><span style="display:inline; font-family:等线; font-size:11pt; font-style:normal; font-variant:normal; text-decoration:none; text-transform:none; vertical-align:baseline">1.9.5</span><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:等线; font-size:11pt">app</span><span style="font-family:宋体; font-size:11pt">任务资源不够时，不会失败而是等待，等前一个</span><span style="font-family:等线; font-size:11pt">app</span><span style="font-family:宋体; font-size:11pt">资源释放</span></h4><p style="line-height:10.5pt; margin:7.8pt 0pt"><span style="font-family:等线; font-size:10.5pt">&#xa0;</span></p></div></body></html>